(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();const kn="modulepreload",On=function(r){return"/"+r},Ms={},Ce=function(t,e,s){let i=Promise.resolve();if(e&&e.length>0){let u=function(p){return Promise.all(p.map(w=>Promise.resolve(w).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),d=a?.nonce||a?.getAttribute("nonce");i=u(e.map(p=>{if(p=On(p),p in Ms)return;Ms[p]=!0;const w=p.endsWith(".css"),f=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${f}`))return;const x=document.createElement("link");if(x.rel=w?"stylesheet":kn,w||(x.as="script"),x.crossOrigin="",x.href=p,d&&x.setAttribute("nonce",d),document.head.appendChild(x),w)return new Promise((T,S)=>{x.addEventListener("load",T),x.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${p}`)))})}))}function n(a){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=a,window.dispatchEvent(d),!d.defaultPrevented)throw a}return i.then(a=>{for(const d of a||[])d.status==="rejected"&&n(d.reason);return t().catch(n)})},H={btc:{name:"Bitcoin",symbol:"btc/usd",displayName:"BTC"},eth:{name:"Ethereum",symbol:"eth/usd",displayName:"ETH"},sol:{name:"Solana",symbol:"sol/usd",displayName:"SOL"},xrp:{name:"Ripple",symbol:"xrp/usd",displayName:"XRP"}},$n="wss://ws-live-data.polymarket.com",Cn=5e3;class Rn{ws=null;pingInterval=null;reconnectAttempts=0;maxReconnectAttempts=5;reconnectDelay=1e3;currentSource=null;onPriceUpdate=null;onStatusChange=null;constructor(){this.connect=this.connect.bind(this),this.disconnect=this.disconnect.bind(this)}setCallbacks(t,e){this.onPriceUpdate=t,this.onStatusChange=e}connect(){if(this.ws?.readyState!==WebSocket.OPEN){this.disconnect(),this.currentSource="chainlink";try{this.ws=new WebSocket($n),this.setupWebSocketHandlers()}catch(t){this.handleError(`Failed to connect: ${t instanceof Error?t.message:"Unknown error"}`)}}}setupWebSocketHandlers(){this.ws&&(this.ws.onopen=()=>{this.reconnectAttempts=0,this.startPingInterval(),this.subscribe(),this.updateStatus({connected:!0,source:this.currentSource,lastUpdate:null,error:null})},this.ws.onmessage=t=>{try{const e=JSON.parse(t.data);if(e.type==="pong")return;e.topic==="crypto_prices_chainlink"&&(this.onPriceUpdate&&this.onPriceUpdate(e),this.updateStatus({connected:!0,source:this.currentSource,lastUpdate:Date.now(),error:null}))}catch(e){console.error("Error parsing message:",e)}},this.ws.onerror=()=>{this.handleError("WebSocket error occurred")},this.ws.onclose=()=>{this.stopPingInterval(),this.updateStatus({connected:!1,source:this.currentSource,lastUpdate:null,error:null}),this.attemptReconnect()})}subscribe(){if(!this.ws||this.ws.readyState!==WebSocket.OPEN)return;const e={action:"subscribe",subscriptions:Object.values(H).map(s=>({topic:"crypto_prices_chainlink",type:"*",filters:`{"symbol":"${s.symbol}"}`}))};this.ws.send(JSON.stringify(e))}startPingInterval(){this.stopPingInterval(),this.pingInterval=window.setInterval(()=>{this.ws?.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"ping"}))},Cn)}stopPingInterval(){this.pingInterval!==null&&(clearInterval(this.pingInterval),this.pingInterval=null)}attemptReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){this.handleError("Max reconnection attempts reached");return}this.reconnectAttempts++,setTimeout(()=>{this.connect()},this.reconnectDelay*this.reconnectAttempts)}handleError(t){this.updateStatus({connected:!1,source:this.currentSource,lastUpdate:null,error:t})}updateStatus(t){this.onStatusChange&&this.onStatusChange(t)}disconnect(){this.stopPingInterval(),this.ws&&(this.ws.close(),this.ws=null),this.currentSource=null,this.reconnectAttempts=0}isConnected(){return this.ws?.readyState===WebSocket.OPEN}}const _n="/api/polymarket";class Nn{static async fetchEventBySlug(t){try{const e=`${_n}/markets/slug/${t}`;console.log(`[PolymarketAPI] Fetching: ${e}`);const s=await fetch(e,{method:"GET",headers:{Accept:"application/json"},mode:"cors",cache:"no-cache"});if(console.log(`[PolymarketAPI] Response status: ${s.status} for ${t}`),!s.ok){if(s.status===404)return null;const T=await s.text().catch(()=>"");throw console.error(`[PolymarketAPI] Error ${s.status}:`,T),new Error(`Failed to fetch event: ${s.status} ${s.statusText}`)}const i=await s.json(),n=i.markets?.[0];console.log(`[PolymarketAPI] Response for ${t}:`,{hasConditionId:!!i.conditionId||!!i.condition_id,hasQuestionId:!!i.questionID||!!i.questionId,hasClobTokenIds:!!i.clobTokenIds||!!i.clob_token_ids,marketsCount:i.markets?.length||0,market0Structure:n?{hasClobTokenIds:!!n.clobTokenIds,clobTokenIdsValue:n.clobTokenIds,clobTokenIdsType:typeof n.clobTokenIds,hasTokens:!!n.tokens,tokensCount:n.tokens?.length||0,tokenIds:n.tokens?.map(T=>T.token_id||T.tokenId||T.id).filter(Boolean)||[],hasConditionId:!!n.conditionId||!!n.condition_id,conditionIdValue:n.conditionId||n.condition_id,hasQuestionId:!!n.questionID||!!n.questionId||!!n.question_id,questionIdValue:n.questionID||n.questionId||n.question_id,allKeys:Object.keys(n)}:"no markets",fullDataKeys:Object.keys(i)}),n?.clobTokenIds||console.log(`[PolymarketAPI] Full response for ${t}:`,JSON.stringify(i,null,2).substring(0,3e3));const a=T=>T.conditionId||T.condition_id||T.condition?.id||T.markets?.[0]?.conditionId||T.markets?.[0]?.condition_id||T.conditionId||T.conditions?.[0]?.id,d=T=>T.questionID||T.questionId||T.question_id||T.question?.id||T.markets?.[0]?.questionID||T.markets?.[0]?.questionId||T.markets?.[0]?.question_id||T.questions?.[0]?.id,p=(T=>{if(console.log("[extractClobTokenIds] Starting extraction. Data structure:",{hasMarkets:!!T.markets,marketsLength:T.markets?.length||0,hasTopLevelClobTokenIds:!!T.clobTokenIds,hasTopLevelTokens:!!T.tokens}),T.clobTokenIds){if(typeof T.clobTokenIds=="string")try{const S=JSON.parse(T.clobTokenIds);if(Array.isArray(S))return console.log("[extractClobTokenIds] ✓ Found in top-level clobTokenIds (parsed):",S),S}catch(S){console.warn("[extractClobTokenIds] Failed to parse clobTokenIds as JSON:",S)}else if(Array.isArray(T.clobTokenIds))return console.log("[extractClobTokenIds] ✓ Found in top-level clobTokenIds (array):",T.clobTokenIds),T.clobTokenIds}if(T.markets&&Array.isArray(T.markets)&&T.markets.length>0){const S=T.markets[0];if(console.log("[extractClobTokenIds] Market[0] keys:",Object.keys(S)),console.log("[extractClobTokenIds] Market[0] structure:",{hasClobTokenIds:!!S.clobTokenIds,clobTokenIdsType:typeof S.clobTokenIds,hasTokens:!!S.tokens,tokensLength:S.tokens?.length||0,tokensStructure:S.tokens?.[0]?Object.keys(S.tokens[0]):[]}),S.clobTokenIds){if(typeof S.clobTokenIds=="string")try{const P=JSON.parse(S.clobTokenIds);if(Array.isArray(P))return console.log("[extractClobTokenIds] ✓ Found in markets[0].clobTokenIds (parsed):",P),P}catch(P){console.warn("[extractClobTokenIds] Failed to parse markets[0].clobTokenIds as JSON:",P)}else if(Array.isArray(S.clobTokenIds))return console.log("[extractClobTokenIds] ✓ Found in markets[0].clobTokenIds (array):",S.clobTokenIds),S.clobTokenIds}if(S.tokens&&Array.isArray(S.tokens)&&S.tokens.length>0){const P=S.tokens.map(M=>{const k=M.token_id||M.tokenId||M.id||M.clobTokenId;return console.log("[extractClobTokenIds] Token structure:",{id:k,allKeys:Object.keys(M)}),k}).filter(Boolean);if(P.length>0)return console.log("[extractClobTokenIds] ✓ Found in markets[0].tokens:",P),P}}if(T.clob_token_ids){if(typeof T.clob_token_ids=="string")try{const S=JSON.parse(T.clob_token_ids);if(Array.isArray(S))return console.log("[extractClobTokenIds] ✓ Found in clob_token_ids (parsed):",S),S}catch{}else if(Array.isArray(T.clob_token_ids))return console.log("[extractClobTokenIds] ✓ Found in clob_token_ids (array):",T.clob_token_ids),T.clob_token_ids}if(T.tokens&&Array.isArray(T.tokens)){const S=T.tokens.map(P=>P.token_id||P.tokenId||P.id).filter(Boolean);if(S.length>0)return console.log("[extractClobTokenIds] ✓ Found in top-level tokens:",S),S}if(T.outcomes&&Array.isArray(T.outcomes)){const S=T.outcomes.map(P=>P.token_id||P.tokenId||P.id).filter(Boolean);if(S.length>0)return console.log("[extractClobTokenIds] ✓ Found in outcomes:",S),S}console.warn("[extractClobTokenIds] ✗ Could not find clobTokenIds. Full data keys:",Object.keys(T)),T.markets?.[0]&&console.warn("[extractClobTokenIds] Market[0] full structure:",JSON.stringify(T.markets[0],null,2).substring(0,1e3))})(i),w=a(i),f=d(i);if(console.log(`[PolymarketAPI] Extraction results for ${t}:`,{conditionId:w||"NOT FOUND",questionId:f||"NOT FOUND",clobTokenIds:p||"NOT FOUND",clobTokenIdsCount:p?.length||0}),(!p||!w||!f)&&(console.warn(`[PolymarketAPI] ⚠️ Missing data for ${t}:`,{missingClobTokenIds:!p,missingConditionId:!w,missingQuestionId:!f}),!p&&i.markets?.[0]?.tokens)){const T=i.markets[0].tokens.map(S=>S.token_id||S.tokenId||S.id||S.clobTokenId).filter(Boolean);T.length>0&&console.log("[PolymarketAPI] Found alternative token IDs:",T)}const x={slug:i.slug||"",title:i.title||i.question||"",description:i.description,startDate:i.startDate||i.start_date||"",endDate:i.endDate||i.end_date||"",active:i.active||!1,closed:i.closed||!1,conditionId:w,questionId:f,questionID:f,clobTokenIds:p,liquidity:i.liquidity,volume:i.volume,markets:i.markets,...i};return x.conditionId=w,x.questionId=f,x.questionID=f,x.clobTokenIds=p,i.markets&&(x.markets=i.markets),console.log(`[PolymarketAPI] Final event data for ${t}:`,{conditionId:x.conditionId||"MISSING",questionId:x.questionId||"MISSING",questionID:x.questionID||"MISSING",clobTokenIds:x.clobTokenIds||"MISSING",clobTokenIdsType:typeof x.clobTokenIds,clobTokenIdsIsArray:Array.isArray(x.clobTokenIds),clobTokenIdsLength:Array.isArray(x.clobTokenIds)?x.clobTokenIds.length:0,hasMarkets:!!x.markets,marketsLength:x.markets?.length||0,market0ClobTokenIds:x.markets?.[0]?.clobTokenIds||"MISSING",market0Tokens:x.markets?.[0]?.tokens?.length||0}),i.markets&&!x.markets&&(x.markets=i.markets,console.log(`[PolymarketAPI] Preserved markets data in event object for ${t}`)),x}catch(e){throw console.error(`Error fetching event ${t}:`,e),e instanceof TypeError&&e.message.includes("fetch")?new Error("Network error: Unable to connect to Polymarket API. This may be due to CORS restrictions. Please check your network connection or use a CORS proxy."):e}}static async fetchMultipleEvents(t){const e=t.map(s=>this.fetchEventBySlug(s));return Promise.all(e)}}function xs(r=10){const t=[],e=new Date,s=e.getMinutes(),i=Math.floor(s/15)*15;let n=new Date(e);n.setMinutes(i,0,0);for(let a=0;a<r;a++){const d=Math.floor(n.getTime()/1e3);t.push(d),n.setMinutes(n.getMinutes()+15)}return t}function Is(){const r=new Date,t=r.getMinutes(),e=Math.floor(t/15)*15;let s=new Date(r);return s.setMinutes(e,0,0),s.setMinutes(s.getMinutes()-15),Math.floor(s.getTime()/1e3)}function kr(r,t="btc"){return`${t}-updown-15m-${r}`}function Fn(r){const t=r.match(/(?:btc|eth|sol|xrp)-updown-15m-(\d+)/);return t&&t[1]?parseInt(t[1],10):null}function ks(r){return new Date(r*1e3).toLocaleString("en-GB",{timeZone:"Asia/Dhaka",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1})}function Ln(r){return new Date(r*1e3).toLocaleString("en-GB",{timeZone:"Asia/Dhaka",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1})}class Dn{events=[];currentEventIndex=-1;refreshInterval=null;onEventsUpdated=null;asset;constructor(t="btc"){this.asset=t}setOnEventsUpdated(t){this.onEventsUpdated=t}createEventFromTimestamp(t,e){const s=e?.slug||kr(t,this.asset),i=Fn(s)||t,n=i+900,a=new Date(i*1e3).toISOString(),d=new Date(n*1e3).toISOString(),u=Math.floor(Date.now()/1e3),p=i<=u&&u<n,w=u>=n;let f;e?.closed||w?f="expired":p?f="active":f="upcoming";const x=Ln(i),T=H[this.asset],S=e?.title||`${T.displayName} Up/Down 15m - ${x}`;let P=e?.conditionId||e?.condition_id,M=e?.questionID||e?.questionId||e?.question_id,k;if(console.log(`[EventManager] Event received for ${s}:`,{hasEvent:!!e,eventKeys:e?Object.keys(e):[],conditionId:e?.conditionId||e?.condition_id||"MISSING",questionId:e?.questionID||e?.questionId||e?.question_id||"MISSING",clobTokenIds:e?.clobTokenIds||"MISSING",clobTokenIdsType:typeof e?.clobTokenIds,hasMarkets:!!e?.markets,marketsLength:e?.markets?.length||0,market0ClobTokenIds:e?.markets?.[0]?.clobTokenIds||"MISSING",market0Tokens:e?.markets?.[0]?.tokens?.length||0,fullEventSample:e?JSON.stringify(e,null,2).substring(0,1e3):"null"}),e?.clobTokenIds){if(Array.isArray(e.clobTokenIds))k=e.clobTokenIds,console.log("[EventManager] ✓ Found clobTokenIds in event.clobTokenIds:",k);else if(typeof e.clobTokenIds=="string")try{const $=JSON.parse(e.clobTokenIds);Array.isArray($)&&(k=$,console.log("[EventManager] ✓ Parsed clobTokenIds from string:",k))}catch($){console.warn("[EventManager] Failed to parse clobTokenIds as JSON:",$)}}else if(e?.markets?.[0]){const $=e.markets[0];if(console.log(`[EventManager] Trying fallback extraction from markets[0] for ${s}`),$.clobTokenIds){if(Array.isArray($.clobTokenIds))k=$.clobTokenIds,console.log("[EventManager] ✓ Found clobTokenIds in markets[0].clobTokenIds:",k);else if(typeof $.clobTokenIds=="string")try{const O=JSON.parse($.clobTokenIds);Array.isArray(O)&&(k=O,console.log("[EventManager] ✓ Found clobTokenIds in markets[0].clobTokenIds (parsed):",k))}catch(O){console.warn("[EventManager] Failed to parse markets[0].clobTokenIds:",O)}}if(!k&&$.tokens&&Array.isArray($.tokens)&&$.tokens.length>0){const O=$.tokens.map(C=>C.token_id||C.tokenId||C.id||C.clobTokenId).filter(Boolean);O.length>0&&(k=O,console.log("[EventManager] ✓ Found clobTokenIds in markets[0].tokens:",k))}P||(P=$.conditionId||$.condition_id,P&&console.log("[EventManager] ✓ Found conditionId in markets[0]:",P)),M||(M=$.questionID||$.questionId||$.question_id,M&&console.log("[EventManager] ✓ Found questionId in markets[0]:",M))}return console.log(`[EventManager] Final extraction for ${s}:`,{conditionId:P||"MISSING",questionId:M||"MISSING",clobTokenIds:k||"MISSING",clobTokenIdsCount:k?.length||0}),{slug:s,title:S,startDate:a,endDate:d,status:f,conditionId:P,questionId:M,clobTokenIds:k,formattedStartDate:ks(i),formattedEndDate:ks(n),timestamp:i,rawData:e||void 0}}async loadEvents(t=10){try{const e=Is(),s=kr(e,this.asset),i=xs(t-1),n=i.map(w=>kr(w,this.asset)),a=[s,...n],d=await Promise.allSettled(a.map(w=>Nn.fetchEventBySlug(w))).then(w=>w.map((f,x)=>f.status==="fulfilled"?f.value:(console.warn(`Failed to fetch event ${a[x]}:`,f.reason),null))),u=this.createEventFromTimestamp(e,d[0]),p=i.map((w,f)=>{const x=d[f+1];return this.createEventFromTimestamp(w,x)}).filter(w=>w.status!=="expired");this.events=[u,...p],this.currentEventIndex=this.events.findIndex(w=>w.status==="active"),this.onEventsUpdated&&this.onEventsUpdated()}catch(e){console.error("Error loading events:",e);const s=Is(),i=xs(t-1),n=this.createEventFromTimestamp(s,null),a=i.map(d=>this.createEventFromTimestamp(d,null)).filter(d=>d.status!=="expired");throw this.events=[n,...a],this.currentEventIndex=this.events.findIndex(d=>d.status==="active"),this.onEventsUpdated&&this.onEventsUpdated(),e}}getEvents(){return this.events}getCurrentEventIndex(){return this.currentEventIndex}startAutoRefresh(t=6e4){this.stopAutoRefresh(),this.refreshInterval=window.setInterval(()=>{this.loadEvents().catch(console.error)},t)}stopAutoRefresh(){this.refreshInterval!==null&&(clearInterval(this.refreshInterval),this.refreshInterval=null)}}class Un{managers=new Map;onEventsUpdated=null;constructor(){const t=["btc","eth","sol","xrp"];for(const e of t){const s=new Dn(e);this.managers.set(e,s)}}setOnEventsUpdated(t){this.onEventsUpdated=t;for(const e of this.managers.values())e.setOnEventsUpdated(()=>{this.onEventsUpdated&&this.onEventsUpdated()})}async loadEvents(t,e=10){const s=this.managers.get(t);if(!s)throw new Error(`No event manager found for asset: ${t}`);await s.loadEvents(e)}async loadAllEvents(t=10){const e=Array.from(this.managers.keys()).map(s=>this.loadEvents(s,t).catch(i=>{console.error(`Error loading events for ${s}:`,i)}));await Promise.allSettled(e)}getEvents(t){const e=this.managers.get(t);return e?e.getEvents():[]}getAllEvents(){const t=new Map;for(const[e,s]of this.managers.entries())t.set(e,s.getEvents());return t}getCurrentEventIndex(t){const e=this.managers.get(t);return e?e.getCurrentEventIndex():-1}startAutoRefresh(t,e=6e4){const s=this.managers.get(t);s&&s.startAutoRefresh(e)}startAutoRefreshAll(t=6e4){for(const e of this.managers.values())e.startAutoRefresh(t)}stopAutoRefresh(t){const e=this.managers.get(t);e&&e.stopAutoRefresh()}stopAutoRefreshAll(){for(const t of this.managers.values())t.stopAutoRefresh()}getManager(t){return this.managers.get(t)}getAssets(){return Array.from(this.managers.keys())}}const Bn="Polymarket CTF Exchange",zn="1",qn=[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}],Gn=[{name:"salt",type:"uint256"},{name:"maker",type:"address"},{name:"signer",type:"address"},{name:"taker",type:"address"},{name:"tokenId",type:"uint256"},{name:"makerAmount",type:"uint256"},{name:"takerAmount",type:"uint256"},{name:"expiration",type:"uint256"},{name:"nonce",type:"uint256"},{name:"feeRateBps",type:"uint256"},{name:"side",type:"uint8"},{name:"signatureType",type:"uint8"}];function ir(r,{strict:t=!0}={}){return!r||typeof r!="string"?!1:t?/^0x[0-9a-fA-F]*$/.test(r):r.startsWith("0x")}function Kt(r){return ir(r,{strict:!1})?Math.ceil((r.length-2)/2):r.length}const mi="2.44.4";let Or={getDocsUrl:({docsBaseUrl:r,docsPath:t="",docsSlug:e})=>t?`${r??"https://viem.sh"}${t}${e?`#${e}`:""}`:void 0,version:`viem@${mi}`};class _t extends Error{constructor(t,e={}){const s=e.cause instanceof _t?e.cause.details:e.cause?.message?e.cause.message:e.details,i=e.cause instanceof _t&&e.cause.docsPath||e.docsPath,n=Or.getDocsUrl?.({...e,docsPath:i}),a=[t||"An error occurred.","",...e.metaMessages?[...e.metaMessages,""]:[],...n?[`Docs: ${n}`]:[],...s?[`Details: ${s}`]:[],...Or.version?[`Version: ${Or.version}`]:[]].join(`
`);super(a,e.cause?{cause:e.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=s,this.docsPath=i,this.metaMessages=e.metaMessages,this.name=e.name??this.name,this.shortMessage=t,this.version=mi}walk(t){return yi(this,t)}}function yi(r,t){return t?.(r)?r:r&&typeof r=="object"&&"cause"in r&&r.cause!==void 0?yi(r.cause,t):t?null:r}class Hn extends _t{constructor({expectedLength:t,givenLength:e,type:s}){super([`ABI encoding array length mismatch for type ${s}.`,`Expected length: ${t}`,`Given length: ${e}`].join(`
`),{name:"AbiEncodingArrayLengthMismatchError"})}}class jn extends _t{constructor({expectedSize:t,value:e}){super(`Size of bytes "${e}" (bytes${Kt(e)}) does not match expected size (bytes${t}).`,{name:"AbiEncodingBytesSizeMismatchError"})}}class Wn extends _t{constructor({expectedLength:t,givenLength:e}){super(["ABI encoding params/values length mismatch.",`Expected length (params): ${t}`,`Given length (values): ${e}`].join(`
`),{name:"AbiEncodingLengthMismatchError"})}}class Kn extends _t{constructor({expectedSize:t,givenSize:e}){super(`Expected bytes${t}, got bytes${e}.`,{name:"BytesSizeMismatchError"})}}class Yn extends _t{constructor(t,{docsPath:e}){super([`Type "${t}" is not a valid encoding type.`,"Please provide a valid ABI type."].join(`
`),{docsPath:e,name:"InvalidAbiEncodingType"})}}class Vn extends _t{constructor(t){super([`Value "${t}" is not a valid array.`].join(`
`),{name:"InvalidArrayError"})}}class wi extends _t{constructor({offset:t,position:e,size:s}){super(`Slice ${e==="start"?"starting":"ending"} at offset "${t}" is out-of-bounds (size: ${s}).`,{name:"SliceOffsetOutOfBoundsError"})}}class vi extends _t{constructor({size:t,targetSize:e,type:s}){super(`${s.charAt(0).toUpperCase()}${s.slice(1).toLowerCase()} size (${t}) exceeds padding size (${e}).`,{name:"SizeExceedsPaddingSizeError"})}}function Me(r,{dir:t,size:e=32}={}){return typeof r=="string"?fe(r,{dir:t,size:e}):Jn(r,{dir:t,size:e})}function fe(r,{dir:t,size:e=32}={}){if(e===null)return r;const s=r.replace("0x","");if(s.length>e*2)throw new vi({size:Math.ceil(s.length/2),targetSize:e,type:"hex"});return`0x${s[t==="right"?"padEnd":"padStart"](e*2,"0")}`}function Jn(r,{dir:t,size:e=32}={}){if(e===null)return r;if(r.length>e)throw new vi({size:r.length,targetSize:e,type:"bytes"});const s=new Uint8Array(e);for(let i=0;i<e;i++){const n=t==="right";s[n?i:e-i-1]=r[n?i:r.length-i-1]}return s}class Si extends _t{constructor({max:t,min:e,signed:s,size:i,value:n}){super(`Number "${n}" is not in safe ${i?`${i*8}-bit ${s?"signed":"unsigned"} `:""}integer range ${t?`(${e} to ${t})`:`(above ${e})`}`,{name:"IntegerOutOfRangeError"})}}class Qn extends _t{constructor({givenSize:t,maxSize:e}){super(`Size cannot exceed ${e} bytes. Given size: ${t} bytes.`,{name:"SizeOverflowError"})}}function Ue(r,{size:t}){if(Kt(r)>t)throw new Qn({givenSize:Kt(r),maxSize:t})}const Xn=Array.from({length:256},(r,t)=>t.toString(16).padStart(2,"0"));function Xr(r,t={}){return typeof r=="number"||typeof r=="bigint"?ge(r,t):typeof r=="string"?Ei(r,t):typeof r=="boolean"?bi(r,t):Ti(r,t)}function bi(r,t={}){const e=`0x${Number(r)}`;return typeof t.size=="number"?(Ue(e,{size:t.size}),Me(e,{size:t.size})):e}function Ti(r,t={}){let e="";for(let i=0;i<r.length;i++)e+=Xn[r[i]];const s=`0x${e}`;return typeof t.size=="number"?(Ue(s,{size:t.size}),Me(s,{dir:"right",size:t.size})):s}function ge(r,t={}){const{signed:e,size:s}=t,i=BigInt(r);let n;s?e?n=(1n<<BigInt(s)*8n-1n)-1n:n=2n**(BigInt(s)*8n)-1n:typeof r=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const a=typeof n=="bigint"&&e?-n-1n:0;if(n&&i>n||i<a){const u=typeof r=="bigint"?"n":"";throw new Si({max:n?`${n}${u}`:void 0,min:`${a}${u}`,signed:e,size:s,value:`${r}${u}`})}const d=`0x${(e&&i<0?(1n<<BigInt(s*8))+BigInt(i):i).toString(16)}`;return s?Me(d,{size:s}):d}const Zn=new TextEncoder;function Ei(r,t={}){const e=Zn.encode(r);return Ti(e,t)}const to=new TextEncoder;function eo(r,t={}){return typeof r=="number"||typeof r=="bigint"?so(r,t):typeof r=="boolean"?ro(r,t):ir(r)?Pi(r,t):Ai(r,t)}function ro(r,t={}){const e=new Uint8Array(1);return e[0]=Number(r),typeof t.size=="number"?(Ue(e,{size:t.size}),Me(e,{size:t.size})):e}const le={zero:48,nine:57,A:65,F:70,a:97,f:102};function Os(r){if(r>=le.zero&&r<=le.nine)return r-le.zero;if(r>=le.A&&r<=le.F)return r-(le.A-10);if(r>=le.a&&r<=le.f)return r-(le.a-10)}function Pi(r,t={}){let e=r;t.size&&(Ue(e,{size:t.size}),e=Me(e,{dir:"right",size:t.size}));let s=e.slice(2);s.length%2&&(s=`0${s}`);const i=s.length/2,n=new Uint8Array(i);for(let a=0,d=0;a<i;a++){const u=Os(s.charCodeAt(d++)),p=Os(s.charCodeAt(d++));if(u===void 0||p===void 0)throw new _t(`Invalid byte sequence ("${s[d-2]}${s[d-1]}" in "${s}").`);n[a]=u*16+p}return n}function so(r,t){const e=ge(r,t);return Pi(e)}function Ai(r,t={}){const e=to.encode(r);return typeof t.size=="number"?(Ue(e,{size:t.size}),Me(e,{dir:"right",size:t.size})):e}const He=BigInt(2**32-1),$s=BigInt(32);function io(r,t=!1){return t?{h:Number(r&He),l:Number(r>>$s&He)}:{h:Number(r>>$s&He)|0,l:Number(r&He)|0}}function no(r,t=!1){const e=r.length;let s=new Uint32Array(e),i=new Uint32Array(e);for(let n=0;n<e;n++){const{h:a,l:d}=io(r[n],t);[s[n],i[n]]=[a,d]}return[s,i]}const oo=(r,t,e)=>r<<e|t>>>32-e,ao=(r,t,e)=>t<<e|r>>>32-e,co=(r,t,e)=>t<<e-32|r>>>64-e,lo=(r,t,e)=>r<<e-32|t>>>64-e;function ho(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Cs(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Xe(r,...t){if(!ho(r))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(r.length))throw new Error("Uint8Array expected of length "+t+", got length="+r.length)}function Rs(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function uo(r,t){Xe(r);const e=t.outputLen;if(r.length<e)throw new Error("digestInto() expects output buffer of length at least "+e)}function fo(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function Mi(...r){for(let t=0;t<r.length;t++)r[t].fill(0)}const go=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function po(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}function mo(r){for(let t=0;t<r.length;t++)r[t]=po(r[t]);return r}const _s=go?r=>r:mo;function yo(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function xi(r){return typeof r=="string"&&(r=yo(r)),Xe(r),r}class wo{}function vo(r){const t=s=>r().update(xi(s)).digest(),e=r();return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=()=>r(),t}const So=BigInt(0),Oe=BigInt(1),bo=BigInt(2),To=BigInt(7),Eo=BigInt(256),Po=BigInt(113),Ii=[],ki=[],Oi=[];for(let r=0,t=Oe,e=1,s=0;r<24;r++){[e,s]=[s,(2*e+3*s)%5],Ii.push(2*(5*s+e)),ki.push((r+1)*(r+2)/2%64);let i=So;for(let n=0;n<7;n++)t=(t<<Oe^(t>>To)*Po)%Eo,t&bo&&(i^=Oe<<(Oe<<BigInt(n))-Oe);Oi.push(i)}const $i=no(Oi,!0),Ao=$i[0],Mo=$i[1],Ns=(r,t,e)=>e>32?co(r,t,e):oo(r,t,e),Fs=(r,t,e)=>e>32?lo(r,t,e):ao(r,t,e);function xo(r,t=24){const e=new Uint32Array(10);for(let s=24-t;s<24;s++){for(let a=0;a<10;a++)e[a]=r[a]^r[a+10]^r[a+20]^r[a+30]^r[a+40];for(let a=0;a<10;a+=2){const d=(a+8)%10,u=(a+2)%10,p=e[u],w=e[u+1],f=Ns(p,w,1)^e[d],x=Fs(p,w,1)^e[d+1];for(let T=0;T<50;T+=10)r[a+T]^=f,r[a+T+1]^=x}let i=r[2],n=r[3];for(let a=0;a<24;a++){const d=ki[a],u=Ns(i,n,d),p=Fs(i,n,d),w=Ii[a];i=r[w],n=r[w+1],r[w]=u,r[w+1]=p}for(let a=0;a<50;a+=10){for(let d=0;d<10;d++)e[d]=r[a+d];for(let d=0;d<10;d++)r[a+d]^=~e[(d+2)%10]&e[(d+4)%10]}r[0]^=Ao[s],r[1]^=Mo[s]}Mi(e)}class Zr extends wo{constructor(t,e,s,i=!1,n=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=t,this.suffix=e,this.outputLen=s,this.enableXOF=i,this.rounds=n,Cs(s),!(0<t&&t<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=fo(this.state)}clone(){return this._cloneInto()}keccak(){_s(this.state32),xo(this.state32,this.rounds),_s(this.state32),this.posOut=0,this.pos=0}update(t){Rs(this),t=xi(t),Xe(t);const{blockLen:e,state:s}=this,i=t.length;for(let n=0;n<i;){const a=Math.min(e-this.pos,i-n);for(let d=0;d<a;d++)s[this.pos++]^=t[n++];this.pos===e&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:e,pos:s,blockLen:i}=this;t[s]^=e,(e&128)!==0&&s===i-1&&this.keccak(),t[i-1]^=128,this.keccak()}writeInto(t){Rs(this,!1),Xe(t),this.finish();const e=this.state,{blockLen:s}=this;for(let i=0,n=t.length;i<n;){this.posOut>=s&&this.keccak();const a=Math.min(s-this.posOut,n-i);t.set(e.subarray(this.posOut,this.posOut+a),i),this.posOut+=a,i+=a}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return Cs(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(uo(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Mi(this.state)}_cloneInto(t){const{blockLen:e,suffix:s,outputLen:i,rounds:n,enableXOF:a}=this;return t||(t=new Zr(e,s,i,a,n)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=n,t.suffix=s,t.outputLen=i,t.enableXOF=a,t.destroyed=this.destroyed,t}}const Io=(r,t,e)=>vo(()=>new Zr(t,r,e)),ko=Io(1,136,256/8);function ue(r,t){const e=t||"hex",s=ko(ir(r,{strict:!1})?eo(r):r);return e==="bytes"?s:Xr(s)}class Ci extends _t{constructor({address:t}){super(`Address "${t}" is invalid.`,{metaMessages:["- Address must be a hex value of 20 bytes (40 hex characters).","- Address must match its checksum counterpart."],name:"InvalidAddressError"})}}class Ri extends Map{constructor(t){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=t}get(t){const e=super.get(t);return super.has(t)&&e!==void 0&&(this.delete(t),super.set(t,e)),e}set(t,e){if(super.set(t,e),this.maxSize&&this.size>this.maxSize){const s=this.keys().next().value;s&&this.delete(s)}return this}}const $r=new Ri(8192);function Oo(r,t){if($r.has(`${r}.${t}`))return $r.get(`${r}.${t}`);const e=r.substring(2).toLowerCase(),s=ue(Ai(e),"bytes"),i=e.split("");for(let a=0;a<40;a+=2)s[a>>1]>>4>=8&&i[a]&&(i[a]=i[a].toUpperCase()),(s[a>>1]&15)>=8&&i[a+1]&&(i[a+1]=i[a+1].toUpperCase());const n=`0x${i.join("")}`;return $r.set(`${r}.${t}`,n),n}const $o=/^0x[a-fA-F0-9]{40}$/,Cr=new Ri(8192);function _i(r,t){const{strict:e=!0}={},s=`${r}.${e}`;if(Cr.has(s))return Cr.get(s);const i=$o.test(r)?r.toLowerCase()===r?!0:e?Oo(r)===r:!0:!1;return Cr.set(s,i),i}function we(r){return typeof r[0]=="string"?Ro(r):Co(r)}function Co(r){let t=0;for(const i of r)t+=i.length;const e=new Uint8Array(t);let s=0;for(const i of r)e.set(i,s),s+=i.length;return e}function Ro(r){return`0x${r.reduce((t,e)=>t+e.replace("0x",""),"")}`}function _o(r,t,e,{strict:s}={}){return ir(r,{strict:!1})?Fo(r,t,e,{strict:s}):No(r,t,e,{strict:s})}function Ni(r,t){if(typeof t=="number"&&t>0&&t>Kt(r)-1)throw new wi({offset:t,position:"start",size:Kt(r)})}function Fi(r,t,e){if(typeof t=="number"&&typeof e=="number"&&Kt(r)!==e-t)throw new wi({offset:e,position:"end",size:Kt(r)})}function No(r,t,e,{strict:s}={}){Ni(r,t);const i=r.slice(t,e);return s&&Fi(i,t,e),i}function Fo(r,t,e,{strict:s}={}){Ni(r,t);const i=`0x${r.replace("0x","").slice((t??0)*2,(e??r.length)*2)}`;return s&&Fi(i,t,e),i}const Lo=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,Li=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function Di(r,t){if(r.length!==t.length)throw new Wn({expectedLength:r.length,givenLength:t.length});const e=Do({params:r,values:t}),s=es(e);return s.length===0?"0x":s}function Do({params:r,values:t}){const e=[];for(let s=0;s<r.length;s++)e.push(ts({param:r[s],value:t[s]}));return e}function ts({param:r,value:t}){const e=Wo(r.type);if(e){const[s,i]=e;return Bo(t,{length:s,param:{...r,type:i}})}if(r.type==="tuple")return jo(t,{param:r});if(r.type==="address")return Uo(t);if(r.type==="bool")return qo(t);if(r.type.startsWith("uint")||r.type.startsWith("int")){const s=r.type.startsWith("int"),[,,i="256"]=Li.exec(r.type)??[];return Go(t,{signed:s,size:Number(i)})}if(r.type.startsWith("bytes"))return zo(t,{param:r});if(r.type==="string")return Ho(t);throw new Yn(r.type,{docsPath:"/docs/contract/encodeAbiParameters"})}function es(r){let t=0;for(let n=0;n<r.length;n++){const{dynamic:a,encoded:d}=r[n];a?t+=32:t+=Kt(d)}const e=[],s=[];let i=0;for(let n=0;n<r.length;n++){const{dynamic:a,encoded:d}=r[n];a?(e.push(ge(t+i,{size:32})),s.push(d),i+=Kt(d)):e.push(d)}return we([...e,...s])}function Uo(r){if(!_i(r))throw new Ci({address:r});return{dynamic:!1,encoded:fe(r.toLowerCase())}}function Bo(r,{length:t,param:e}){const s=t===null;if(!Array.isArray(r))throw new Vn(r);if(!s&&r.length!==t)throw new Hn({expectedLength:t,givenLength:r.length,type:`${e.type}[${t}]`});let i=!1;const n=[];for(let a=0;a<r.length;a++){const d=ts({param:e,value:r[a]});d.dynamic&&(i=!0),n.push(d)}if(s||i){const a=es(n);if(s){const d=ge(n.length,{size:32});return{dynamic:!0,encoded:n.length>0?we([d,a]):d}}if(i)return{dynamic:!0,encoded:a}}return{dynamic:!1,encoded:we(n.map(({encoded:a})=>a))}}function zo(r,{param:t}){const[,e]=t.type.split("bytes"),s=Kt(r);if(!e){let i=r;return s%32!==0&&(i=fe(i,{dir:"right",size:Math.ceil((r.length-2)/2/32)*32})),{dynamic:!0,encoded:we([fe(ge(s,{size:32})),i])}}if(s!==Number.parseInt(e,10))throw new jn({expectedSize:Number.parseInt(e,10),value:r});return{dynamic:!1,encoded:fe(r,{dir:"right"})}}function qo(r){if(typeof r!="boolean")throw new _t(`Invalid boolean value: "${r}" (type: ${typeof r}). Expected: \`true\` or \`false\`.`);return{dynamic:!1,encoded:fe(bi(r))}}function Go(r,{signed:t,size:e=256}){if(typeof e=="number"){const s=2n**(BigInt(e)-(t?1n:0n))-1n,i=t?-s-1n:0n;if(r>s||r<i)throw new Si({max:s.toString(),min:i.toString(),signed:t,size:e/8,value:r.toString()})}return{dynamic:!1,encoded:ge(r,{size:32,signed:t})}}function Ho(r){const t=Ei(r),e=Math.ceil(Kt(t)/32),s=[];for(let i=0;i<e;i++)s.push(fe(_o(t,i*32,(i+1)*32),{dir:"right"}));return{dynamic:!0,encoded:we([fe(ge(Kt(t),{size:32})),...s])}}function jo(r,{param:t}){let e=!1;const s=[];for(let i=0;i<t.components.length;i++){const n=t.components[i],a=Array.isArray(r)?i:n.name,d=ts({param:n,value:r[a]});s.push(d),d.dynamic&&(e=!0)}return{dynamic:e,encoded:e?es(s):we(s.map(({encoded:i})=>i))}}function Wo(r){const t=r.match(/^(.*)\[(\d+)?\]$/);return t?[t[2]?Number(t[2]):null,t[1]]:void 0}const Ko=(r,t,e)=>JSON.stringify(r,(s,i)=>typeof i=="bigint"?i.toString():i,e);class Yo extends _t{constructor({domain:t}){super(`Invalid domain "${Ko(t)}".`,{metaMessages:["Must be a valid EIP-712 domain."]})}}class Vo extends _t{constructor({primaryType:t,types:e}){super(`Invalid primary type \`${t}\` must be one of \`${JSON.stringify(Object.keys(e))}\`.`,{docsPath:"/api/glossary/Errors#typeddatainvalidprimarytypeerror",metaMessages:["Check that the primary type is a key in `types`."]})}}class Jo extends _t{constructor({type:t}){super(`Struct type "${t}" is invalid.`,{metaMessages:["Struct type must not be a Solidity type."],name:"InvalidStructTypeError"})}}function Qo(r){const{domain:t,message:e,primaryType:s,types:i}=r,n=(a,d)=>{for(const u of a){const{name:p,type:w}=u,f=d[p],x=w.match(Li);if(x&&(typeof f=="number"||typeof f=="bigint")){const[P,M,k]=x;ge(f,{signed:M==="int",size:Number.parseInt(k,10)/8})}if(w==="address"&&typeof f=="string"&&!_i(f))throw new Ci({address:f});const T=w.match(Lo);if(T){const[P,M]=T;if(M&&Kt(f)!==Number.parseInt(M,10))throw new Kn({expectedSize:Number.parseInt(M,10),givenSize:Kt(f)})}const S=i[w];S&&(Zo(w),n(S,f))}};if(i.EIP712Domain&&t){if(typeof t!="object")throw new Yo({domain:t});n(i.EIP712Domain,t)}if(s!=="EIP712Domain")if(i[s])n(i[s],e);else throw new Vo({primaryType:s,types:i})}function Xo({domain:r}){return[typeof r?.name=="string"&&{name:"name",type:"string"},r?.version&&{name:"version",type:"string"},(typeof r?.chainId=="number"||typeof r?.chainId=="bigint")&&{name:"chainId",type:"uint256"},r?.verifyingContract&&{name:"verifyingContract",type:"address"},r?.salt&&{name:"salt",type:"bytes32"}].filter(Boolean)}function Zo(r){if(r==="address"||r==="bool"||r==="string"||r.startsWith("bytes")||r.startsWith("uint")||r.startsWith("int"))throw new Jo({type:r})}function ta(r){const{domain:t={},message:e,primaryType:s}=r,i={EIP712Domain:Xo({domain:t}),...r.types};Qo({domain:t,message:e,primaryType:s,types:i});const n=["0x1901"];return t&&n.push(ea({domain:t,types:i})),s!=="EIP712Domain"&&n.push(Ui({data:e,primaryType:s,types:i})),ue(we(n))}function ea({domain:r,types:t}){return Ui({data:r,primaryType:"EIP712Domain",types:t})}function Ui({data:r,primaryType:t,types:e}){const s=Bi({data:r,primaryType:t,types:e});return ue(s)}function Bi({data:r,primaryType:t,types:e}){const s=[{type:"bytes32"}],i=[ra({primaryType:t,types:e})];for(const n of e[t]){const[a,d]=qi({types:e,name:n.name,type:n.type,value:r[n.name]});s.push(a),i.push(d)}return Di(s,i)}function ra({primaryType:r,types:t}){const e=Xr(sa({primaryType:r,types:t}));return ue(e)}function sa({primaryType:r,types:t}){let e="";const s=zi({primaryType:r,types:t});s.delete(r);const i=[r,...Array.from(s).sort()];for(const n of i)e+=`${n}(${t[n].map(({name:a,type:d})=>`${d} ${a}`).join(",")})`;return e}function zi({primaryType:r,types:t},e=new Set){const i=r.match(/^\w*/u)?.[0];if(e.has(i)||t[i]===void 0)return e;e.add(i);for(const n of t[i])zi({primaryType:n.type,types:t},e);return e}function qi({types:r,name:t,type:e,value:s}){if(r[e]!==void 0)return[{type:"bytes32"},ue(Bi({data:s,primaryType:e,types:r}))];if(e==="bytes")return[{type:"bytes32"},ue(s)];if(e==="string")return[{type:"bytes32"},ue(Xr(s))];if(e.lastIndexOf("]")===e.length-1){const i=e.slice(0,e.lastIndexOf("[")),n=s.map(a=>qi({name:t,type:i,types:r,value:a}));return[{type:"bytes32"},ue(Di(n.map(([a])=>a),n.map(([,a])=>a)))]}return[{type:e},s]}var Ze;(function(r){r[r.EOA=0]="EOA",r[r.POLY_PROXY=1]="POLY_PROXY",r[r.POLY_GNOSIS_SAFE=2]="POLY_GNOSIS_SAFE"})(Ze||(Ze={}));function ia(){return Math.round(Math.random()*Date.now())+""}class na{contractAddress;chainId;signer;generateSalt;constructor(t,e,s,i=ia){this.contractAddress=t,this.chainId=e,this.signer=s,this.generateSalt=i}async buildSignedOrder(t){const e=await this.buildOrder(t),s=this.buildOrderTypedData(e),i=await this.buildOrderSignature(s);return{...e,signature:i}}async buildOrder({maker:t,taker:e,tokenId:s,makerAmount:i,takerAmount:n,side:a,feeRateBps:d,nonce:u,signer:p,expiration:w,signatureType:f}){(typeof p>"u"||!p)&&(p=t);const x=await this.signer.getAddress();if(p!==x)throw new Error("signer does not match");return(typeof w>"u"||!w)&&(w="0"),(typeof f>"u"||!f)&&(f=Ze.EOA),{salt:this.generateSalt(),maker:t,signer:p,taker:e,tokenId:s,makerAmount:i,takerAmount:n,expiration:w,nonce:u,feeRateBps:d,side:a,signatureType:f}}buildOrderTypedData(t){return{primaryType:"Order",types:{EIP712Domain:qn,Order:Gn},domain:{name:Bn,version:zn,chainId:this.chainId,verifyingContract:this.contractAddress},message:{salt:t.salt,maker:t.maker,signer:t.signer,taker:t.taker,tokenId:t.tokenId,makerAmount:t.makerAmount,takerAmount:t.takerAmount,expiration:t.expiration,nonce:t.nonce,feeRateBps:t.feeRateBps,side:t.side,signatureType:t.signatureType}}}buildOrderSignature(t){return delete t.types.EIP712Domain,this.signer._signTypedData(t.domain,t.types,t.message)}buildOrderHash(t){return ta(t)}}var ve;(function(r){r[r.BUY=0]="BUY",r[r.SELL=1]="SELL"})(ve||(ve={}));var Rt;(function(r){r.BUY="BUY",r.SELL="SELL"})(Rt||(Rt={}));var ee;(function(r){r.GTC="GTC",r.FOK="FOK",r.GTD="GTD",r.FAK="FAK"})(ee||(ee={}));var zr;(function(r){r[r.POLYGON=137]="POLYGON",r[r.AMOY=80002]="AMOY"})(zr||(zr={}));var qr;(function(r){r.MAX="max",r.ONE_WEEK="1w",r.ONE_DAY="1d",r.SIX_HOURS="6h",r.ONE_HOUR="1h"})(qr||(qr={}));var Gr;(function(r){r.COLLATERAL="COLLATERAL",r.CONDITIONAL="CONDITIONAL"})(Gr||(Gr={}));var Te;(function(r){r.COMPLEMENTARY="COMPLEMENTARY",r.MERGE="MERGE",r.MINT="MINT"})(Te||(Te={}));const oa="This message attests that I control the given wallet",aa=async(r,t,e,s)=>{const i=await r.getAddress(),n=`${e}`,a={name:"ClobAuthDomain",version:"1",chainId:t},d={ClobAuth:[{name:"address",type:"address"},{name:"timestamp",type:"string"},{name:"nonce",type:"uint256"},{name:"message",type:"string"}]},u={address:i,timestamp:n,nonce:s,message:oa};return await r._signTypedData(a,d,u)};function Ls(r,t,e){return r.split(t).join(e)}function ca(r){const t=r.replace(/-/g,"+").replace(/_/g,"/").replace(/[^A-Za-z0-9+/=]/g,""),e=atob(t),s=new Uint8Array(e.length);for(let i=0;i<e.length;i++)s[i]=e.charCodeAt(i);return s.buffer}function la(r){const t=new Uint8Array(r);let e="";for(let s=0;s<t.byteLength;s++)e+=String.fromCharCode(t[s]);return btoa(e)}const da=async(r,t,e,s,i)=>{let n=t+e+s;i!==void 0&&(n+=i);const a=ca(r),d=await globalThis.crypto.subtle.importKey("raw",a,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),u=new TextEncoder().encode(n),p=await globalThis.crypto.subtle.sign("HMAC",d,u),w=la(p);return Ls(Ls(w,"+","-"),"/","_")},Hr=async(r,t,e,s)=>{let i=Math.floor(Date.now()/1e3);s!==void 0&&(i=s);let n=0;e!==void 0&&(n=e);const a=await aa(r,t,i,n);return{POLY_ADDRESS:await r.getAddress(),POLY_SIGNATURE:a,POLY_TIMESTAMP:`${i}`,POLY_NONCE:`${n}`}},L=async(r,t,e,s)=>{let i=Math.floor(Date.now()/1e3);s!==void 0&&(i=s);const n=await r.getAddress(),a=await da(t.secret,i,e.method,e.requestPath,e.body);return{POLY_ADDRESS:n,POLY_SIGNATURE:a,POLY_TIMESTAMP:`${i}`,POLY_API_KEY:t.key,POLY_PASSPHRASE:t.passphrase}},Gi=(r,t)=>({...r,...t});function Hi(r,t){return function(){return r.apply(t,arguments)}}const{toString:ha}=Object.prototype,{getPrototypeOf:rs}=Object,{iterator:nr,toStringTag:ji}=Symbol,or=(r=>t=>{const e=ha.call(t);return r[e]||(r[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),oe=r=>(r=r.toLowerCase(),t=>or(t)===r),ar=r=>t=>typeof t===r,{isArray:xe}=Array,Ae=ar("undefined");function Be(r){return r!==null&&!Ae(r)&&r.constructor!==null&&!Ae(r.constructor)&&jt(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const Wi=oe("ArrayBuffer");function ua(r){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(r):t=r&&r.buffer&&Wi(r.buffer),t}const fa=ar("string"),jt=ar("function"),Ki=ar("number"),ze=r=>r!==null&&typeof r=="object",ga=r=>r===!0||r===!1,Ke=r=>{if(or(r)!=="object")return!1;const t=rs(r);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(ji in r)&&!(nr in r)},pa=r=>{if(!ze(r)||Be(r))return!1;try{return Object.keys(r).length===0&&Object.getPrototypeOf(r)===Object.prototype}catch{return!1}},ma=oe("Date"),ya=oe("File"),wa=oe("Blob"),va=oe("FileList"),Sa=r=>ze(r)&&jt(r.pipe),ba=r=>{let t;return r&&(typeof FormData=="function"&&r instanceof FormData||jt(r.append)&&((t=or(r))==="formdata"||t==="object"&&jt(r.toString)&&r.toString()==="[object FormData]"))},Ta=oe("URLSearchParams"),[Ea,Pa,Aa,Ma]=["ReadableStream","Request","Response","Headers"].map(oe),xa=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function qe(r,t,{allOwnKeys:e=!1}={}){if(r===null||typeof r>"u")return;let s,i;if(typeof r!="object"&&(r=[r]),xe(r))for(s=0,i=r.length;s<i;s++)t.call(null,r[s],s,r);else{if(Be(r))return;const n=e?Object.getOwnPropertyNames(r):Object.keys(r),a=n.length;let d;for(s=0;s<a;s++)d=n[s],t.call(null,r[d],d,r)}}function Yi(r,t){if(Be(r))return null;t=t.toLowerCase();const e=Object.keys(r);let s=e.length,i;for(;s-- >0;)if(i=e[s],t===i.toLowerCase())return i;return null}const pe=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Vi=r=>!Ae(r)&&r!==pe;function jr(){const{caseless:r,skipUndefined:t}=Vi(this)&&this||{},e={},s=(i,n)=>{const a=r&&Yi(e,n)||n;Ke(e[a])&&Ke(i)?e[a]=jr(e[a],i):Ke(i)?e[a]=jr({},i):xe(i)?e[a]=i.slice():(!t||!Ae(i))&&(e[a]=i)};for(let i=0,n=arguments.length;i<n;i++)arguments[i]&&qe(arguments[i],s);return e}const Ia=(r,t,e,{allOwnKeys:s}={})=>(qe(t,(i,n)=>{e&&jt(i)?r[n]=Hi(i,e):r[n]=i},{allOwnKeys:s}),r),ka=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),Oa=(r,t,e,s)=>{r.prototype=Object.create(t.prototype,s),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:t.prototype}),e&&Object.assign(r.prototype,e)},$a=(r,t,e,s)=>{let i,n,a;const d={};if(t=t||{},r==null)return t;do{for(i=Object.getOwnPropertyNames(r),n=i.length;n-- >0;)a=i[n],(!s||s(a,r,t))&&!d[a]&&(t[a]=r[a],d[a]=!0);r=e!==!1&&rs(r)}while(r&&(!e||e(r,t))&&r!==Object.prototype);return t},Ca=(r,t,e)=>{r=String(r),(e===void 0||e>r.length)&&(e=r.length),e-=t.length;const s=r.indexOf(t,e);return s!==-1&&s===e},Ra=r=>{if(!r)return null;if(xe(r))return r;let t=r.length;if(!Ki(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=r[t];return e},_a=(r=>t=>r&&t instanceof r)(typeof Uint8Array<"u"&&rs(Uint8Array)),Na=(r,t)=>{const s=(r&&r[nr]).call(r);let i;for(;(i=s.next())&&!i.done;){const n=i.value;t.call(r,n[0],n[1])}},Fa=(r,t)=>{let e;const s=[];for(;(e=r.exec(t))!==null;)s.push(e);return s},La=oe("HTMLFormElement"),Da=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,s,i){return s.toUpperCase()+i}),Ds=(({hasOwnProperty:r})=>(t,e)=>r.call(t,e))(Object.prototype),Ua=oe("RegExp"),Ji=(r,t)=>{const e=Object.getOwnPropertyDescriptors(r),s={};qe(e,(i,n)=>{let a;(a=t(i,n,r))!==!1&&(s[n]=a||i)}),Object.defineProperties(r,s)},Ba=r=>{Ji(r,(t,e)=>{if(jt(r)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const s=r[e];if(jt(s)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},za=(r,t)=>{const e={},s=i=>{i.forEach(n=>{e[n]=!0})};return xe(r)?s(r):s(String(r).split(t)),e},qa=()=>{},Ga=(r,t)=>r!=null&&Number.isFinite(r=+r)?r:t;function Ha(r){return!!(r&&jt(r.append)&&r[ji]==="FormData"&&r[nr])}const ja=r=>{const t=new Array(10),e=(s,i)=>{if(ze(s)){if(t.indexOf(s)>=0)return;if(Be(s))return s;if(!("toJSON"in s)){t[i]=s;const n=xe(s)?[]:{};return qe(s,(a,d)=>{const u=e(a,i+1);!Ae(u)&&(n[d]=u)}),t[i]=void 0,n}}return s};return e(r,0)},Wa=oe("AsyncFunction"),Ka=r=>r&&(ze(r)||jt(r))&&jt(r.then)&&jt(r.catch),Qi=((r,t)=>r?setImmediate:t?((e,s)=>(pe.addEventListener("message",({source:i,data:n})=>{i===pe&&n===e&&s.length&&s.shift()()},!1),i=>{s.push(i),pe.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",jt(pe.postMessage)),Ya=typeof queueMicrotask<"u"?queueMicrotask.bind(pe):typeof process<"u"&&process.nextTick||Qi,Va=r=>r!=null&&jt(r[nr]),I={isArray:xe,isArrayBuffer:Wi,isBuffer:Be,isFormData:ba,isArrayBufferView:ua,isString:fa,isNumber:Ki,isBoolean:ga,isObject:ze,isPlainObject:Ke,isEmptyObject:pa,isReadableStream:Ea,isRequest:Pa,isResponse:Aa,isHeaders:Ma,isUndefined:Ae,isDate:ma,isFile:ya,isBlob:wa,isRegExp:Ua,isFunction:jt,isStream:Sa,isURLSearchParams:Ta,isTypedArray:_a,isFileList:va,forEach:qe,merge:jr,extend:Ia,trim:xa,stripBOM:ka,inherits:Oa,toFlatObject:$a,kindOf:or,kindOfTest:oe,endsWith:Ca,toArray:Ra,forEachEntry:Na,matchAll:Fa,isHTMLForm:La,hasOwnProperty:Ds,hasOwnProp:Ds,reduceDescriptors:Ji,freezeMethods:Ba,toObjectSet:za,toCamelCase:Da,noop:qa,toFiniteNumber:Ga,findKey:Yi,global:pe,isContextDefined:Vi,isSpecCompliantForm:Ha,toJSONObject:ja,isAsyncFn:Wa,isThenable:Ka,setImmediate:Qi,asap:Ya,isIterable:Va};function F(r,t,e,s,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),s&&(this.request=s),i&&(this.response=i,this.status=i.status?i.status:null)}I.inherits(F,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:I.toJSONObject(this.config),code:this.code,status:this.status}}});const Xi=F.prototype,Zi={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{Zi[r]={value:r}});Object.defineProperties(F,Zi);Object.defineProperty(Xi,"isAxiosError",{value:!0});F.from=(r,t,e,s,i,n)=>{const a=Object.create(Xi);I.toFlatObject(r,a,function(w){return w!==Error.prototype},p=>p!=="isAxiosError");const d=r&&r.message?r.message:"Error",u=t==null&&r?r.code:t;return F.call(a,d,u,e,s,i),r&&a.cause==null&&Object.defineProperty(a,"cause",{value:r,configurable:!0}),a.name=r&&r.name||"Error",n&&Object.assign(a,n),a};const Ja=null;function Wr(r){return I.isPlainObject(r)||I.isArray(r)}function tn(r){return I.endsWith(r,"[]")?r.slice(0,-2):r}function Us(r,t,e){return r?r.concat(t).map(function(i,n){return i=tn(i),!e&&n?"["+i+"]":i}).join(e?".":""):t}function Qa(r){return I.isArray(r)&&!r.some(Wr)}const Xa=I.toFlatObject(I,{},null,function(t){return/^is[A-Z]/.test(t)});function cr(r,t,e){if(!I.isObject(r))throw new TypeError("target must be an object");t=t||new FormData,e=I.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(P,M){return!I.isUndefined(M[P])});const s=e.metaTokens,i=e.visitor||w,n=e.dots,a=e.indexes,u=(e.Blob||typeof Blob<"u"&&Blob)&&I.isSpecCompliantForm(t);if(!I.isFunction(i))throw new TypeError("visitor must be a function");function p(S){if(S===null)return"";if(I.isDate(S))return S.toISOString();if(I.isBoolean(S))return S.toString();if(!u&&I.isBlob(S))throw new F("Blob is not supported. Use a Buffer instead.");return I.isArrayBuffer(S)||I.isTypedArray(S)?u&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function w(S,P,M){let k=S;if(S&&!M&&typeof S=="object"){if(I.endsWith(P,"{}"))P=s?P:P.slice(0,-2),S=JSON.stringify(S);else if(I.isArray(S)&&Qa(S)||(I.isFileList(S)||I.endsWith(P,"[]"))&&(k=I.toArray(S)))return P=tn(P),k.forEach(function(O,C){!(I.isUndefined(O)||O===null)&&t.append(a===!0?Us([P],C,n):a===null?P:P+"[]",p(O))}),!1}return Wr(S)?!0:(t.append(Us(M,P,n),p(S)),!1)}const f=[],x=Object.assign(Xa,{defaultVisitor:w,convertValue:p,isVisitable:Wr});function T(S,P){if(!I.isUndefined(S)){if(f.indexOf(S)!==-1)throw Error("Circular reference detected in "+P.join("."));f.push(S),I.forEach(S,function(k,$){(!(I.isUndefined(k)||k===null)&&i.call(t,k,I.isString($)?$.trim():$,P,x))===!0&&T(k,P?P.concat($):[$])}),f.pop()}}if(!I.isObject(r))throw new TypeError("data must be an object");return T(r),t}function Bs(r){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function ss(r,t){this._pairs=[],r&&cr(r,this,t)}const en=ss.prototype;en.append=function(t,e){this._pairs.push([t,e])};en.toString=function(t){const e=t?function(s){return t.call(this,s,Bs)}:Bs;return this._pairs.map(function(i){return e(i[0])+"="+e(i[1])},"").join("&")};function Za(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function rn(r,t,e){if(!t)return r;const s=e&&e.encode||Za;I.isFunction(e)&&(e={serialize:e});const i=e&&e.serialize;let n;if(i?n=i(t,e):n=I.isURLSearchParams(t)?t.toString():new ss(t,e).toString(s),n){const a=r.indexOf("#");a!==-1&&(r=r.slice(0,a)),r+=(r.indexOf("?")===-1?"?":"&")+n}return r}class zs{constructor(){this.handlers=[]}use(t,e,s){return this.handlers.push({fulfilled:t,rejected:e,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){I.forEach(this.handlers,function(s){s!==null&&t(s)})}}const sn={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},tc=typeof URLSearchParams<"u"?URLSearchParams:ss,ec=typeof FormData<"u"?FormData:null,rc=typeof Blob<"u"?Blob:null,sc={isBrowser:!0,classes:{URLSearchParams:tc,FormData:ec,Blob:rc},protocols:["http","https","file","blob","url","data"]},is=typeof window<"u"&&typeof document<"u",Kr=typeof navigator=="object"&&navigator||void 0,ic=is&&(!Kr||["ReactNative","NativeScript","NS"].indexOf(Kr.product)<0),nc=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",oc=is&&window.location.href||"http://localhost",ac=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:is,hasStandardBrowserEnv:ic,hasStandardBrowserWebWorkerEnv:nc,navigator:Kr,origin:oc},Symbol.toStringTag,{value:"Module"})),Ut={...ac,...sc};function cc(r,t){return cr(r,new Ut.classes.URLSearchParams,{visitor:function(e,s,i,n){return Ut.isNode&&I.isBuffer(e)?(this.append(s,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)},...t})}function lc(r){return I.matchAll(/\w+|\[(\w*)]/g,r).map(t=>t[0]==="[]"?"":t[1]||t[0])}function dc(r){const t={},e=Object.keys(r);let s;const i=e.length;let n;for(s=0;s<i;s++)n=e[s],t[n]=r[n];return t}function nn(r){function t(e,s,i,n){let a=e[n++];if(a==="__proto__")return!0;const d=Number.isFinite(+a),u=n>=e.length;return a=!a&&I.isArray(i)?i.length:a,u?(I.hasOwnProp(i,a)?i[a]=[i[a],s]:i[a]=s,!d):((!i[a]||!I.isObject(i[a]))&&(i[a]=[]),t(e,s,i[a],n)&&I.isArray(i[a])&&(i[a]=dc(i[a])),!d)}if(I.isFormData(r)&&I.isFunction(r.entries)){const e={};return I.forEachEntry(r,(s,i)=>{t(lc(s),i,e,0)}),e}return null}function hc(r,t,e){if(I.isString(r))try{return(t||JSON.parse)(r),I.trim(r)}catch(s){if(s.name!=="SyntaxError")throw s}return(e||JSON.stringify)(r)}const Ge={transitional:sn,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const s=e.getContentType()||"",i=s.indexOf("application/json")>-1,n=I.isObject(t);if(n&&I.isHTMLForm(t)&&(t=new FormData(t)),I.isFormData(t))return i?JSON.stringify(nn(t)):t;if(I.isArrayBuffer(t)||I.isBuffer(t)||I.isStream(t)||I.isFile(t)||I.isBlob(t)||I.isReadableStream(t))return t;if(I.isArrayBufferView(t))return t.buffer;if(I.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let d;if(n){if(s.indexOf("application/x-www-form-urlencoded")>-1)return cc(t,this.formSerializer).toString();if((d=I.isFileList(t))||s.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return cr(d?{"files[]":t}:t,u&&new u,this.formSerializer)}}return n||i?(e.setContentType("application/json",!1),hc(t)):t}],transformResponse:[function(t){const e=this.transitional||Ge.transitional,s=e&&e.forcedJSONParsing,i=this.responseType==="json";if(I.isResponse(t)||I.isReadableStream(t))return t;if(t&&I.isString(t)&&(s&&!this.responseType||i)){const a=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(t,this.parseReviver)}catch(d){if(a)throw d.name==="SyntaxError"?F.from(d,F.ERR_BAD_RESPONSE,this,null,this.response):d}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ut.classes.FormData,Blob:Ut.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};I.forEach(["delete","get","head","post","put","patch"],r=>{Ge.headers[r]={}});const uc=I.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),fc=r=>{const t={};let e,s,i;return r&&r.split(`
`).forEach(function(a){i=a.indexOf(":"),e=a.substring(0,i).trim().toLowerCase(),s=a.substring(i+1).trim(),!(!e||t[e]&&uc[e])&&(e==="set-cookie"?t[e]?t[e].push(s):t[e]=[s]:t[e]=t[e]?t[e]+", "+s:s)}),t},qs=Symbol("internals");function $e(r){return r&&String(r).trim().toLowerCase()}function Ye(r){return r===!1||r==null?r:I.isArray(r)?r.map(Ye):String(r)}function gc(r){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=e.exec(r);)t[s[1]]=s[2];return t}const pc=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function Rr(r,t,e,s,i){if(I.isFunction(s))return s.call(this,t,e);if(i&&(t=e),!!I.isString(t)){if(I.isString(s))return t.indexOf(s)!==-1;if(I.isRegExp(s))return s.test(t)}}function mc(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,s)=>e.toUpperCase()+s)}function yc(r,t){const e=I.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(r,s+e,{value:function(i,n,a){return this[s].call(this,t,i,n,a)},configurable:!0})})}let Wt=class{constructor(t){t&&this.set(t)}set(t,e,s){const i=this;function n(d,u,p){const w=$e(u);if(!w)throw new Error("header name must be a non-empty string");const f=I.findKey(i,w);(!f||i[f]===void 0||p===!0||p===void 0&&i[f]!==!1)&&(i[f||u]=Ye(d))}const a=(d,u)=>I.forEach(d,(p,w)=>n(p,w,u));if(I.isPlainObject(t)||t instanceof this.constructor)a(t,e);else if(I.isString(t)&&(t=t.trim())&&!pc(t))a(fc(t),e);else if(I.isObject(t)&&I.isIterable(t)){let d={},u,p;for(const w of t){if(!I.isArray(w))throw TypeError("Object iterator must return a key-value pair");d[p=w[0]]=(u=d[p])?I.isArray(u)?[...u,w[1]]:[u,w[1]]:w[1]}a(d,e)}else t!=null&&n(e,t,s);return this}get(t,e){if(t=$e(t),t){const s=I.findKey(this,t);if(s){const i=this[s];if(!e)return i;if(e===!0)return gc(i);if(I.isFunction(e))return e.call(this,i,s);if(I.isRegExp(e))return e.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=$e(t),t){const s=I.findKey(this,t);return!!(s&&this[s]!==void 0&&(!e||Rr(this,this[s],s,e)))}return!1}delete(t,e){const s=this;let i=!1;function n(a){if(a=$e(a),a){const d=I.findKey(s,a);d&&(!e||Rr(s,s[d],d,e))&&(delete s[d],i=!0)}}return I.isArray(t)?t.forEach(n):n(t),i}clear(t){const e=Object.keys(this);let s=e.length,i=!1;for(;s--;){const n=e[s];(!t||Rr(this,this[n],n,t,!0))&&(delete this[n],i=!0)}return i}normalize(t){const e=this,s={};return I.forEach(this,(i,n)=>{const a=I.findKey(s,n);if(a){e[a]=Ye(i),delete e[n];return}const d=t?mc(n):String(n).trim();d!==n&&delete e[n],e[d]=Ye(i),s[d]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return I.forEach(this,(s,i)=>{s!=null&&s!==!1&&(e[i]=t&&I.isArray(s)?s.join(", "):s)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const s=new this(t);return e.forEach(i=>s.set(i)),s}static accessor(t){const s=(this[qs]=this[qs]={accessors:{}}).accessors,i=this.prototype;function n(a){const d=$e(a);s[d]||(yc(i,a),s[d]=!0)}return I.isArray(t)?t.forEach(n):n(t),this}};Wt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);I.reduceDescriptors(Wt.prototype,({value:r},t)=>{let e=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(s){this[e]=s}}});I.freezeMethods(Wt);function _r(r,t){const e=this||Ge,s=t||e,i=Wt.from(s.headers);let n=s.data;return I.forEach(r,function(d){n=d.call(e,n,i.normalize(),t?t.status:void 0)}),i.normalize(),n}function on(r){return!!(r&&r.__CANCEL__)}function Ie(r,t,e){F.call(this,r??"canceled",F.ERR_CANCELED,t,e),this.name="CanceledError"}I.inherits(Ie,F,{__CANCEL__:!0});function an(r,t,e){const s=e.config.validateStatus;!e.status||!s||s(e.status)?r(e):t(new F("Request failed with status code "+e.status,[F.ERR_BAD_REQUEST,F.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function wc(r){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return t&&t[1]||""}function vc(r,t){r=r||10;const e=new Array(r),s=new Array(r);let i=0,n=0,a;return t=t!==void 0?t:1e3,function(u){const p=Date.now(),w=s[n];a||(a=p),e[i]=u,s[i]=p;let f=n,x=0;for(;f!==i;)x+=e[f++],f=f%r;if(i=(i+1)%r,i===n&&(n=(n+1)%r),p-a<t)return;const T=w&&p-w;return T?Math.round(x*1e3/T):void 0}}function Sc(r,t){let e=0,s=1e3/t,i,n;const a=(p,w=Date.now())=>{e=w,i=null,n&&(clearTimeout(n),n=null),r(...p)};return[(...p)=>{const w=Date.now(),f=w-e;f>=s?a(p,w):(i=p,n||(n=setTimeout(()=>{n=null,a(i)},s-f)))},()=>i&&a(i)]}const tr=(r,t,e=3)=>{let s=0;const i=vc(50,250);return Sc(n=>{const a=n.loaded,d=n.lengthComputable?n.total:void 0,u=a-s,p=i(u),w=a<=d;s=a;const f={loaded:a,total:d,progress:d?a/d:void 0,bytes:u,rate:p||void 0,estimated:p&&d&&w?(d-a)/p:void 0,event:n,lengthComputable:d!=null,[t?"download":"upload"]:!0};r(f)},e)},Gs=(r,t)=>{const e=r!=null;return[s=>t[0]({lengthComputable:e,total:r,loaded:s}),t[1]]},Hs=r=>(...t)=>I.asap(()=>r(...t)),bc=Ut.hasStandardBrowserEnv?((r,t)=>e=>(e=new URL(e,Ut.origin),r.protocol===e.protocol&&r.host===e.host&&(t||r.port===e.port)))(new URL(Ut.origin),Ut.navigator&&/(msie|trident)/i.test(Ut.navigator.userAgent)):()=>!0,Tc=Ut.hasStandardBrowserEnv?{write(r,t,e,s,i,n,a){if(typeof document>"u")return;const d=[`${r}=${encodeURIComponent(t)}`];I.isNumber(e)&&d.push(`expires=${new Date(e).toUTCString()}`),I.isString(s)&&d.push(`path=${s}`),I.isString(i)&&d.push(`domain=${i}`),n===!0&&d.push("secure"),I.isString(a)&&d.push(`SameSite=${a}`),document.cookie=d.join("; ")},read(r){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+r+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(r){this.write(r,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function Ec(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function Pc(r,t){return t?r.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):r}function cn(r,t,e){let s=!Ec(t);return r&&(s||e==!1)?Pc(r,t):t}const js=r=>r instanceof Wt?{...r}:r;function Se(r,t){t=t||{};const e={};function s(p,w,f,x){return I.isPlainObject(p)&&I.isPlainObject(w)?I.merge.call({caseless:x},p,w):I.isPlainObject(w)?I.merge({},w):I.isArray(w)?w.slice():w}function i(p,w,f,x){if(I.isUndefined(w)){if(!I.isUndefined(p))return s(void 0,p,f,x)}else return s(p,w,f,x)}function n(p,w){if(!I.isUndefined(w))return s(void 0,w)}function a(p,w){if(I.isUndefined(w)){if(!I.isUndefined(p))return s(void 0,p)}else return s(void 0,w)}function d(p,w,f){if(f in t)return s(p,w);if(f in r)return s(void 0,p)}const u={url:n,method:n,data:n,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:d,headers:(p,w,f)=>i(js(p),js(w),f,!0)};return I.forEach(Object.keys({...r,...t}),function(w){const f=u[w]||i,x=f(r[w],t[w],w);I.isUndefined(x)&&f!==d||(e[w]=x)}),e}const ln=r=>{const t=Se({},r);let{data:e,withXSRFToken:s,xsrfHeaderName:i,xsrfCookieName:n,headers:a,auth:d}=t;if(t.headers=a=Wt.from(a),t.url=rn(cn(t.baseURL,t.url,t.allowAbsoluteUrls),r.params,r.paramsSerializer),d&&a.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),I.isFormData(e)){if(Ut.hasStandardBrowserEnv||Ut.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(I.isFunction(e.getHeaders)){const u=e.getHeaders(),p=["content-type","content-length"];Object.entries(u).forEach(([w,f])=>{p.includes(w.toLowerCase())&&a.set(w,f)})}}if(Ut.hasStandardBrowserEnv&&(s&&I.isFunction(s)&&(s=s(t)),s||s!==!1&&bc(t.url))){const u=i&&n&&Tc.read(n);u&&a.set(i,u)}return t},Ac=typeof XMLHttpRequest<"u",Mc=Ac&&function(r){return new Promise(function(e,s){const i=ln(r);let n=i.data;const a=Wt.from(i.headers).normalize();let{responseType:d,onUploadProgress:u,onDownloadProgress:p}=i,w,f,x,T,S;function P(){T&&T(),S&&S(),i.cancelToken&&i.cancelToken.unsubscribe(w),i.signal&&i.signal.removeEventListener("abort",w)}let M=new XMLHttpRequest;M.open(i.method.toUpperCase(),i.url,!0),M.timeout=i.timeout;function k(){if(!M)return;const O=Wt.from("getAllResponseHeaders"in M&&M.getAllResponseHeaders()),D={data:!d||d==="text"||d==="json"?M.responseText:M.response,status:M.status,statusText:M.statusText,headers:O,config:r,request:M};an(function(q){e(q),P()},function(q){s(q),P()},D),M=null}"onloadend"in M?M.onloadend=k:M.onreadystatechange=function(){!M||M.readyState!==4||M.status===0&&!(M.responseURL&&M.responseURL.indexOf("file:")===0)||setTimeout(k)},M.onabort=function(){M&&(s(new F("Request aborted",F.ECONNABORTED,r,M)),M=null)},M.onerror=function(C){const D=C&&C.message?C.message:"Network Error",U=new F(D,F.ERR_NETWORK,r,M);U.event=C||null,s(U),M=null},M.ontimeout=function(){let C=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const D=i.transitional||sn;i.timeoutErrorMessage&&(C=i.timeoutErrorMessage),s(new F(C,D.clarifyTimeoutError?F.ETIMEDOUT:F.ECONNABORTED,r,M)),M=null},n===void 0&&a.setContentType(null),"setRequestHeader"in M&&I.forEach(a.toJSON(),function(C,D){M.setRequestHeader(D,C)}),I.isUndefined(i.withCredentials)||(M.withCredentials=!!i.withCredentials),d&&d!=="json"&&(M.responseType=i.responseType),p&&([x,S]=tr(p,!0),M.addEventListener("progress",x)),u&&M.upload&&([f,T]=tr(u),M.upload.addEventListener("progress",f),M.upload.addEventListener("loadend",T)),(i.cancelToken||i.signal)&&(w=O=>{M&&(s(!O||O.type?new Ie(null,r,M):O),M.abort(),M=null)},i.cancelToken&&i.cancelToken.subscribe(w),i.signal&&(i.signal.aborted?w():i.signal.addEventListener("abort",w)));const $=wc(i.url);if($&&Ut.protocols.indexOf($)===-1){s(new F("Unsupported protocol "+$+":",F.ERR_BAD_REQUEST,r));return}M.send(n||null)})},xc=(r,t)=>{const{length:e}=r=r?r.filter(Boolean):[];if(t||e){let s=new AbortController,i;const n=function(p){if(!i){i=!0,d();const w=p instanceof Error?p:this.reason;s.abort(w instanceof F?w:new Ie(w instanceof Error?w.message:w))}};let a=t&&setTimeout(()=>{a=null,n(new F(`timeout ${t} of ms exceeded`,F.ETIMEDOUT))},t);const d=()=>{r&&(a&&clearTimeout(a),a=null,r.forEach(p=>{p.unsubscribe?p.unsubscribe(n):p.removeEventListener("abort",n)}),r=null)};r.forEach(p=>p.addEventListener("abort",n));const{signal:u}=s;return u.unsubscribe=()=>I.asap(d),u}},Ic=function*(r,t){let e=r.byteLength;if(e<t){yield r;return}let s=0,i;for(;s<e;)i=s+t,yield r.slice(s,i),s=i},kc=async function*(r,t){for await(const e of Oc(r))yield*Ic(e,t)},Oc=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const t=r.getReader();try{for(;;){const{done:e,value:s}=await t.read();if(e)break;yield s}}finally{await t.cancel()}},Ws=(r,t,e,s)=>{const i=kc(r,t);let n=0,a,d=u=>{a||(a=!0,s&&s(u))};return new ReadableStream({async pull(u){try{const{done:p,value:w}=await i.next();if(p){d(),u.close();return}let f=w.byteLength;if(e){let x=n+=f;e(x)}u.enqueue(new Uint8Array(w))}catch(p){throw d(p),p}},cancel(u){return d(u),i.return()}},{highWaterMark:2})},Ks=64*1024,{isFunction:je}=I,$c=(({Request:r,Response:t})=>({Request:r,Response:t}))(I.global),{ReadableStream:Ys,TextEncoder:Vs}=I.global,Js=(r,...t)=>{try{return!!r(...t)}catch{return!1}},Cc=r=>{r=I.merge.call({skipUndefined:!0},$c,r);const{fetch:t,Request:e,Response:s}=r,i=t?je(t):typeof fetch=="function",n=je(e),a=je(s);if(!i)return!1;const d=i&&je(Ys),u=i&&(typeof Vs=="function"?(S=>P=>S.encode(P))(new Vs):async S=>new Uint8Array(await new e(S).arrayBuffer())),p=n&&d&&Js(()=>{let S=!1;const P=new e(Ut.origin,{body:new Ys,method:"POST",get duplex(){return S=!0,"half"}}).headers.has("Content-Type");return S&&!P}),w=a&&d&&Js(()=>I.isReadableStream(new s("").body)),f={stream:w&&(S=>S.body)};i&&["text","arrayBuffer","blob","formData","stream"].forEach(S=>{!f[S]&&(f[S]=(P,M)=>{let k=P&&P[S];if(k)return k.call(P);throw new F(`Response type '${S}' is not supported`,F.ERR_NOT_SUPPORT,M)})});const x=async S=>{if(S==null)return 0;if(I.isBlob(S))return S.size;if(I.isSpecCompliantForm(S))return(await new e(Ut.origin,{method:"POST",body:S}).arrayBuffer()).byteLength;if(I.isArrayBufferView(S)||I.isArrayBuffer(S))return S.byteLength;if(I.isURLSearchParams(S)&&(S=S+""),I.isString(S))return(await u(S)).byteLength},T=async(S,P)=>{const M=I.toFiniteNumber(S.getContentLength());return M??x(P)};return async S=>{let{url:P,method:M,data:k,signal:$,cancelToken:O,timeout:C,onDownloadProgress:D,onUploadProgress:U,responseType:q,headers:Ft,withCredentials:Yt="same-origin",fetchOptions:Vt}=ln(S),G=t||fetch;q=q?(q+"").toLowerCase():"text";let qt=xc([$,O&&O.toAbortSignal()],C),b=null;const o=qt&&qt.unsubscribe&&(()=>{qt.unsubscribe()});let l;try{if(U&&p&&M!=="get"&&M!=="head"&&(l=await T(Ft,k))!==0){let g=new e(P,{method:"POST",body:k,duplex:"half"}),c;if(I.isFormData(k)&&(c=g.headers.get("content-type"))&&Ft.setContentType(c),g.body){const[y,R]=Gs(l,tr(Hs(U)));k=Ws(g.body,Ks,y,R)}}I.isString(Yt)||(Yt=Yt?"include":"omit");const h=n&&"credentials"in e.prototype,m={...Vt,signal:qt,method:M.toUpperCase(),headers:Ft.normalize().toJSON(),body:k,duplex:"half",credentials:h?Yt:void 0};b=n&&new e(P,m);let v=await(n?G(b,Vt):G(P,m));const E=w&&(q==="stream"||q==="response");if(w&&(D||E&&o)){const g={};["status","statusText","headers"].forEach(_=>{g[_]=v[_]});const c=I.toFiniteNumber(v.headers.get("content-length")),[y,R]=D&&Gs(c,tr(Hs(D),!0))||[];v=new s(Ws(v.body,Ks,y,()=>{R&&R(),o&&o()}),g)}q=q||"text";let A=await f[I.findKey(f,q)||"text"](v,S);return!E&&o&&o(),await new Promise((g,c)=>{an(g,c,{data:A,headers:Wt.from(v.headers),status:v.status,statusText:v.statusText,config:S,request:b})})}catch(h){throw o&&o(),h&&h.name==="TypeError"&&/Load failed|fetch/i.test(h.message)?Object.assign(new F("Network Error",F.ERR_NETWORK,S,b),{cause:h.cause||h}):F.from(h,h&&h.code,S,b)}}},Rc=new Map,dn=r=>{let t=r&&r.env||{};const{fetch:e,Request:s,Response:i}=t,n=[s,i,e];let a=n.length,d=a,u,p,w=Rc;for(;d--;)u=n[d],p=w.get(u),p===void 0&&w.set(u,p=d?new Map:Cc(t)),w=p;return p};dn();const ns={http:Ja,xhr:Mc,fetch:{get:dn}};I.forEach(ns,(r,t)=>{if(r){try{Object.defineProperty(r,"name",{value:t})}catch{}Object.defineProperty(r,"adapterName",{value:t})}});const Qs=r=>`- ${r}`,_c=r=>I.isFunction(r)||r===null||r===!1;function Nc(r,t){r=I.isArray(r)?r:[r];const{length:e}=r;let s,i;const n={};for(let a=0;a<e;a++){s=r[a];let d;if(i=s,!_c(s)&&(i=ns[(d=String(s)).toLowerCase()],i===void 0))throw new F(`Unknown adapter '${d}'`);if(i&&(I.isFunction(i)||(i=i.get(t))))break;n[d||"#"+a]=i}if(!i){const a=Object.entries(n).map(([u,p])=>`adapter ${u} `+(p===!1?"is not supported by the environment":"is not available in the build"));let d=e?a.length>1?`since :
`+a.map(Qs).join(`
`):" "+Qs(a[0]):"as no adapter specified";throw new F("There is no suitable adapter to dispatch the request "+d,"ERR_NOT_SUPPORT")}return i}const hn={getAdapter:Nc,adapters:ns};function Nr(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Ie(null,r)}function Xs(r){return Nr(r),r.headers=Wt.from(r.headers),r.data=_r.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),hn.getAdapter(r.adapter||Ge.adapter,r)(r).then(function(s){return Nr(r),s.data=_r.call(r,r.transformResponse,s),s.headers=Wt.from(s.headers),s},function(s){return on(s)||(Nr(r),s&&s.response&&(s.response.data=_r.call(r,r.transformResponse,s.response),s.response.headers=Wt.from(s.response.headers))),Promise.reject(s)})}const un="1.13.2",lr={};["object","boolean","number","function","string","symbol"].forEach((r,t)=>{lr[r]=function(s){return typeof s===r||"a"+(t<1?"n ":" ")+r}});const Zs={};lr.transitional=function(t,e,s){function i(n,a){return"[Axios v"+un+"] Transitional option '"+n+"'"+a+(s?". "+s:"")}return(n,a,d)=>{if(t===!1)throw new F(i(a," has been removed"+(e?" in "+e:"")),F.ERR_DEPRECATED);return e&&!Zs[a]&&(Zs[a]=!0,console.warn(i(a," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(n,a,d):!0}};lr.spelling=function(t){return(e,s)=>(console.warn(`${s} is likely a misspelling of ${t}`),!0)};function Fc(r,t,e){if(typeof r!="object")throw new F("options must be an object",F.ERR_BAD_OPTION_VALUE);const s=Object.keys(r);let i=s.length;for(;i-- >0;){const n=s[i],a=t[n];if(a){const d=r[n],u=d===void 0||a(d,n,r);if(u!==!0)throw new F("option "+n+" must be "+u,F.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new F("Unknown option "+n,F.ERR_BAD_OPTION)}}const Ve={assertOptions:Fc,validators:lr},ae=Ve.validators;let me=class{constructor(t){this.defaults=t||{},this.interceptors={request:new zs,response:new zs}}async request(t,e){try{return await this._request(t,e)}catch(s){if(s instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const n=i.stack?i.stack.replace(/^.+\n/,""):"";try{s.stack?n&&!String(s.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+n):s.stack=n}catch{}}throw s}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=Se(this.defaults,e);const{transitional:s,paramsSerializer:i,headers:n}=e;s!==void 0&&Ve.assertOptions(s,{silentJSONParsing:ae.transitional(ae.boolean),forcedJSONParsing:ae.transitional(ae.boolean),clarifyTimeoutError:ae.transitional(ae.boolean)},!1),i!=null&&(I.isFunction(i)?e.paramsSerializer={serialize:i}:Ve.assertOptions(i,{encode:ae.function,serialize:ae.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),Ve.assertOptions(e,{baseUrl:ae.spelling("baseURL"),withXsrfToken:ae.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let a=n&&I.merge(n.common,n[e.method]);n&&I.forEach(["delete","get","head","post","put","patch","common"],S=>{delete n[S]}),e.headers=Wt.concat(a,n);const d=[];let u=!0;this.interceptors.request.forEach(function(P){typeof P.runWhen=="function"&&P.runWhen(e)===!1||(u=u&&P.synchronous,d.unshift(P.fulfilled,P.rejected))});const p=[];this.interceptors.response.forEach(function(P){p.push(P.fulfilled,P.rejected)});let w,f=0,x;if(!u){const S=[Xs.bind(this),void 0];for(S.unshift(...d),S.push(...p),x=S.length,w=Promise.resolve(e);f<x;)w=w.then(S[f++],S[f++]);return w}x=d.length;let T=e;for(;f<x;){const S=d[f++],P=d[f++];try{T=S(T)}catch(M){P.call(this,M);break}}try{w=Xs.call(this,T)}catch(S){return Promise.reject(S)}for(f=0,x=p.length;f<x;)w=w.then(p[f++],p[f++]);return w}getUri(t){t=Se(this.defaults,t);const e=cn(t.baseURL,t.url,t.allowAbsoluteUrls);return rn(e,t.params,t.paramsSerializer)}};I.forEach(["delete","get","head","options"],function(t){me.prototype[t]=function(e,s){return this.request(Se(s||{},{method:t,url:e,data:(s||{}).data}))}});I.forEach(["post","put","patch"],function(t){function e(s){return function(n,a,d){return this.request(Se(d||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:n,data:a}))}}me.prototype[t]=e(),me.prototype[t+"Form"]=e(!0)});let Lc=class fn{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(n){e=n});const s=this;this.promise.then(i=>{if(!s._listeners)return;let n=s._listeners.length;for(;n-- >0;)s._listeners[n](i);s._listeners=null}),this.promise.then=i=>{let n;const a=new Promise(d=>{s.subscribe(d),n=d}).then(i);return a.cancel=function(){s.unsubscribe(n)},a},t(function(n,a,d){s.reason||(s.reason=new Ie(n,a,d),e(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=s=>{t.abort(s)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new fn(function(i){t=i}),cancel:t}}};function Dc(r){return function(e){return r.apply(null,e)}}function Uc(r){return I.isObject(r)&&r.isAxiosError===!0}const Yr={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Yr).forEach(([r,t])=>{Yr[t]=r});function gn(r){const t=new me(r),e=Hi(me.prototype.request,t);return I.extend(e,me.prototype,t,{allOwnKeys:!0}),I.extend(e,t,null,{allOwnKeys:!0}),e.create=function(i){return gn(Se(r,i))},e}const Y=gn(Ge);Y.Axios=me;Y.CanceledError=Ie;Y.CancelToken=Lc;Y.isCancel=on;Y.VERSION=un;Y.toFormData=cr;Y.AxiosError=F;Y.Cancel=Y.CanceledError;Y.all=function(t){return Promise.all(t)};Y.spread=Dc;Y.isAxiosError=Uc;Y.mergeConfig=Se;Y.AxiosHeaders=Wt;Y.formToJSON=r=>nn(I.isHTMLForm(r)?new FormData(r):r);Y.getAdapter=hn.getAdapter;Y.HttpStatusCode=Yr;Y.default=Y;const{Axios:ih,AxiosError:nh,CanceledError:oh,isCancel:ah,CancelToken:ch,VERSION:lh,all:dh,Cancel:hh,isAxiosError:uh,spread:fh,toFormData:gh,AxiosHeaders:ph,HttpStatusCode:mh,formToJSON:yh,getAdapter:wh,mergeConfig:vh}=Y;var Sh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bc(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function zc(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var t=r.default;if(typeof t=="function"){var e=function s(){var i=!1;try{i=this instanceof s}catch{}return i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(r).forEach(function(s){var i=Object.getOwnPropertyDescriptor(r,s);Object.defineProperty(e,s,i.get?i:{enumerable:!0,get:function(){return r[s]}})}),e}var he={},ti;function qc(){if(ti)return he;ti=1,Object.defineProperty(he,"__esModule",{value:!0});var r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},t=typeof window<"u"&&typeof window.document<"u",e=typeof process<"u"&&process.versions!=null&&process.versions.node!=null,s=(typeof self>"u"?"undefined":r(self))==="object"&&self.constructor&&self.constructor.name==="DedicatedWorkerGlobalScope",i=typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),n=typeof Deno<"u"&&typeof Deno.version<"u"&&typeof Deno.version.deno<"u";return he.isBrowser=t,he.isWebWorker=s,he.isNode=e,he.isJsDom=i,he.isDeno=n,he}var Gc=qc();const W="GET",te="POST",re="DELETE",Hc="PUT",jc=(r,t)=>{Gc.isBrowser||((!t||typeof t===void 0)&&(t={}),t&&(t["User-Agent"]="@polymarket/clob-client",t.Accept="*/*",t.Connection="keep-alive",t["Content-Type"]="application/json",r===W&&(t["Accept-Encoding"]="gzip")))},Fe=async(r,t,e,s,i)=>(jc(t,e),await Y({method:t,url:r,headers:e,data:s,params:i})),Wc=r=>new Promise(t=>setTimeout(t,r)),Kc=r=>{if(!Y.isAxiosError(r))return!1;if(!r.response)return!0;const t=r.response.status??0;if(t>=500&&t<600)return!0;const e=(r.code??"").toString();return["ECONNABORTED","ENETUNREACH","EAI_AGAIN","ETIMEDOUT"].includes(e)},Yc=async(r,t,e)=>{try{return(await Fe(r,te,t?.headers,t?.data,t?.params)).data}catch(s){if(e&&Kc(s)){console.log("[CLOB Client] transient error, retrying once after 30 ms"),await Wc(30);try{return(await Fe(r,te,t?.headers,t?.data,t?.params)).data}catch(i){return Le(i)}}return Le(s)}},Vc=async(r,t)=>{try{return(await Fe(r,W,t?.headers,t?.data,t?.params)).data}catch(e){return Le(e)}},Jc=async(r,t)=>{try{return(await Fe(r,re,t?.headers,t?.data,t?.params)).data}catch(e){return Le(e)}},Qc=async(r,t)=>{try{return(await Fe(r,Hc,t?.headers,t?.data,t?.params)).data}catch(e){return Le(e)}},Le=r=>{if(Y.isAxiosError(r)){if(r.response&&(console.error("[CLOB Client] request error",JSON.stringify({status:r.response?.status,statusText:r.response?.statusText,data:r.response?.data,config:r.response?.config})),r.response?.data))return typeof r.response?.data=="string"||r.response?.data instanceof String?{error:r.response?.data,status:r.response?.status}:Object.prototype.hasOwnProperty.call(r.response?.data,"error")?{...r.response?.data,status:r.response?.status}:{error:r.response?.data,status:r.response?.status};if(r.message)return console.error("[CLOB Client] request error",JSON.stringify({error:r.message})),{error:r.message}}return console.error("[CLOB Client] request error",r),{error:r}},Xc=r=>{const t={};return r!==void 0&&r.ids!==void 0&&(t.ids=r?.ids.join(",")),t},Vr=new Error("Signer is needed to interact with this endpoint!"),pn=new Error("API Credentials are needed to interact with this endpoint!"),Zc=new Error("Builder API Credentials needed to interact with this endpoint!"),ei=new Error("Builder key auth failed!");function ri(r,t,e,s=!1,i){if(i===!0&&e!==ee.GTC&&e!==ee.GTD)throw new Error("postOnly is only supported for GTC and GTD orders");let n=Rt.BUY;return r.side==ve.BUY?n=Rt.BUY:n=Rt.SELL,{deferExec:s,order:{salt:parseInt(r.salt,10),maker:r.maker,signer:r.signer,taker:r.taker,tokenId:r.tokenId,makerAmount:r.makerAmount,takerAmount:r.takerAmount,side:n,expiration:r.expiration,nonce:r.nonce,feeRateBps:r.feeRateBps,signatureType:r.signatureType,signature:r.signature},owner:t,orderType:e,...typeof i=="boolean"?{postOnly:i}:{}}}const Jr=(r,t)=>ne(r)<=t?r:Math.round((r+Number.EPSILON)*10**t)/10**t,ie=(r,t)=>ne(r)<=t?r:Math.floor(r*10**t)/10**t,er=(r,t)=>ne(r)<=t?r:Math.ceil(r*10**t)/10**t,ne=r=>{if(Number.isInteger(r))return 0;const t=r.toString().split(".");return t.length<=1?0:t[1].length};function tl(r){const t=new Uint8Array(r);return Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join("")}const el=async r=>{r.hash="";const t=JSON.stringify(r),e=new TextEncoder().encode(t),s=await globalThis.crypto.subtle.digest("SHA-1",e),i=tl(s);return r.hash=i,i},rl=(r,t)=>parseFloat(r)<parseFloat(t),si=(r,t)=>r>=parseFloat(t)&&r<=1-parseFloat(t),sl="/time",il="/auth/api-key",nl="/auth/api-keys",ol="/auth/api-key",al="/auth/derive-api-key",cl="/auth/ban-status/closed-only",ll="/auth/readonly-api-key",dl="/auth/readonly-api-keys",hl="/auth/readonly-api-key",ul="/auth/validate-readonly-api-key",fl="/auth/builder-api-key",gl="/auth/builder-api-key",pl="/auth/builder-api-key",ml="/sampling-simplified-markets",yl="/sampling-markets",wl="/simplified-markets",vl="/markets",Sl="/markets/",bl="/book",Tl="/books",El="/midpoint",Pl="/midpoints",Al="/price",Ml="/prices",xl="/spread",Il="/spreads",kl="/last-trade-price",Ol="/last-trades-prices",$l="/tick-size",Cl="/neg-risk",Rl="/fee-rate",_l="/order",Nl="/orders",Fl="/order",Ll="/orders",Dl="/data/order/",Ul="/cancel-all",Bl="/cancel-market-orders",zl="/data/orders",ii="/data/trades",ql="/order-scoring",Gl="/orders-scoring",Hl="/prices-history",jl="/notifications",Wl="/notifications",Kl="/balance-allowance",Yl="/balance-allowance/update",Vl="/live-activity/events/",Jl="/rewards/user",Ql="/rewards/user/total",Xl="/rewards/user/percentages",Zl="/rewards/markets/current",td="/rewards/markets/",ed="/rewards/user/markets",rd="/builder/trades",sd="/v1/heartbeats",id="/rfq/request",nd="/rfq/request",od="/rfq/data/requests",ad="/rfq/quote",cd="/rfq/quote",ld="/rfq/request/accept",dd="/rfq/quote/approve",hd="/rfq/data/requester/quotes",ud="/rfq/data/quoter/quotes",fd="/rfq/data/best-quote",gd="/rfq/config";var Je={exports:{}};const pd={},md=Object.freeze(Object.defineProperty({__proto__:null,default:pd},Symbol.toStringTag,{value:"Module"})),yd=zc(md);var wd=Je.exports,ni;function vd(){return ni||(ni=1,(function(r){(function(t,e){function s(b,o){if(!b)throw new Error(o||"Assertion failed")}function i(b,o){b.super_=o;var l=function(){};l.prototype=o.prototype,b.prototype=new l,b.prototype.constructor=b}function n(b,o,l){if(n.isBN(b))return b;this.negative=0,this.words=null,this.length=0,this.red=null,b!==null&&((o==="le"||o==="be")&&(l=o,o=10),this._init(b||0,o||10,l||"be"))}typeof t=="object"?t.exports=n:e.BN=n,n.BN=n,n.wordSize=26;var a;try{typeof window<"u"&&typeof window.Buffer<"u"?a=window.Buffer:a=yd.Buffer}catch{}n.isBN=function(o){return o instanceof n?!0:o!==null&&typeof o=="object"&&o.constructor.wordSize===n.wordSize&&Array.isArray(o.words)},n.max=function(o,l){return o.cmp(l)>0?o:l},n.min=function(o,l){return o.cmp(l)<0?o:l},n.prototype._init=function(o,l,h){if(typeof o=="number")return this._initNumber(o,l,h);if(typeof o=="object")return this._initArray(o,l,h);l==="hex"&&(l=16),s(l===(l|0)&&l>=2&&l<=36),o=o.toString().replace(/\s+/g,"");var m=0;o[0]==="-"&&(m++,this.negative=1),m<o.length&&(l===16?this._parseHex(o,m,h):(this._parseBase(o,l,m),h==="le"&&this._initArray(this.toArray(),l,h)))},n.prototype._initNumber=function(o,l,h){o<0&&(this.negative=1,o=-o),o<67108864?(this.words=[o&67108863],this.length=1):o<4503599627370496?(this.words=[o&67108863,o/67108864&67108863],this.length=2):(s(o<9007199254740992),this.words=[o&67108863,o/67108864&67108863,1],this.length=3),h==="le"&&this._initArray(this.toArray(),l,h)},n.prototype._initArray=function(o,l,h){if(s(typeof o.length=="number"),o.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(o.length/3),this.words=new Array(this.length);for(var m=0;m<this.length;m++)this.words[m]=0;var v,E,A=0;if(h==="be")for(m=o.length-1,v=0;m>=0;m-=3)E=o[m]|o[m-1]<<8|o[m-2]<<16,this.words[v]|=E<<A&67108863,this.words[v+1]=E>>>26-A&67108863,A+=24,A>=26&&(A-=26,v++);else if(h==="le")for(m=0,v=0;m<o.length;m+=3)E=o[m]|o[m+1]<<8|o[m+2]<<16,this.words[v]|=E<<A&67108863,this.words[v+1]=E>>>26-A&67108863,A+=24,A>=26&&(A-=26,v++);return this._strip()};function d(b,o){var l=b.charCodeAt(o);if(l>=48&&l<=57)return l-48;if(l>=65&&l<=70)return l-55;if(l>=97&&l<=102)return l-87;s(!1,"Invalid character in "+b)}function u(b,o,l){var h=d(b,l);return l-1>=o&&(h|=d(b,l-1)<<4),h}n.prototype._parseHex=function(o,l,h){this.length=Math.ceil((o.length-l)/6),this.words=new Array(this.length);for(var m=0;m<this.length;m++)this.words[m]=0;var v=0,E=0,A;if(h==="be")for(m=o.length-1;m>=l;m-=2)A=u(o,l,m)<<v,this.words[E]|=A&67108863,v>=18?(v-=18,E+=1,this.words[E]|=A>>>26):v+=8;else{var g=o.length-l;for(m=g%2===0?l+1:l;m<o.length;m+=2)A=u(o,l,m)<<v,this.words[E]|=A&67108863,v>=18?(v-=18,E+=1,this.words[E]|=A>>>26):v+=8}this._strip()};function p(b,o,l,h){for(var m=0,v=0,E=Math.min(b.length,l),A=o;A<E;A++){var g=b.charCodeAt(A)-48;m*=h,g>=49?v=g-49+10:g>=17?v=g-17+10:v=g,s(g>=0&&v<h,"Invalid character"),m+=v}return m}n.prototype._parseBase=function(o,l,h){this.words=[0],this.length=1;for(var m=0,v=1;v<=67108863;v*=l)m++;m--,v=v/l|0;for(var E=o.length-h,A=E%m,g=Math.min(E,E-A)+h,c=0,y=h;y<g;y+=m)c=p(o,y,y+m,l),this.imuln(v),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c);if(A!==0){var R=1;for(c=p(o,y,o.length,l),y=0;y<A;y++)R*=l;this.imuln(R),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c)}this._strip()},n.prototype.copy=function(o){o.words=new Array(this.length);for(var l=0;l<this.length;l++)o.words[l]=this.words[l];o.length=this.length,o.negative=this.negative,o.red=this.red};function w(b,o){b.words=o.words,b.length=o.length,b.negative=o.negative,b.red=o.red}if(n.prototype._move=function(o){w(o,this)},n.prototype.clone=function(){var o=new n(null);return this.copy(o),o},n.prototype._expand=function(o){for(;this.length<o;)this.words[this.length++]=0;return this},n.prototype._strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},n.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},typeof Symbol<"u"&&typeof Symbol.for=="function")try{n.prototype[Symbol.for("nodejs.util.inspect.custom")]=f}catch{n.prototype.inspect=f}else n.prototype.inspect=f;function f(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var x=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],T=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],S=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];n.prototype.toString=function(o,l){o=o||10,l=l|0||1;var h;if(o===16||o==="hex"){h="";for(var m=0,v=0,E=0;E<this.length;E++){var A=this.words[E],g=((A<<m|v)&16777215).toString(16);v=A>>>24-m&16777215,m+=2,m>=26&&(m-=26,E--),v!==0||E!==this.length-1?h=x[6-g.length]+g+h:h=g+h}for(v!==0&&(h=v.toString(16)+h);h.length%l!==0;)h="0"+h;return this.negative!==0&&(h="-"+h),h}if(o===(o|0)&&o>=2&&o<=36){var c=T[o],y=S[o];h="";var R=this.clone();for(R.negative=0;!R.isZero();){var _=R.modrn(y).toString(o);R=R.idivn(y),R.isZero()?h=_+h:h=x[c-_.length]+_+h}for(this.isZero()&&(h="0"+h);h.length%l!==0;)h="0"+h;return this.negative!==0&&(h="-"+h),h}s(!1,"Base should be between 2 and 36")},n.prototype.toNumber=function(){var o=this.words[0];return this.length===2?o+=this.words[1]*67108864:this.length===3&&this.words[2]===1?o+=4503599627370496+this.words[1]*67108864:this.length>2&&s(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-o:o},n.prototype.toJSON=function(){return this.toString(16,2)},a&&(n.prototype.toBuffer=function(o,l){return this.toArrayLike(a,o,l)}),n.prototype.toArray=function(o,l){return this.toArrayLike(Array,o,l)};var P=function(o,l){return o.allocUnsafe?o.allocUnsafe(l):new o(l)};n.prototype.toArrayLike=function(o,l,h){this._strip();var m=this.byteLength(),v=h||Math.max(1,m);s(m<=v,"byte array longer than desired length"),s(v>0,"Requested array length <= 0");var E=P(o,v),A=l==="le"?"LE":"BE";return this["_toArrayLike"+A](E,m),E},n.prototype._toArrayLikeLE=function(o,l){for(var h=0,m=0,v=0,E=0;v<this.length;v++){var A=this.words[v]<<E|m;o[h++]=A&255,h<o.length&&(o[h++]=A>>8&255),h<o.length&&(o[h++]=A>>16&255),E===6?(h<o.length&&(o[h++]=A>>24&255),m=0,E=0):(m=A>>>24,E+=2)}if(h<o.length)for(o[h++]=m;h<o.length;)o[h++]=0},n.prototype._toArrayLikeBE=function(o,l){for(var h=o.length-1,m=0,v=0,E=0;v<this.length;v++){var A=this.words[v]<<E|m;o[h--]=A&255,h>=0&&(o[h--]=A>>8&255),h>=0&&(o[h--]=A>>16&255),E===6?(h>=0&&(o[h--]=A>>24&255),m=0,E=0):(m=A>>>24,E+=2)}if(h>=0)for(o[h--]=m;h>=0;)o[h--]=0},Math.clz32?n.prototype._countBits=function(o){return 32-Math.clz32(o)}:n.prototype._countBits=function(o){var l=o,h=0;return l>=4096&&(h+=13,l>>>=13),l>=64&&(h+=7,l>>>=7),l>=8&&(h+=4,l>>>=4),l>=2&&(h+=2,l>>>=2),h+l},n.prototype._zeroBits=function(o){if(o===0)return 26;var l=o,h=0;return(l&8191)===0&&(h+=13,l>>>=13),(l&127)===0&&(h+=7,l>>>=7),(l&15)===0&&(h+=4,l>>>=4),(l&3)===0&&(h+=2,l>>>=2),(l&1)===0&&h++,h},n.prototype.bitLength=function(){var o=this.words[this.length-1],l=this._countBits(o);return(this.length-1)*26+l};function M(b){for(var o=new Array(b.bitLength()),l=0;l<o.length;l++){var h=l/26|0,m=l%26;o[l]=b.words[h]>>>m&1}return o}n.prototype.zeroBits=function(){if(this.isZero())return 0;for(var o=0,l=0;l<this.length;l++){var h=this._zeroBits(this.words[l]);if(o+=h,h!==26)break}return o},n.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},n.prototype.toTwos=function(o){return this.negative!==0?this.abs().inotn(o).iaddn(1):this.clone()},n.prototype.fromTwos=function(o){return this.testn(o-1)?this.notn(o).iaddn(1).ineg():this.clone()},n.prototype.isNeg=function(){return this.negative!==0},n.prototype.neg=function(){return this.clone().ineg()},n.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},n.prototype.iuor=function(o){for(;this.length<o.length;)this.words[this.length++]=0;for(var l=0;l<o.length;l++)this.words[l]=this.words[l]|o.words[l];return this._strip()},n.prototype.ior=function(o){return s((this.negative|o.negative)===0),this.iuor(o)},n.prototype.or=function(o){return this.length>o.length?this.clone().ior(o):o.clone().ior(this)},n.prototype.uor=function(o){return this.length>o.length?this.clone().iuor(o):o.clone().iuor(this)},n.prototype.iuand=function(o){var l;this.length>o.length?l=o:l=this;for(var h=0;h<l.length;h++)this.words[h]=this.words[h]&o.words[h];return this.length=l.length,this._strip()},n.prototype.iand=function(o){return s((this.negative|o.negative)===0),this.iuand(o)},n.prototype.and=function(o){return this.length>o.length?this.clone().iand(o):o.clone().iand(this)},n.prototype.uand=function(o){return this.length>o.length?this.clone().iuand(o):o.clone().iuand(this)},n.prototype.iuxor=function(o){var l,h;this.length>o.length?(l=this,h=o):(l=o,h=this);for(var m=0;m<h.length;m++)this.words[m]=l.words[m]^h.words[m];if(this!==l)for(;m<l.length;m++)this.words[m]=l.words[m];return this.length=l.length,this._strip()},n.prototype.ixor=function(o){return s((this.negative|o.negative)===0),this.iuxor(o)},n.prototype.xor=function(o){return this.length>o.length?this.clone().ixor(o):o.clone().ixor(this)},n.prototype.uxor=function(o){return this.length>o.length?this.clone().iuxor(o):o.clone().iuxor(this)},n.prototype.inotn=function(o){s(typeof o=="number"&&o>=0);var l=Math.ceil(o/26)|0,h=o%26;this._expand(l),h>0&&l--;for(var m=0;m<l;m++)this.words[m]=~this.words[m]&67108863;return h>0&&(this.words[m]=~this.words[m]&67108863>>26-h),this._strip()},n.prototype.notn=function(o){return this.clone().inotn(o)},n.prototype.setn=function(o,l){s(typeof o=="number"&&o>=0);var h=o/26|0,m=o%26;return this._expand(h+1),l?this.words[h]=this.words[h]|1<<m:this.words[h]=this.words[h]&~(1<<m),this._strip()},n.prototype.iadd=function(o){var l;if(this.negative!==0&&o.negative===0)return this.negative=0,l=this.isub(o),this.negative^=1,this._normSign();if(this.negative===0&&o.negative!==0)return o.negative=0,l=this.isub(o),o.negative=1,l._normSign();var h,m;this.length>o.length?(h=this,m=o):(h=o,m=this);for(var v=0,E=0;E<m.length;E++)l=(h.words[E]|0)+(m.words[E]|0)+v,this.words[E]=l&67108863,v=l>>>26;for(;v!==0&&E<h.length;E++)l=(h.words[E]|0)+v,this.words[E]=l&67108863,v=l>>>26;if(this.length=h.length,v!==0)this.words[this.length]=v,this.length++;else if(h!==this)for(;E<h.length;E++)this.words[E]=h.words[E];return this},n.prototype.add=function(o){var l;return o.negative!==0&&this.negative===0?(o.negative=0,l=this.sub(o),o.negative^=1,l):o.negative===0&&this.negative!==0?(this.negative=0,l=o.sub(this),this.negative=1,l):this.length>o.length?this.clone().iadd(o):o.clone().iadd(this)},n.prototype.isub=function(o){if(o.negative!==0){o.negative=0;var l=this.iadd(o);return o.negative=1,l._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(o),this.negative=1,this._normSign();var h=this.cmp(o);if(h===0)return this.negative=0,this.length=1,this.words[0]=0,this;var m,v;h>0?(m=this,v=o):(m=o,v=this);for(var E=0,A=0;A<v.length;A++)l=(m.words[A]|0)-(v.words[A]|0)+E,E=l>>26,this.words[A]=l&67108863;for(;E!==0&&A<m.length;A++)l=(m.words[A]|0)+E,E=l>>26,this.words[A]=l&67108863;if(E===0&&A<m.length&&m!==this)for(;A<m.length;A++)this.words[A]=m.words[A];return this.length=Math.max(this.length,A),m!==this&&(this.negative=1),this._strip()},n.prototype.sub=function(o){return this.clone().isub(o)};function k(b,o,l){l.negative=o.negative^b.negative;var h=b.length+o.length|0;l.length=h,h=h-1|0;var m=b.words[0]|0,v=o.words[0]|0,E=m*v,A=E&67108863,g=E/67108864|0;l.words[0]=A;for(var c=1;c<h;c++){for(var y=g>>>26,R=g&67108863,_=Math.min(c,o.length-1),N=Math.max(0,c-b.length+1);N<=_;N++){var Lt=c-N|0;m=b.words[Lt]|0,v=o.words[N]|0,E=m*v+R,y+=E/67108864|0,R=E&67108863}l.words[c]=R|0,g=y|0}return g!==0?l.words[c]=g|0:l.length--,l._strip()}var $=function(o,l,h){var m=o.words,v=l.words,E=h.words,A=0,g,c,y,R=m[0]|0,_=R&8191,N=R>>>13,Lt=m[1]|0,j=Lt&8191,K=Lt>>>13,cs=m[2]|0,Q=cs&8191,X=cs>>>13,ls=m[3]|0,Z=ls&8191,tt=ls>>>13,ds=m[4]|0,et=ds&8191,rt=ds>>>13,hs=m[5]|0,st=hs&8191,it=hs>>>13,us=m[6]|0,nt=us&8191,ot=us>>>13,fs=m[7]|0,at=fs&8191,ct=fs>>>13,gs=m[8]|0,lt=gs&8191,dt=gs>>>13,ps=m[9]|0,ht=ps&8191,ut=ps>>>13,ms=v[0]|0,ft=ms&8191,gt=ms>>>13,ys=v[1]|0,pt=ys&8191,mt=ys>>>13,ws=v[2]|0,yt=ws&8191,wt=ws>>>13,vs=v[3]|0,vt=vs&8191,St=vs>>>13,Ss=v[4]|0,bt=Ss&8191,Tt=Ss>>>13,bs=v[5]|0,Et=bs&8191,Pt=bs>>>13,Ts=v[6]|0,At=Ts&8191,Mt=Ts>>>13,Es=v[7]|0,xt=Es&8191,It=Es>>>13,Ps=v[8]|0,kt=Ps&8191,Ot=Ps>>>13,As=v[9]|0,$t=As&8191,Ct=As>>>13;h.negative=o.negative^l.negative,h.length=19,g=Math.imul(_,ft),c=Math.imul(_,gt),c=c+Math.imul(N,ft)|0,y=Math.imul(N,gt);var dr=(A+g|0)+((c&8191)<<13)|0;A=(y+(c>>>13)|0)+(dr>>>26)|0,dr&=67108863,g=Math.imul(j,ft),c=Math.imul(j,gt),c=c+Math.imul(K,ft)|0,y=Math.imul(K,gt),g=g+Math.imul(_,pt)|0,c=c+Math.imul(_,mt)|0,c=c+Math.imul(N,pt)|0,y=y+Math.imul(N,mt)|0;var hr=(A+g|0)+((c&8191)<<13)|0;A=(y+(c>>>13)|0)+(hr>>>26)|0,hr&=67108863,g=Math.imul(Q,ft),c=Math.imul(Q,gt),c=c+Math.imul(X,ft)|0,y=Math.imul(X,gt),g=g+Math.imul(j,pt)|0,c=c+Math.imul(j,mt)|0,c=c+Math.imul(K,pt)|0,y=y+Math.imul(K,mt)|0,g=g+Math.imul(_,yt)|0,c=c+Math.imul(_,wt)|0,c=c+Math.imul(N,yt)|0,y=y+Math.imul(N,wt)|0;var ur=(A+g|0)+((c&8191)<<13)|0;A=(y+(c>>>13)|0)+(ur>>>26)|0,ur&=67108863,g=Math.imul(Z,ft),c=Math.imul(Z,gt),c=c+Math.imul(tt,ft)|0,y=Math.imul(tt,gt),g=g+Math.imul(Q,pt)|0,c=c+Math.imul(Q,mt)|0,c=c+Math.imul(X,pt)|0,y=y+Math.imul(X,mt)|0,g=g+Math.imul(j,yt)|0,c=c+Math.imul(j,wt)|0,c=c+Math.imul(K,yt)|0,y=y+Math.imul(K,wt)|0,g=g+Math.imul(_,vt)|0,c=c+Math.imul(_,St)|0,c=c+Math.imul(N,vt)|0,y=y+Math.imul(N,St)|0;var fr=(A+g|0)+((c&8191)<<13)|0;A=(y+(c>>>13)|0)+(fr>>>26)|0,fr&=67108863,g=Math.imul(et,ft),c=Math.imul(et,gt),c=c+Math.imul(rt,ft)|0,y=Math.imul(rt,gt),g=g+Math.imul(Z,pt)|0,c=c+Math.imul(Z,mt)|0,c=c+Math.imul(tt,pt)|0,y=y+Math.imul(tt,mt)|0,g=g+Math.imul(Q,yt)|0,c=c+Math.imul(Q,wt)|0,c=c+Math.imul(X,yt)|0,y=y+Math.imul(X,wt)|0,g=g+Math.imul(j,vt)|0,c=c+Math.imul(j,St)|0,c=c+Math.imul(K,vt)|0,y=y+Math.imul(K,St)|0,g=g+Math.imul(_,bt)|0,c=c+Math.imul(_,Tt)|0,c=c+Math.imul(N,bt)|0,y=y+Math.imul(N,Tt)|0;var gr=(A+g|0)+((c&8191)<<13)|0;A=(y+(c>>>13)|0)+(gr>>>26)|0,gr&=67108863,g=Math.imul(st,ft),c=Math.imul(st,gt),c=c+Math.imul(it,ft)|0,y=Math.imul(it,gt),g=g+Math.imul(et,pt)|0,c=c+Math.imul(et,mt)|0,c=c+Math.imul(rt,pt)|0,y=y+Math.imul(rt,mt)|0,g=g+Math.imul(Z,yt)|0,c=c+Math.imul(Z,wt)|0,c=c+Math.imul(tt,yt)|0,y=y+Math.imul(tt,wt)|0,g=g+Math.imul(Q,vt)|0,c=c+Math.imul(Q,St)|0,c=c+Math.imul(X,vt)|0,y=y+Math.imul(X,St)|0,g=g+Math.imul(j,bt)|0,c=c+Math.imul(j,Tt)|0,c=c+Math.imul(K,bt)|0,y=y+Math.imul(K,Tt)|0,g=g+Math.imul(_,Et)|0,c=c+Math.imul(_,Pt)|0,c=c+Math.imul(N,Et)|0,y=y+Math.imul(N,Pt)|0;var pr=(A+g|0)+((c&8191)<<13)|0;A=(y+(c>>>13)|0)+(pr>>>26)|0,pr&=67108863,g=Math.imul(nt,ft),c=Math.imul(nt,gt),c=c+Math.imul(ot,ft)|0,y=Math.imul(ot,gt),g=g+Math.imul(st,pt)|0,c=c+Math.imul(st,mt)|0,c=c+Math.imul(it,pt)|0,y=y+Math.imul(it,mt)|0,g=g+Math.imul(et,yt)|0,c=c+Math.imul(et,wt)|0,c=c+Math.imul(rt,yt)|0,y=y+Math.imul(rt,wt)|0,g=g+Math.imul(Z,vt)|0,c=c+Math.imul(Z,St)|0,c=c+Math.imul(tt,vt)|0,y=y+Math.imul(tt,St)|0,g=g+Math.imul(Q,bt)|0,c=c+Math.imul(Q,Tt)|0,c=c+Math.imul(X,bt)|0,y=y+Math.imul(X,Tt)|0,g=g+Math.imul(j,Et)|0,c=c+Math.imul(j,Pt)|0,c=c+Math.imul(K,Et)|0,y=y+Math.imul(K,Pt)|0,g=g+Math.imul(_,At)|0,c=c+Math.imul(_,Mt)|0,c=c+Math.imul(N,At)|0,y=y+Math.imul(N,Mt)|0;var mr=(A+g|0)+((c&8191)<<13)|0;A=(y+(c>>>13)|0)+(mr>>>26)|0,mr&=67108863,g=Math.imul(at,ft),c=Math.imul(at,gt),c=c+Math.imul(ct,ft)|0,y=Math.imul(ct,gt),g=g+Math.imul(nt,pt)|0,c=c+Math.imul(nt,mt)|0,c=c+Math.imul(ot,pt)|0,y=y+Math.imul(ot,mt)|0,g=g+Math.imul(st,yt)|0,c=c+Math.imul(st,wt)|0,c=c+Math.imul(it,yt)|0,y=y+Math.imul(it,wt)|0,g=g+Math.imul(et,vt)|0,c=c+Math.imul(et,St)|0,c=c+Math.imul(rt,vt)|0,y=y+Math.imul(rt,St)|0,g=g+Math.imul(Z,bt)|0,c=c+Math.imul(Z,Tt)|0,c=c+Math.imul(tt,bt)|0,y=y+Math.imul(tt,Tt)|0,g=g+Math.imul(Q,Et)|0,c=c+Math.imul(Q,Pt)|0,c=c+Math.imul(X,Et)|0,y=y+Math.imul(X,Pt)|0,g=g+Math.imul(j,At)|0,c=c+Math.imul(j,Mt)|0,c=c+Math.imul(K,At)|0,y=y+Math.imul(K,Mt)|0,g=g+Math.imul(_,xt)|0,c=c+Math.imul(_,It)|0,c=c+Math.imul(N,xt)|0,y=y+Math.imul(N,It)|0;var yr=(A+g|0)+((c&8191)<<13)|0;A=(y+(c>>>13)|0)+(yr>>>26)|0,yr&=67108863,g=Math.imul(lt,ft),c=Math.imul(lt,gt),c=c+Math.imul(dt,ft)|0,y=Math.imul(dt,gt),g=g+Math.imul(at,pt)|0,c=c+Math.imul(at,mt)|0,c=c+Math.imul(ct,pt)|0,y=y+Math.imul(ct,mt)|0,g=g+Math.imul(nt,yt)|0,c=c+Math.imul(nt,wt)|0,c=c+Math.imul(ot,yt)|0,y=y+Math.imul(ot,wt)|0,g=g+Math.imul(st,vt)|0,c=c+Math.imul(st,St)|0,c=c+Math.imul(it,vt)|0,y=y+Math.imul(it,St)|0,g=g+Math.imul(et,bt)|0,c=c+Math.imul(et,Tt)|0,c=c+Math.imul(rt,bt)|0,y=y+Math.imul(rt,Tt)|0,g=g+Math.imul(Z,Et)|0,c=c+Math.imul(Z,Pt)|0,c=c+Math.imul(tt,Et)|0,y=y+Math.imul(tt,Pt)|0,g=g+Math.imul(Q,At)|0,c=c+Math.imul(Q,Mt)|0,c=c+Math.imul(X,At)|0,y=y+Math.imul(X,Mt)|0,g=g+Math.imul(j,xt)|0,c=c+Math.imul(j,It)|0,c=c+Math.imul(K,xt)|0,y=y+Math.imul(K,It)|0,g=g+Math.imul(_,kt)|0,c=c+Math.imul(_,Ot)|0,c=c+Math.imul(N,kt)|0,y=y+Math.imul(N,Ot)|0;var wr=(A+g|0)+((c&8191)<<13)|0;A=(y+(c>>>13)|0)+(wr>>>26)|0,wr&=67108863,g=Math.imul(ht,ft),c=Math.imul(ht,gt),c=c+Math.imul(ut,ft)|0,y=Math.imul(ut,gt),g=g+Math.imul(lt,pt)|0,c=c+Math.imul(lt,mt)|0,c=c+Math.imul(dt,pt)|0,y=y+Math.imul(dt,mt)|0,g=g+Math.imul(at,yt)|0,c=c+Math.imul(at,wt)|0,c=c+Math.imul(ct,yt)|0,y=y+Math.imul(ct,wt)|0,g=g+Math.imul(nt,vt)|0,c=c+Math.imul(nt,St)|0,c=c+Math.imul(ot,vt)|0,y=y+Math.imul(ot,St)|0,g=g+Math.imul(st,bt)|0,c=c+Math.imul(st,Tt)|0,c=c+Math.imul(it,bt)|0,y=y+Math.imul(it,Tt)|0,g=g+Math.imul(et,Et)|0,c=c+Math.imul(et,Pt)|0,c=c+Math.imul(rt,Et)|0,y=y+Math.imul(rt,Pt)|0,g=g+Math.imul(Z,At)|0,c=c+Math.imul(Z,Mt)|0,c=c+Math.imul(tt,At)|0,y=y+Math.imul(tt,Mt)|0,g=g+Math.imul(Q,xt)|0,c=c+Math.imul(Q,It)|0,c=c+Math.imul(X,xt)|0,y=y+Math.imul(X,It)|0,g=g+Math.imul(j,kt)|0,c=c+Math.imul(j,Ot)|0,c=c+Math.imul(K,kt)|0,y=y+Math.imul(K,Ot)|0,g=g+Math.imul(_,$t)|0,c=c+Math.imul(_,Ct)|0,c=c+Math.imul(N,$t)|0,y=y+Math.imul(N,Ct)|0;var vr=(A+g|0)+((c&8191)<<13)|0;A=(y+(c>>>13)|0)+(vr>>>26)|0,vr&=67108863,g=Math.imul(ht,pt),c=Math.imul(ht,mt),c=c+Math.imul(ut,pt)|0,y=Math.imul(ut,mt),g=g+Math.imul(lt,yt)|0,c=c+Math.imul(lt,wt)|0,c=c+Math.imul(dt,yt)|0,y=y+Math.imul(dt,wt)|0,g=g+Math.imul(at,vt)|0,c=c+Math.imul(at,St)|0,c=c+Math.imul(ct,vt)|0,y=y+Math.imul(ct,St)|0,g=g+Math.imul(nt,bt)|0,c=c+Math.imul(nt,Tt)|0,c=c+Math.imul(ot,bt)|0,y=y+Math.imul(ot,Tt)|0,g=g+Math.imul(st,Et)|0,c=c+Math.imul(st,Pt)|0,c=c+Math.imul(it,Et)|0,y=y+Math.imul(it,Pt)|0,g=g+Math.imul(et,At)|0,c=c+Math.imul(et,Mt)|0,c=c+Math.imul(rt,At)|0,y=y+Math.imul(rt,Mt)|0,g=g+Math.imul(Z,xt)|0,c=c+Math.imul(Z,It)|0,c=c+Math.imul(tt,xt)|0,y=y+Math.imul(tt,It)|0,g=g+Math.imul(Q,kt)|0,c=c+Math.imul(Q,Ot)|0,c=c+Math.imul(X,kt)|0,y=y+Math.imul(X,Ot)|0,g=g+Math.imul(j,$t)|0,c=c+Math.imul(j,Ct)|0,c=c+Math.imul(K,$t)|0,y=y+Math.imul(K,Ct)|0;var Sr=(A+g|0)+((c&8191)<<13)|0;A=(y+(c>>>13)|0)+(Sr>>>26)|0,Sr&=67108863,g=Math.imul(ht,yt),c=Math.imul(ht,wt),c=c+Math.imul(ut,yt)|0,y=Math.imul(ut,wt),g=g+Math.imul(lt,vt)|0,c=c+Math.imul(lt,St)|0,c=c+Math.imul(dt,vt)|0,y=y+Math.imul(dt,St)|0,g=g+Math.imul(at,bt)|0,c=c+Math.imul(at,Tt)|0,c=c+Math.imul(ct,bt)|0,y=y+Math.imul(ct,Tt)|0,g=g+Math.imul(nt,Et)|0,c=c+Math.imul(nt,Pt)|0,c=c+Math.imul(ot,Et)|0,y=y+Math.imul(ot,Pt)|0,g=g+Math.imul(st,At)|0,c=c+Math.imul(st,Mt)|0,c=c+Math.imul(it,At)|0,y=y+Math.imul(it,Mt)|0,g=g+Math.imul(et,xt)|0,c=c+Math.imul(et,It)|0,c=c+Math.imul(rt,xt)|0,y=y+Math.imul(rt,It)|0,g=g+Math.imul(Z,kt)|0,c=c+Math.imul(Z,Ot)|0,c=c+Math.imul(tt,kt)|0,y=y+Math.imul(tt,Ot)|0,g=g+Math.imul(Q,$t)|0,c=c+Math.imul(Q,Ct)|0,c=c+Math.imul(X,$t)|0,y=y+Math.imul(X,Ct)|0;var br=(A+g|0)+((c&8191)<<13)|0;A=(y+(c>>>13)|0)+(br>>>26)|0,br&=67108863,g=Math.imul(ht,vt),c=Math.imul(ht,St),c=c+Math.imul(ut,vt)|0,y=Math.imul(ut,St),g=g+Math.imul(lt,bt)|0,c=c+Math.imul(lt,Tt)|0,c=c+Math.imul(dt,bt)|0,y=y+Math.imul(dt,Tt)|0,g=g+Math.imul(at,Et)|0,c=c+Math.imul(at,Pt)|0,c=c+Math.imul(ct,Et)|0,y=y+Math.imul(ct,Pt)|0,g=g+Math.imul(nt,At)|0,c=c+Math.imul(nt,Mt)|0,c=c+Math.imul(ot,At)|0,y=y+Math.imul(ot,Mt)|0,g=g+Math.imul(st,xt)|0,c=c+Math.imul(st,It)|0,c=c+Math.imul(it,xt)|0,y=y+Math.imul(it,It)|0,g=g+Math.imul(et,kt)|0,c=c+Math.imul(et,Ot)|0,c=c+Math.imul(rt,kt)|0,y=y+Math.imul(rt,Ot)|0,g=g+Math.imul(Z,$t)|0,c=c+Math.imul(Z,Ct)|0,c=c+Math.imul(tt,$t)|0,y=y+Math.imul(tt,Ct)|0;var Tr=(A+g|0)+((c&8191)<<13)|0;A=(y+(c>>>13)|0)+(Tr>>>26)|0,Tr&=67108863,g=Math.imul(ht,bt),c=Math.imul(ht,Tt),c=c+Math.imul(ut,bt)|0,y=Math.imul(ut,Tt),g=g+Math.imul(lt,Et)|0,c=c+Math.imul(lt,Pt)|0,c=c+Math.imul(dt,Et)|0,y=y+Math.imul(dt,Pt)|0,g=g+Math.imul(at,At)|0,c=c+Math.imul(at,Mt)|0,c=c+Math.imul(ct,At)|0,y=y+Math.imul(ct,Mt)|0,g=g+Math.imul(nt,xt)|0,c=c+Math.imul(nt,It)|0,c=c+Math.imul(ot,xt)|0,y=y+Math.imul(ot,It)|0,g=g+Math.imul(st,kt)|0,c=c+Math.imul(st,Ot)|0,c=c+Math.imul(it,kt)|0,y=y+Math.imul(it,Ot)|0,g=g+Math.imul(et,$t)|0,c=c+Math.imul(et,Ct)|0,c=c+Math.imul(rt,$t)|0,y=y+Math.imul(rt,Ct)|0;var Er=(A+g|0)+((c&8191)<<13)|0;A=(y+(c>>>13)|0)+(Er>>>26)|0,Er&=67108863,g=Math.imul(ht,Et),c=Math.imul(ht,Pt),c=c+Math.imul(ut,Et)|0,y=Math.imul(ut,Pt),g=g+Math.imul(lt,At)|0,c=c+Math.imul(lt,Mt)|0,c=c+Math.imul(dt,At)|0,y=y+Math.imul(dt,Mt)|0,g=g+Math.imul(at,xt)|0,c=c+Math.imul(at,It)|0,c=c+Math.imul(ct,xt)|0,y=y+Math.imul(ct,It)|0,g=g+Math.imul(nt,kt)|0,c=c+Math.imul(nt,Ot)|0,c=c+Math.imul(ot,kt)|0,y=y+Math.imul(ot,Ot)|0,g=g+Math.imul(st,$t)|0,c=c+Math.imul(st,Ct)|0,c=c+Math.imul(it,$t)|0,y=y+Math.imul(it,Ct)|0;var Pr=(A+g|0)+((c&8191)<<13)|0;A=(y+(c>>>13)|0)+(Pr>>>26)|0,Pr&=67108863,g=Math.imul(ht,At),c=Math.imul(ht,Mt),c=c+Math.imul(ut,At)|0,y=Math.imul(ut,Mt),g=g+Math.imul(lt,xt)|0,c=c+Math.imul(lt,It)|0,c=c+Math.imul(dt,xt)|0,y=y+Math.imul(dt,It)|0,g=g+Math.imul(at,kt)|0,c=c+Math.imul(at,Ot)|0,c=c+Math.imul(ct,kt)|0,y=y+Math.imul(ct,Ot)|0,g=g+Math.imul(nt,$t)|0,c=c+Math.imul(nt,Ct)|0,c=c+Math.imul(ot,$t)|0,y=y+Math.imul(ot,Ct)|0;var Ar=(A+g|0)+((c&8191)<<13)|0;A=(y+(c>>>13)|0)+(Ar>>>26)|0,Ar&=67108863,g=Math.imul(ht,xt),c=Math.imul(ht,It),c=c+Math.imul(ut,xt)|0,y=Math.imul(ut,It),g=g+Math.imul(lt,kt)|0,c=c+Math.imul(lt,Ot)|0,c=c+Math.imul(dt,kt)|0,y=y+Math.imul(dt,Ot)|0,g=g+Math.imul(at,$t)|0,c=c+Math.imul(at,Ct)|0,c=c+Math.imul(ct,$t)|0,y=y+Math.imul(ct,Ct)|0;var Mr=(A+g|0)+((c&8191)<<13)|0;A=(y+(c>>>13)|0)+(Mr>>>26)|0,Mr&=67108863,g=Math.imul(ht,kt),c=Math.imul(ht,Ot),c=c+Math.imul(ut,kt)|0,y=Math.imul(ut,Ot),g=g+Math.imul(lt,$t)|0,c=c+Math.imul(lt,Ct)|0,c=c+Math.imul(dt,$t)|0,y=y+Math.imul(dt,Ct)|0;var xr=(A+g|0)+((c&8191)<<13)|0;A=(y+(c>>>13)|0)+(xr>>>26)|0,xr&=67108863,g=Math.imul(ht,$t),c=Math.imul(ht,Ct),c=c+Math.imul(ut,$t)|0,y=Math.imul(ut,Ct);var Ir=(A+g|0)+((c&8191)<<13)|0;return A=(y+(c>>>13)|0)+(Ir>>>26)|0,Ir&=67108863,E[0]=dr,E[1]=hr,E[2]=ur,E[3]=fr,E[4]=gr,E[5]=pr,E[6]=mr,E[7]=yr,E[8]=wr,E[9]=vr,E[10]=Sr,E[11]=br,E[12]=Tr,E[13]=Er,E[14]=Pr,E[15]=Ar,E[16]=Mr,E[17]=xr,E[18]=Ir,A!==0&&(E[19]=A,h.length++),h};Math.imul||($=k);function O(b,o,l){l.negative=o.negative^b.negative,l.length=b.length+o.length;for(var h=0,m=0,v=0;v<l.length-1;v++){var E=m;m=0;for(var A=h&67108863,g=Math.min(v,o.length-1),c=Math.max(0,v-b.length+1);c<=g;c++){var y=v-c,R=b.words[y]|0,_=o.words[c]|0,N=R*_,Lt=N&67108863;E=E+(N/67108864|0)|0,Lt=Lt+A|0,A=Lt&67108863,E=E+(Lt>>>26)|0,m+=E>>>26,E&=67108863}l.words[v]=A,h=E,E=m}return h!==0?l.words[v]=h:l.length--,l._strip()}function C(b,o,l){return O(b,o,l)}n.prototype.mulTo=function(o,l){var h,m=this.length+o.length;return this.length===10&&o.length===10?h=$(this,o,l):m<63?h=k(this,o,l):m<1024?h=O(this,o,l):h=C(this,o,l),h},n.prototype.mul=function(o){var l=new n(null);return l.words=new Array(this.length+o.length),this.mulTo(o,l)},n.prototype.mulf=function(o){var l=new n(null);return l.words=new Array(this.length+o.length),C(this,o,l)},n.prototype.imul=function(o){return this.clone().mulTo(o,this)},n.prototype.imuln=function(o){var l=o<0;l&&(o=-o),s(typeof o=="number"),s(o<67108864);for(var h=0,m=0;m<this.length;m++){var v=(this.words[m]|0)*o,E=(v&67108863)+(h&67108863);h>>=26,h+=v/67108864|0,h+=E>>>26,this.words[m]=E&67108863}return h!==0&&(this.words[m]=h,this.length++),this.length=o===0?1:this.length,l?this.ineg():this},n.prototype.muln=function(o){return this.clone().imuln(o)},n.prototype.sqr=function(){return this.mul(this)},n.prototype.isqr=function(){return this.imul(this.clone())},n.prototype.pow=function(o){var l=M(o);if(l.length===0)return new n(1);for(var h=this,m=0;m<l.length&&l[m]===0;m++,h=h.sqr());if(++m<l.length)for(var v=h.sqr();m<l.length;m++,v=v.sqr())l[m]!==0&&(h=h.mul(v));return h},n.prototype.iushln=function(o){s(typeof o=="number"&&o>=0);var l=o%26,h=(o-l)/26,m=67108863>>>26-l<<26-l,v;if(l!==0){var E=0;for(v=0;v<this.length;v++){var A=this.words[v]&m,g=(this.words[v]|0)-A<<l;this.words[v]=g|E,E=A>>>26-l}E&&(this.words[v]=E,this.length++)}if(h!==0){for(v=this.length-1;v>=0;v--)this.words[v+h]=this.words[v];for(v=0;v<h;v++)this.words[v]=0;this.length+=h}return this._strip()},n.prototype.ishln=function(o){return s(this.negative===0),this.iushln(o)},n.prototype.iushrn=function(o,l,h){s(typeof o=="number"&&o>=0);var m;l?m=(l-l%26)/26:m=0;var v=o%26,E=Math.min((o-v)/26,this.length),A=67108863^67108863>>>v<<v,g=h;if(m-=E,m=Math.max(0,m),g){for(var c=0;c<E;c++)g.words[c]=this.words[c];g.length=E}if(E!==0)if(this.length>E)for(this.length-=E,c=0;c<this.length;c++)this.words[c]=this.words[c+E];else this.words[0]=0,this.length=1;var y=0;for(c=this.length-1;c>=0&&(y!==0||c>=m);c--){var R=this.words[c]|0;this.words[c]=y<<26-v|R>>>v,y=R&A}return g&&y!==0&&(g.words[g.length++]=y),this.length===0&&(this.words[0]=0,this.length=1),this._strip()},n.prototype.ishrn=function(o,l,h){return s(this.negative===0),this.iushrn(o,l,h)},n.prototype.shln=function(o){return this.clone().ishln(o)},n.prototype.ushln=function(o){return this.clone().iushln(o)},n.prototype.shrn=function(o){return this.clone().ishrn(o)},n.prototype.ushrn=function(o){return this.clone().iushrn(o)},n.prototype.testn=function(o){s(typeof o=="number"&&o>=0);var l=o%26,h=(o-l)/26,m=1<<l;if(this.length<=h)return!1;var v=this.words[h];return!!(v&m)},n.prototype.imaskn=function(o){s(typeof o=="number"&&o>=0);var l=o%26,h=(o-l)/26;if(s(this.negative===0,"imaskn works only with positive numbers"),this.length<=h)return this;if(l!==0&&h++,this.length=Math.min(h,this.length),l!==0){var m=67108863^67108863>>>l<<l;this.words[this.length-1]&=m}return this._strip()},n.prototype.maskn=function(o){return this.clone().imaskn(o)},n.prototype.iaddn=function(o){return s(typeof o=="number"),s(o<67108864),o<0?this.isubn(-o):this.negative!==0?this.length===1&&(this.words[0]|0)<=o?(this.words[0]=o-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(o),this.negative=1,this):this._iaddn(o)},n.prototype._iaddn=function(o){this.words[0]+=o;for(var l=0;l<this.length&&this.words[l]>=67108864;l++)this.words[l]-=67108864,l===this.length-1?this.words[l+1]=1:this.words[l+1]++;return this.length=Math.max(this.length,l+1),this},n.prototype.isubn=function(o){if(s(typeof o=="number"),s(o<67108864),o<0)return this.iaddn(-o);if(this.negative!==0)return this.negative=0,this.iaddn(o),this.negative=1,this;if(this.words[0]-=o,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var l=0;l<this.length&&this.words[l]<0;l++)this.words[l]+=67108864,this.words[l+1]-=1;return this._strip()},n.prototype.addn=function(o){return this.clone().iaddn(o)},n.prototype.subn=function(o){return this.clone().isubn(o)},n.prototype.iabs=function(){return this.negative=0,this},n.prototype.abs=function(){return this.clone().iabs()},n.prototype._ishlnsubmul=function(o,l,h){var m=o.length+h,v;this._expand(m);var E,A=0;for(v=0;v<o.length;v++){E=(this.words[v+h]|0)+A;var g=(o.words[v]|0)*l;E-=g&67108863,A=(E>>26)-(g/67108864|0),this.words[v+h]=E&67108863}for(;v<this.length-h;v++)E=(this.words[v+h]|0)+A,A=E>>26,this.words[v+h]=E&67108863;if(A===0)return this._strip();for(s(A===-1),A=0,v=0;v<this.length;v++)E=-(this.words[v]|0)+A,A=E>>26,this.words[v]=E&67108863;return this.negative=1,this._strip()},n.prototype._wordDiv=function(o,l){var h=this.length-o.length,m=this.clone(),v=o,E=v.words[v.length-1]|0,A=this._countBits(E);h=26-A,h!==0&&(v=v.ushln(h),m.iushln(h),E=v.words[v.length-1]|0);var g=m.length-v.length,c;if(l!=="mod"){c=new n(null),c.length=g+1,c.words=new Array(c.length);for(var y=0;y<c.length;y++)c.words[y]=0}var R=m.clone()._ishlnsubmul(v,1,g);R.negative===0&&(m=R,c&&(c.words[g]=1));for(var _=g-1;_>=0;_--){var N=(m.words[v.length+_]|0)*67108864+(m.words[v.length+_-1]|0);for(N=Math.min(N/E|0,67108863),m._ishlnsubmul(v,N,_);m.negative!==0;)N--,m.negative=0,m._ishlnsubmul(v,1,_),m.isZero()||(m.negative^=1);c&&(c.words[_]=N)}return c&&c._strip(),m._strip(),l!=="div"&&h!==0&&m.iushrn(h),{div:c||null,mod:m}},n.prototype.divmod=function(o,l,h){if(s(!o.isZero()),this.isZero())return{div:new n(0),mod:new n(0)};var m,v,E;return this.negative!==0&&o.negative===0?(E=this.neg().divmod(o,l),l!=="mod"&&(m=E.div.neg()),l!=="div"&&(v=E.mod.neg(),h&&v.negative!==0&&v.iadd(o)),{div:m,mod:v}):this.negative===0&&o.negative!==0?(E=this.divmod(o.neg(),l),l!=="mod"&&(m=E.div.neg()),{div:m,mod:E.mod}):(this.negative&o.negative)!==0?(E=this.neg().divmod(o.neg(),l),l!=="div"&&(v=E.mod.neg(),h&&v.negative!==0&&v.isub(o)),{div:E.div,mod:v}):o.length>this.length||this.cmp(o)<0?{div:new n(0),mod:this}:o.length===1?l==="div"?{div:this.divn(o.words[0]),mod:null}:l==="mod"?{div:null,mod:new n(this.modrn(o.words[0]))}:{div:this.divn(o.words[0]),mod:new n(this.modrn(o.words[0]))}:this._wordDiv(o,l)},n.prototype.div=function(o){return this.divmod(o,"div",!1).div},n.prototype.mod=function(o){return this.divmod(o,"mod",!1).mod},n.prototype.umod=function(o){return this.divmod(o,"mod",!0).mod},n.prototype.divRound=function(o){var l=this.divmod(o);if(l.mod.isZero())return l.div;var h=l.div.negative!==0?l.mod.isub(o):l.mod,m=o.ushrn(1),v=o.andln(1),E=h.cmp(m);return E<0||v===1&&E===0?l.div:l.div.negative!==0?l.div.isubn(1):l.div.iaddn(1)},n.prototype.modrn=function(o){var l=o<0;l&&(o=-o),s(o<=67108863);for(var h=(1<<26)%o,m=0,v=this.length-1;v>=0;v--)m=(h*m+(this.words[v]|0))%o;return l?-m:m},n.prototype.modn=function(o){return this.modrn(o)},n.prototype.idivn=function(o){var l=o<0;l&&(o=-o),s(o<=67108863);for(var h=0,m=this.length-1;m>=0;m--){var v=(this.words[m]|0)+h*67108864;this.words[m]=v/o|0,h=v%o}return this._strip(),l?this.ineg():this},n.prototype.divn=function(o){return this.clone().idivn(o)},n.prototype.egcd=function(o){s(o.negative===0),s(!o.isZero());var l=this,h=o.clone();l.negative!==0?l=l.umod(o):l=l.clone();for(var m=new n(1),v=new n(0),E=new n(0),A=new n(1),g=0;l.isEven()&&h.isEven();)l.iushrn(1),h.iushrn(1),++g;for(var c=h.clone(),y=l.clone();!l.isZero();){for(var R=0,_=1;(l.words[0]&_)===0&&R<26;++R,_<<=1);if(R>0)for(l.iushrn(R);R-- >0;)(m.isOdd()||v.isOdd())&&(m.iadd(c),v.isub(y)),m.iushrn(1),v.iushrn(1);for(var N=0,Lt=1;(h.words[0]&Lt)===0&&N<26;++N,Lt<<=1);if(N>0)for(h.iushrn(N);N-- >0;)(E.isOdd()||A.isOdd())&&(E.iadd(c),A.isub(y)),E.iushrn(1),A.iushrn(1);l.cmp(h)>=0?(l.isub(h),m.isub(E),v.isub(A)):(h.isub(l),E.isub(m),A.isub(v))}return{a:E,b:A,gcd:h.iushln(g)}},n.prototype._invmp=function(o){s(o.negative===0),s(!o.isZero());var l=this,h=o.clone();l.negative!==0?l=l.umod(o):l=l.clone();for(var m=new n(1),v=new n(0),E=h.clone();l.cmpn(1)>0&&h.cmpn(1)>0;){for(var A=0,g=1;(l.words[0]&g)===0&&A<26;++A,g<<=1);if(A>0)for(l.iushrn(A);A-- >0;)m.isOdd()&&m.iadd(E),m.iushrn(1);for(var c=0,y=1;(h.words[0]&y)===0&&c<26;++c,y<<=1);if(c>0)for(h.iushrn(c);c-- >0;)v.isOdd()&&v.iadd(E),v.iushrn(1);l.cmp(h)>=0?(l.isub(h),m.isub(v)):(h.isub(l),v.isub(m))}var R;return l.cmpn(1)===0?R=m:R=v,R.cmpn(0)<0&&R.iadd(o),R},n.prototype.gcd=function(o){if(this.isZero())return o.abs();if(o.isZero())return this.abs();var l=this.clone(),h=o.clone();l.negative=0,h.negative=0;for(var m=0;l.isEven()&&h.isEven();m++)l.iushrn(1),h.iushrn(1);do{for(;l.isEven();)l.iushrn(1);for(;h.isEven();)h.iushrn(1);var v=l.cmp(h);if(v<0){var E=l;l=h,h=E}else if(v===0||h.cmpn(1)===0)break;l.isub(h)}while(!0);return h.iushln(m)},n.prototype.invm=function(o){return this.egcd(o).a.umod(o)},n.prototype.isEven=function(){return(this.words[0]&1)===0},n.prototype.isOdd=function(){return(this.words[0]&1)===1},n.prototype.andln=function(o){return this.words[0]&o},n.prototype.bincn=function(o){s(typeof o=="number");var l=o%26,h=(o-l)/26,m=1<<l;if(this.length<=h)return this._expand(h+1),this.words[h]|=m,this;for(var v=m,E=h;v!==0&&E<this.length;E++){var A=this.words[E]|0;A+=v,v=A>>>26,A&=67108863,this.words[E]=A}return v!==0&&(this.words[E]=v,this.length++),this},n.prototype.isZero=function(){return this.length===1&&this.words[0]===0},n.prototype.cmpn=function(o){var l=o<0;if(this.negative!==0&&!l)return-1;if(this.negative===0&&l)return 1;this._strip();var h;if(this.length>1)h=1;else{l&&(o=-o),s(o<=67108863,"Number is too big");var m=this.words[0]|0;h=m===o?0:m<o?-1:1}return this.negative!==0?-h|0:h},n.prototype.cmp=function(o){if(this.negative!==0&&o.negative===0)return-1;if(this.negative===0&&o.negative!==0)return 1;var l=this.ucmp(o);return this.negative!==0?-l|0:l},n.prototype.ucmp=function(o){if(this.length>o.length)return 1;if(this.length<o.length)return-1;for(var l=0,h=this.length-1;h>=0;h--){var m=this.words[h]|0,v=o.words[h]|0;if(m!==v){m<v?l=-1:m>v&&(l=1);break}}return l},n.prototype.gtn=function(o){return this.cmpn(o)===1},n.prototype.gt=function(o){return this.cmp(o)===1},n.prototype.gten=function(o){return this.cmpn(o)>=0},n.prototype.gte=function(o){return this.cmp(o)>=0},n.prototype.ltn=function(o){return this.cmpn(o)===-1},n.prototype.lt=function(o){return this.cmp(o)===-1},n.prototype.lten=function(o){return this.cmpn(o)<=0},n.prototype.lte=function(o){return this.cmp(o)<=0},n.prototype.eqn=function(o){return this.cmpn(o)===0},n.prototype.eq=function(o){return this.cmp(o)===0},n.red=function(o){return new G(o)},n.prototype.toRed=function(o){return s(!this.red,"Already a number in reduction context"),s(this.negative===0,"red works only with positives"),o.convertTo(this)._forceRed(o)},n.prototype.fromRed=function(){return s(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},n.prototype._forceRed=function(o){return this.red=o,this},n.prototype.forceRed=function(o){return s(!this.red,"Already a number in reduction context"),this._forceRed(o)},n.prototype.redAdd=function(o){return s(this.red,"redAdd works only with red numbers"),this.red.add(this,o)},n.prototype.redIAdd=function(o){return s(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,o)},n.prototype.redSub=function(o){return s(this.red,"redSub works only with red numbers"),this.red.sub(this,o)},n.prototype.redISub=function(o){return s(this.red,"redISub works only with red numbers"),this.red.isub(this,o)},n.prototype.redShl=function(o){return s(this.red,"redShl works only with red numbers"),this.red.shl(this,o)},n.prototype.redMul=function(o){return s(this.red,"redMul works only with red numbers"),this.red._verify2(this,o),this.red.mul(this,o)},n.prototype.redIMul=function(o){return s(this.red,"redMul works only with red numbers"),this.red._verify2(this,o),this.red.imul(this,o)},n.prototype.redSqr=function(){return s(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},n.prototype.redISqr=function(){return s(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},n.prototype.redSqrt=function(){return s(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},n.prototype.redInvm=function(){return s(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},n.prototype.redNeg=function(){return s(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},n.prototype.redPow=function(o){return s(this.red&&!o.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,o)};var D={k256:null,p224:null,p192:null,p25519:null};function U(b,o){this.name=b,this.p=new n(o,16),this.n=this.p.bitLength(),this.k=new n(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}U.prototype._tmp=function(){var o=new n(null);return o.words=new Array(Math.ceil(this.n/13)),o},U.prototype.ireduce=function(o){var l=o,h;do this.split(l,this.tmp),l=this.imulK(l),l=l.iadd(this.tmp),h=l.bitLength();while(h>this.n);var m=h<this.n?-1:l.ucmp(this.p);return m===0?(l.words[0]=0,l.length=1):m>0?l.isub(this.p):l.strip!==void 0?l.strip():l._strip(),l},U.prototype.split=function(o,l){o.iushrn(this.n,0,l)},U.prototype.imulK=function(o){return o.imul(this.k)};function q(){U.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}i(q,U),q.prototype.split=function(o,l){for(var h=4194303,m=Math.min(o.length,9),v=0;v<m;v++)l.words[v]=o.words[v];if(l.length=m,o.length<=9){o.words[0]=0,o.length=1;return}var E=o.words[9];for(l.words[l.length++]=E&h,v=10;v<o.length;v++){var A=o.words[v]|0;o.words[v-10]=(A&h)<<4|E>>>22,E=A}E>>>=22,o.words[v-10]=E,E===0&&o.length>10?o.length-=10:o.length-=9},q.prototype.imulK=function(o){o.words[o.length]=0,o.words[o.length+1]=0,o.length+=2;for(var l=0,h=0;h<o.length;h++){var m=o.words[h]|0;l+=m*977,o.words[h]=l&67108863,l=m*64+(l/67108864|0)}return o.words[o.length-1]===0&&(o.length--,o.words[o.length-1]===0&&o.length--),o};function Ft(){U.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}i(Ft,U);function Yt(){U.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}i(Yt,U);function Vt(){U.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}i(Vt,U),Vt.prototype.imulK=function(o){for(var l=0,h=0;h<o.length;h++){var m=(o.words[h]|0)*19+l,v=m&67108863;m>>>=26,o.words[h]=v,l=m}return l!==0&&(o.words[o.length++]=l),o},n._prime=function(o){if(D[o])return D[o];var l;if(o==="k256")l=new q;else if(o==="p224")l=new Ft;else if(o==="p192")l=new Yt;else if(o==="p25519")l=new Vt;else throw new Error("Unknown prime "+o);return D[o]=l,l};function G(b){if(typeof b=="string"){var o=n._prime(b);this.m=o.p,this.prime=o}else s(b.gtn(1),"modulus must be greater than 1"),this.m=b,this.prime=null}G.prototype._verify1=function(o){s(o.negative===0,"red works only with positives"),s(o.red,"red works only with red numbers")},G.prototype._verify2=function(o,l){s((o.negative|l.negative)===0,"red works only with positives"),s(o.red&&o.red===l.red,"red works only with red numbers")},G.prototype.imod=function(o){return this.prime?this.prime.ireduce(o)._forceRed(this):(w(o,o.umod(this.m)._forceRed(this)),o)},G.prototype.neg=function(o){return o.isZero()?o.clone():this.m.sub(o)._forceRed(this)},G.prototype.add=function(o,l){this._verify2(o,l);var h=o.add(l);return h.cmp(this.m)>=0&&h.isub(this.m),h._forceRed(this)},G.prototype.iadd=function(o,l){this._verify2(o,l);var h=o.iadd(l);return h.cmp(this.m)>=0&&h.isub(this.m),h},G.prototype.sub=function(o,l){this._verify2(o,l);var h=o.sub(l);return h.cmpn(0)<0&&h.iadd(this.m),h._forceRed(this)},G.prototype.isub=function(o,l){this._verify2(o,l);var h=o.isub(l);return h.cmpn(0)<0&&h.iadd(this.m),h},G.prototype.shl=function(o,l){return this._verify1(o),this.imod(o.ushln(l))},G.prototype.imul=function(o,l){return this._verify2(o,l),this.imod(o.imul(l))},G.prototype.mul=function(o,l){return this._verify2(o,l),this.imod(o.mul(l))},G.prototype.isqr=function(o){return this.imul(o,o.clone())},G.prototype.sqr=function(o){return this.mul(o,o)},G.prototype.sqrt=function(o){if(o.isZero())return o.clone();var l=this.m.andln(3);if(s(l%2===1),l===3){var h=this.m.add(new n(1)).iushrn(2);return this.pow(o,h)}for(var m=this.m.subn(1),v=0;!m.isZero()&&m.andln(1)===0;)v++,m.iushrn(1);s(!m.isZero());var E=new n(1).toRed(this),A=E.redNeg(),g=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new n(2*c*c).toRed(this);this.pow(c,g).cmp(A)!==0;)c.redIAdd(A);for(var y=this.pow(c,m),R=this.pow(o,m.addn(1).iushrn(1)),_=this.pow(o,m),N=v;_.cmp(E)!==0;){for(var Lt=_,j=0;Lt.cmp(E)!==0;j++)Lt=Lt.redSqr();s(j<N);var K=this.pow(y,new n(1).iushln(N-j-1));R=R.redMul(K),y=K.redSqr(),_=_.redMul(y),N=j}return R},G.prototype.invm=function(o){var l=o._invmp(this.m);return l.negative!==0?(l.negative=0,this.imod(l).redNeg()):this.imod(l)},G.prototype.pow=function(o,l){if(l.isZero())return new n(1).toRed(this);if(l.cmpn(1)===0)return o.clone();var h=4,m=new Array(1<<h);m[0]=new n(1).toRed(this),m[1]=o;for(var v=2;v<m.length;v++)m[v]=this.mul(m[v-1],o);var E=m[0],A=0,g=0,c=l.bitLength()%26;for(c===0&&(c=26),v=l.length-1;v>=0;v--){for(var y=l.words[v],R=c-1;R>=0;R--){var _=y>>R&1;if(E!==m[0]&&(E=this.sqr(E)),_===0&&A===0){g=0;continue}A<<=1,A|=_,g++,!(g!==h&&(v!==0||R!==0))&&(E=this.mul(E,m[A]),g=0,A=0)}c=26}return E},G.prototype.convertTo=function(o){var l=o.umod(this.m);return l===o?l.clone():l},G.prototype.convertFrom=function(o){var l=o.clone();return l.red=null,l},n.mont=function(o){return new qt(o)};function qt(b){G.call(this,b),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new n(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}i(qt,G),qt.prototype.convertTo=function(o){return this.imod(o.ushln(this.shift))},qt.prototype.convertFrom=function(o){var l=this.imod(o.mul(this.rinv));return l.red=null,l},qt.prototype.imul=function(o,l){if(o.isZero()||l.isZero())return o.words[0]=0,o.length=1,o;var h=o.imul(l),m=h.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),v=h.isub(m).iushrn(this.shift),E=v;return v.cmp(this.m)>=0?E=v.isub(this.m):v.cmpn(0)<0&&(E=v.iadd(this.m)),E._forceRed(this)},qt.prototype.mul=function(o,l){if(o.isZero()||l.isZero())return new n(0)._forceRed(this);var h=o.mul(l),m=h.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),v=h.isub(m).iushrn(this.shift),E=v;return v.cmp(this.m)>=0?E=v.isub(this.m):v.cmpn(0)<0&&(E=v.iadd(this.m)),E._forceRed(this)},qt.prototype.invm=function(o){var l=this.imod(o._invmp(this.m).mul(this.r2));return l._forceRed(this)}})(r,wd)})(Je)),Je.exports}var Sd=vd();const bd=Bc(Sd),Td="logger/5.8.0";let oi=!1,ai=!1;const Qe={debug:1,default:2,info:2,warning:3,error:4,off:5};let ci=Qe.default,Fr=null;function Ed(){try{const r=[];if(["NFD","NFC","NFKD","NFKC"].forEach(t=>{try{if("test".normalize(t)!=="test")throw new Error("bad normalize")}catch{r.push(t)}}),r.length)throw new Error("missing "+r.join(", "));if("é".normalize("NFD")!=="é")throw new Error("broken implementation")}catch(r){return r.message}return null}const li=Ed();var Qr;(function(r){r.DEBUG="DEBUG",r.INFO="INFO",r.WARNING="WARNING",r.ERROR="ERROR",r.OFF="OFF"})(Qr||(Qr={}));var se;(function(r){r.UNKNOWN_ERROR="UNKNOWN_ERROR",r.NOT_IMPLEMENTED="NOT_IMPLEMENTED",r.UNSUPPORTED_OPERATION="UNSUPPORTED_OPERATION",r.NETWORK_ERROR="NETWORK_ERROR",r.SERVER_ERROR="SERVER_ERROR",r.TIMEOUT="TIMEOUT",r.BUFFER_OVERRUN="BUFFER_OVERRUN",r.NUMERIC_FAULT="NUMERIC_FAULT",r.MISSING_NEW="MISSING_NEW",r.INVALID_ARGUMENT="INVALID_ARGUMENT",r.MISSING_ARGUMENT="MISSING_ARGUMENT",r.UNEXPECTED_ARGUMENT="UNEXPECTED_ARGUMENT",r.CALL_EXCEPTION="CALL_EXCEPTION",r.INSUFFICIENT_FUNDS="INSUFFICIENT_FUNDS",r.NONCE_EXPIRED="NONCE_EXPIRED",r.REPLACEMENT_UNDERPRICED="REPLACEMENT_UNDERPRICED",r.UNPREDICTABLE_GAS_LIMIT="UNPREDICTABLE_GAS_LIMIT",r.TRANSACTION_REPLACED="TRANSACTION_REPLACED",r.ACTION_REJECTED="ACTION_REJECTED"})(se||(se={}));const di="0123456789abcdef";class z{constructor(t){Object.defineProperty(this,"version",{enumerable:!0,value:t,writable:!1})}_log(t,e){const s=t.toLowerCase();Qe[s]==null&&this.throwArgumentError("invalid log level name","logLevel",t),!(ci>Qe[s])&&console.log.apply(console,e)}debug(...t){this._log(z.levels.DEBUG,t)}info(...t){this._log(z.levels.INFO,t)}warn(...t){this._log(z.levels.WARNING,t)}makeError(t,e,s){if(ai)return this.makeError("censored error",e,{});e||(e=z.errors.UNKNOWN_ERROR),s||(s={});const i=[];Object.keys(s).forEach(u=>{const p=s[u];try{if(p instanceof Uint8Array){let w="";for(let f=0;f<p.length;f++)w+=di[p[f]>>4],w+=di[p[f]&15];i.push(u+"=Uint8Array(0x"+w+")")}else i.push(u+"="+JSON.stringify(p))}catch{i.push(u+"="+JSON.stringify(s[u].toString()))}}),i.push(`code=${e}`),i.push(`version=${this.version}`);const n=t;let a="";switch(e){case se.NUMERIC_FAULT:{a="NUMERIC_FAULT";const u=t;switch(u){case"overflow":case"underflow":case"division-by-zero":a+="-"+u;break;case"negative-power":case"negative-width":a+="-unsupported";break;case"unbound-bitwise-result":a+="-unbound-result";break}break}case se.CALL_EXCEPTION:case se.INSUFFICIENT_FUNDS:case se.MISSING_NEW:case se.NONCE_EXPIRED:case se.REPLACEMENT_UNDERPRICED:case se.TRANSACTION_REPLACED:case se.UNPREDICTABLE_GAS_LIMIT:a=e;break}a&&(t+=" [ See: https://links.ethers.org/v5-errors-"+a+" ]"),i.length&&(t+=" ("+i.join(", ")+")");const d=new Error(t);return d.reason=n,d.code=e,Object.keys(s).forEach(function(u){d[u]=s[u]}),d}throwError(t,e,s){throw this.makeError(t,e,s)}throwArgumentError(t,e,s){return this.throwError(t,z.errors.INVALID_ARGUMENT,{argument:e,value:s})}assert(t,e,s,i){t||this.throwError(e,s,i)}assertArgument(t,e,s,i){t||this.throwArgumentError(e,s,i)}checkNormalize(t){li&&this.throwError("platform missing String.prototype.normalize",z.errors.UNSUPPORTED_OPERATION,{operation:"String.prototype.normalize",form:li})}checkSafeUint53(t,e){typeof t=="number"&&(e==null&&(e="value not safe"),(t<0||t>=9007199254740991)&&this.throwError(e,z.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"out-of-safe-range",value:t}),t%1&&this.throwError(e,z.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"non-integer",value:t}))}checkArgumentCount(t,e,s){s?s=": "+s:s="",t<e&&this.throwError("missing argument"+s,z.errors.MISSING_ARGUMENT,{count:t,expectedCount:e}),t>e&&this.throwError("too many arguments"+s,z.errors.UNEXPECTED_ARGUMENT,{count:t,expectedCount:e})}checkNew(t,e){(t===Object||t==null)&&this.throwError("missing new",z.errors.MISSING_NEW,{name:e.name})}checkAbstract(t,e){t===e?this.throwError("cannot instantiate abstract class "+JSON.stringify(e.name)+" directly; use a sub-class",z.errors.UNSUPPORTED_OPERATION,{name:t.name,operation:"new"}):(t===Object||t==null)&&this.throwError("missing new",z.errors.MISSING_NEW,{name:e.name})}static globalLogger(){return Fr||(Fr=new z(Td)),Fr}static setCensorship(t,e){if(!t&&e&&this.globalLogger().throwError("cannot permanently disable censorship",z.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"}),oi){if(!t)return;this.globalLogger().throwError("error censorship permanent",z.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"})}ai=!!t,oi=!!e}static setLogLevel(t){const e=Qe[t.toLowerCase()];if(e==null){z.globalLogger().warn("invalid log level - "+t);return}ci=e}static from(t){return new z(t)}}z.errors=se;z.levels=Qr;const Pd="bytes/5.8.0",V=new z(Pd);function mn(r){return!!r.toHexString}function Ee(r){return r.slice||(r.slice=function(){const t=Array.prototype.slice.call(arguments);return Ee(new Uint8Array(Array.prototype.slice.apply(r,t)))}),r}function Ad(r){return Qt(r)&&!(r.length%2)||ke(r)}function hi(r){return typeof r=="number"&&r==r&&r%1===0}function ke(r){if(r==null)return!1;if(r.constructor===Uint8Array)return!0;if(typeof r=="string"||!hi(r.length)||r.length<0)return!1;for(let t=0;t<r.length;t++){const e=r[t];if(!hi(e)||e<0||e>=256)return!1}return!0}function ye(r,t){if(t||(t={}),typeof r=="number"){V.checkSafeUint53(r,"invalid arrayify value");const e=[];for(;r;)e.unshift(r&255),r=parseInt(String(r/256));return e.length===0&&e.push(0),Ee(new Uint8Array(e))}if(t.allowMissingPrefix&&typeof r=="string"&&r.substring(0,2)!=="0x"&&(r="0x"+r),mn(r)&&(r=r.toHexString()),Qt(r)){let e=r.substring(2);e.length%2&&(t.hexPad==="left"?e="0"+e:t.hexPad==="right"?e+="0":V.throwArgumentError("hex data is odd-length","value",r));const s=[];for(let i=0;i<e.length;i+=2)s.push(parseInt(e.substring(i,i+2),16));return Ee(new Uint8Array(s))}return ke(r)?Ee(new Uint8Array(r)):V.throwArgumentError("invalid arrayify value","value",r)}function Md(r){const t=r.map(i=>ye(i)),e=t.reduce((i,n)=>i+n.length,0),s=new Uint8Array(e);return t.reduce((i,n)=>(s.set(n,i),i+n.length),0),Ee(s)}function bh(r){let t=ye(r);if(t.length===0)return t;let e=0;for(;e<t.length&&t[e]===0;)e++;return e&&(t=t.slice(e)),t}function xd(r,t){r=ye(r),r.length>t&&V.throwArgumentError("value out of range","value",arguments[0]);const e=new Uint8Array(t);return e.set(r,t-r.length),Ee(e)}function Qt(r,t){return!(typeof r!="string"||!r.match(/^0x[0-9A-Fa-f]*$/)||t&&r.length!==2+2*t)}const Lr="0123456789abcdef";function Dt(r,t){if(t||(t={}),typeof r=="number"){V.checkSafeUint53(r,"invalid hexlify value");let e="";for(;r;)e=Lr[r&15]+e,r=Math.floor(r/16);return e.length?(e.length%2&&(e="0"+e),"0x"+e):"0x00"}if(typeof r=="bigint")return r=r.toString(16),r.length%2?"0x0"+r:"0x"+r;if(t.allowMissingPrefix&&typeof r=="string"&&r.substring(0,2)!=="0x"&&(r="0x"+r),mn(r))return r.toHexString();if(Qt(r))return r.length%2&&(t.hexPad==="left"?r="0x0"+r.substring(2):t.hexPad==="right"?r+="0":V.throwArgumentError("hex data is odd-length","value",r)),r.toLowerCase();if(ke(r)){let e="0x";for(let s=0;s<r.length;s++){let i=r[s];e+=Lr[(i&240)>>4]+Lr[i&15]}return e}return V.throwArgumentError("invalid hexlify value","value",r)}function Th(r){if(typeof r!="string")r=Dt(r);else if(!Qt(r)||r.length%2)return null;return(r.length-2)/2}function Eh(r,t,e){return typeof r!="string"?r=Dt(r):(!Qt(r)||r.length%2)&&V.throwArgumentError("invalid hexData","value",r),t=2+2*t,e!=null?"0x"+r.substring(t,2+2*e):"0x"+r.substring(t)}function Ph(r){let t="0x";return r.forEach(e=>{t+=Dt(e).substring(2)}),t}function Ah(r){const t=Id(Dt(r,{hexPad:"left"}));return t==="0x"?"0x0":t}function Id(r){typeof r!="string"&&(r=Dt(r)),Qt(r)||V.throwArgumentError("invalid hex string","value",r),r=r.substring(2);let t=0;for(;t<r.length&&r[t]==="0";)t++;return"0x"+r.substring(t)}function Re(r,t){for(typeof r!="string"?r=Dt(r):Qt(r)||V.throwArgumentError("invalid hex string","value",r),r.length>2*t+2&&V.throwArgumentError("value out of range","value",arguments[1]);r.length<2*t+2;)r="0x0"+r.substring(2);return r}function kd(r){const t={r:"0x",s:"0x",_vs:"0x",recoveryParam:0,v:0,yParityAndS:"0x",compact:"0x"};if(Ad(r)){let e=ye(r);e.length===64?(t.v=27+(e[32]>>7),e[32]&=127,t.r=Dt(e.slice(0,32)),t.s=Dt(e.slice(32,64))):e.length===65?(t.r=Dt(e.slice(0,32)),t.s=Dt(e.slice(32,64)),t.v=e[64]):V.throwArgumentError("invalid signature string","signature",r),t.v<27&&(t.v===0||t.v===1?t.v+=27:V.throwArgumentError("signature invalid v byte","signature",r)),t.recoveryParam=1-t.v%2,t.recoveryParam&&(e[32]|=128),t._vs=Dt(e.slice(32,64))}else{if(t.r=r.r,t.s=r.s,t.v=r.v,t.recoveryParam=r.recoveryParam,t._vs=r._vs,t._vs!=null){const i=xd(ye(t._vs),32);t._vs=Dt(i);const n=i[0]>=128?1:0;t.recoveryParam==null?t.recoveryParam=n:t.recoveryParam!==n&&V.throwArgumentError("signature recoveryParam mismatch _vs","signature",r),i[0]&=127;const a=Dt(i);t.s==null?t.s=a:t.s!==a&&V.throwArgumentError("signature v mismatch _vs","signature",r)}if(t.recoveryParam==null)t.v==null?V.throwArgumentError("signature missing v and recoveryParam","signature",r):t.v===0||t.v===1?t.recoveryParam=t.v:t.recoveryParam=1-t.v%2;else if(t.v==null)t.v=27+t.recoveryParam;else{const i=t.v===0||t.v===1?t.v:1-t.v%2;t.recoveryParam!==i&&V.throwArgumentError("signature recoveryParam mismatch v","signature",r)}t.r==null||!Qt(t.r)?V.throwArgumentError("signature missing or invalid r","signature",r):t.r=Re(t.r,32),t.s==null||!Qt(t.s)?V.throwArgumentError("signature missing or invalid s","signature",r):t.s=Re(t.s,32);const e=ye(t.s);e[0]>=128&&V.throwArgumentError("signature s out of range","signature",r),t.recoveryParam&&(e[0]|=128);const s=Dt(e);t._vs&&(Qt(t._vs)||V.throwArgumentError("signature invalid _vs","signature",r),t._vs=Re(t._vs,32)),t._vs==null?t._vs=s:t._vs!==s&&V.throwArgumentError("signature _vs mismatch v and s","signature",r)}return t.yParityAndS=t._vs,t.compact=t.r+t.yParityAndS.substring(2),t}function Mh(r){return r=kd(r),Dt(Md([r.r,r.s,r.recoveryParam?"0x1c":"0x1b"]))}const yn="bignumber/5.8.0";var rr=bd.BN;const de=new z(yn),Dr={},ui=9007199254740991;function Od(r){return r!=null&&(J.isBigNumber(r)||typeof r=="number"&&r%1===0||typeof r=="string"&&!!r.match(/^-?[0-9]+$/)||Qt(r)||typeof r=="bigint"||ke(r))}let fi=!1;class J{constructor(t,e){t!==Dr&&de.throwError("cannot call constructor directly; use BigNumber.from",z.errors.UNSUPPORTED_OPERATION,{operation:"new (BigNumber)"}),this._hex=e,this._isBigNumber=!0,Object.freeze(this)}fromTwos(t){return Gt(B(this).fromTwos(t))}toTwos(t){return Gt(B(this).toTwos(t))}abs(){return this._hex[0]==="-"?J.from(this._hex.substring(1)):this}add(t){return Gt(B(this).add(B(t)))}sub(t){return Gt(B(this).sub(B(t)))}div(t){return J.from(t).isZero()&&Xt("division-by-zero","div"),Gt(B(this).div(B(t)))}mul(t){return Gt(B(this).mul(B(t)))}mod(t){const e=B(t);return e.isNeg()&&Xt("division-by-zero","mod"),Gt(B(this).umod(e))}pow(t){const e=B(t);return e.isNeg()&&Xt("negative-power","pow"),Gt(B(this).pow(e))}and(t){const e=B(t);return(this.isNegative()||e.isNeg())&&Xt("unbound-bitwise-result","and"),Gt(B(this).and(e))}or(t){const e=B(t);return(this.isNegative()||e.isNeg())&&Xt("unbound-bitwise-result","or"),Gt(B(this).or(e))}xor(t){const e=B(t);return(this.isNegative()||e.isNeg())&&Xt("unbound-bitwise-result","xor"),Gt(B(this).xor(e))}mask(t){return(this.isNegative()||t<0)&&Xt("negative-width","mask"),Gt(B(this).maskn(t))}shl(t){return(this.isNegative()||t<0)&&Xt("negative-width","shl"),Gt(B(this).shln(t))}shr(t){return(this.isNegative()||t<0)&&Xt("negative-width","shr"),Gt(B(this).shrn(t))}eq(t){return B(this).eq(B(t))}lt(t){return B(this).lt(B(t))}lte(t){return B(this).lte(B(t))}gt(t){return B(this).gt(B(t))}gte(t){return B(this).gte(B(t))}isNegative(){return this._hex[0]==="-"}isZero(){return B(this).isZero()}toNumber(){try{return B(this).toNumber()}catch{Xt("overflow","toNumber",this.toString())}return null}toBigInt(){try{return BigInt(this.toString())}catch{}return de.throwError("this platform does not support BigInt",z.errors.UNSUPPORTED_OPERATION,{value:this.toString()})}toString(){return arguments.length>0&&(arguments[0]===10?fi||(fi=!0,de.warn("BigNumber.toString does not accept any parameters; base-10 is assumed")):arguments[0]===16?de.throwError("BigNumber.toString does not accept any parameters; use bigNumber.toHexString()",z.errors.UNEXPECTED_ARGUMENT,{}):de.throwError("BigNumber.toString does not accept parameters",z.errors.UNEXPECTED_ARGUMENT,{})),B(this).toString(10)}toHexString(){return this._hex}toJSON(t){return{type:"BigNumber",hex:this.toHexString()}}static from(t){if(t instanceof J)return t;if(typeof t=="string")return t.match(/^-?0x[0-9a-f]+$/i)?new J(Dr,De(t)):t.match(/^-?[0-9]+$/)?new J(Dr,De(new rr(t))):de.throwArgumentError("invalid BigNumber string","value",t);if(typeof t=="number")return t%1&&Xt("underflow","BigNumber.from",t),(t>=ui||t<=-ui)&&Xt("overflow","BigNumber.from",t),J.from(String(t));const e=t;if(typeof e=="bigint")return J.from(e.toString());if(ke(e))return J.from(Dt(e));if(e)if(e.toHexString){const s=e.toHexString();if(typeof s=="string")return J.from(s)}else{let s=e._hex;if(s==null&&e.type==="BigNumber"&&(s=e.hex),typeof s=="string"&&(Qt(s)||s[0]==="-"&&Qt(s.substring(1))))return J.from(s)}return de.throwArgumentError("invalid BigNumber value","value",t)}static isBigNumber(t){return!!(t&&t._isBigNumber)}}function De(r){if(typeof r!="string")return De(r.toString(16));if(r[0]==="-")return r=r.substring(1),r[0]==="-"&&de.throwArgumentError("invalid hex","value",r),r=De(r),r==="0x00"?r:"-"+r;if(r.substring(0,2)!=="0x"&&(r="0x"+r),r==="0x")return"0x00";for(r.length%2&&(r="0x0"+r.substring(2));r.length>4&&r.substring(0,4)==="0x00";)r="0x"+r.substring(4);return r}function Gt(r){return J.from(De(r))}function B(r){const t=J.from(r).toHexString();return t[0]==="-"?new rr("-"+t.substring(3),16):new rr(t.substring(2),16)}function Xt(r,t,e){const s={fault:r,operation:t};return e!=null&&(s.value=e),de.throwError(r,z.errors.NUMERIC_FAULT,s)}function xh(r){return new rr(r,36).toString(16)}const zt=new z(yn),_e={},wn=J.from(0),vn=J.from(-1);function Sn(r,t,e,s){const i={fault:t,operation:e};return s!==void 0&&(i.value=s),zt.throwError(r,z.errors.NUMERIC_FAULT,i)}let Ne="0";for(;Ne.length<256;)Ne+=Ne;function os(r){if(typeof r!="number")try{r=J.from(r).toNumber()}catch{}return typeof r=="number"&&r>=0&&r<=256&&!(r%1)?"1"+Ne.substring(0,r):zt.throwArgumentError("invalid decimal size","decimals",r)}function Ur(r,t){t==null&&(t=0);const e=os(t);r=J.from(r);const s=r.lt(wn);s&&(r=r.mul(vn));let i=r.mod(e).toString();for(;i.length<e.length-1;)i="0"+i;i=i.match(/^([0-9]*[1-9]|0)(0*)/)[1];const n=r.div(e).toString();return e.length===1?r=n:r=n+"."+i,s&&(r="-"+r),r}function ce(r,t){t==null&&(t=0);const e=os(t);(typeof r!="string"||!r.match(/^-?[0-9.]+$/))&&zt.throwArgumentError("invalid decimal value","value",r);const s=r.substring(0,1)==="-";s&&(r=r.substring(1)),r==="."&&zt.throwArgumentError("missing value","value",r);const i=r.split(".");i.length>2&&zt.throwArgumentError("too many decimal points","value",r);let n=i[0],a=i[1];for(n||(n="0"),a||(a="0");a[a.length-1]==="0";)a=a.substring(0,a.length-1);for(a.length>e.length-1&&Sn("fractional component exceeds decimals","underflow","parseFixed"),a===""&&(a="0");a.length<e.length-1;)a+="0";const d=J.from(n),u=J.from(a);let p=d.mul(e).add(u);return s&&(p=p.mul(vn)),p}class Pe{constructor(t,e,s,i){t!==_e&&zt.throwError("cannot use FixedFormat constructor; use FixedFormat.from",z.errors.UNSUPPORTED_OPERATION,{operation:"new FixedFormat"}),this.signed=e,this.width=s,this.decimals=i,this.name=(e?"":"u")+"fixed"+String(s)+"x"+String(i),this._multiplier=os(i),Object.freeze(this)}static from(t){if(t instanceof Pe)return t;typeof t=="number"&&(t=`fixed128x${t}`);let e=!0,s=128,i=18;if(typeof t=="string"){if(t!=="fixed")if(t==="ufixed")e=!1;else{const n=t.match(/^(u?)fixed([0-9]+)x([0-9]+)$/);n||zt.throwArgumentError("invalid fixed format","format",t),e=n[1]!=="u",s=parseInt(n[2]),i=parseInt(n[3])}}else if(t){const n=(a,d,u)=>t[a]==null?u:(typeof t[a]!==d&&zt.throwArgumentError("invalid fixed format ("+a+" not "+d+")","format."+a,t[a]),t[a]);e=n("signed","boolean",e),s=n("width","number",s),i=n("decimals","number",i)}return s%8&&zt.throwArgumentError("invalid fixed format width (not byte aligned)","format.width",s),i>80&&zt.throwArgumentError("invalid fixed format (decimals too large)","format.decimals",i),new Pe(_e,e,s,i)}}class Nt{constructor(t,e,s,i){t!==_e&&zt.throwError("cannot use FixedNumber constructor; use FixedNumber.from",z.errors.UNSUPPORTED_OPERATION,{operation:"new FixedFormat"}),this.format=i,this._hex=e,this._value=s,this._isFixedNumber=!0,Object.freeze(this)}_checkFormat(t){this.format.name!==t.format.name&&zt.throwArgumentError("incompatible format; use fixedNumber.toFormat","other",t)}addUnsafe(t){this._checkFormat(t);const e=ce(this._value,this.format.decimals),s=ce(t._value,t.format.decimals);return Nt.fromValue(e.add(s),this.format.decimals,this.format)}subUnsafe(t){this._checkFormat(t);const e=ce(this._value,this.format.decimals),s=ce(t._value,t.format.decimals);return Nt.fromValue(e.sub(s),this.format.decimals,this.format)}mulUnsafe(t){this._checkFormat(t);const e=ce(this._value,this.format.decimals),s=ce(t._value,t.format.decimals);return Nt.fromValue(e.mul(s).div(this.format._multiplier),this.format.decimals,this.format)}divUnsafe(t){this._checkFormat(t);const e=ce(this._value,this.format.decimals),s=ce(t._value,t.format.decimals);return Nt.fromValue(e.mul(this.format._multiplier).div(s),this.format.decimals,this.format)}floor(){const t=this.toString().split(".");t.length===1&&t.push("0");let e=Nt.from(t[0],this.format);const s=!t[1].match(/^(0*)$/);return this.isNegative()&&s&&(e=e.subUnsafe(gi.toFormat(e.format))),e}ceiling(){const t=this.toString().split(".");t.length===1&&t.push("0");let e=Nt.from(t[0],this.format);const s=!t[1].match(/^(0*)$/);return!this.isNegative()&&s&&(e=e.addUnsafe(gi.toFormat(e.format))),e}round(t){t==null&&(t=0);const e=this.toString().split(".");if(e.length===1&&e.push("0"),(t<0||t>80||t%1)&&zt.throwArgumentError("invalid decimal count","decimals",t),e[1].length<=t)return this;const s=Nt.from("1"+Ne.substring(0,t),this.format),i=$d.toFormat(this.format);return this.mulUnsafe(s).addUnsafe(i).floor().divUnsafe(s)}isZero(){return this._value==="0.0"||this._value==="0"}isNegative(){return this._value[0]==="-"}toString(){return this._value}toHexString(t){if(t==null)return this._hex;t%8&&zt.throwArgumentError("invalid byte width","width",t);const e=J.from(this._hex).fromTwos(this.format.width).toTwos(t).toHexString();return Re(e,t/8)}toUnsafeFloat(){return parseFloat(this.toString())}toFormat(t){return Nt.fromString(this._value,t)}static fromValue(t,e,s){return s==null&&e!=null&&!Od(e)&&(s=e,e=null),e==null&&(e=0),s==null&&(s="fixed"),Nt.fromString(Ur(t,e),Pe.from(s))}static fromString(t,e){e==null&&(e="fixed");const s=Pe.from(e),i=ce(t,s.decimals);!s.signed&&i.lt(wn)&&Sn("unsigned value cannot be negative","overflow","value",t);let n=null;s.signed?n=i.toTwos(s.width).toHexString():(n=i.toHexString(),n=Re(n,s.width/8));const a=Ur(i,s.decimals);return new Nt(_e,n,a,s)}static fromBytes(t,e){e==null&&(e="fixed");const s=Pe.from(e);if(ye(t).length>s.width/8)throw new Error("overflow");let i=J.from(t);s.signed&&(i=i.fromTwos(s.width));const n=i.toTwos((s.signed?0:1)+s.width).toHexString(),a=Ur(i,s.decimals);return new Nt(_e,n,a,s)}static from(t,e){if(typeof t=="string")return Nt.fromString(t,e);if(ke(t))return Nt.fromBytes(t,e);try{return Nt.fromValue(t,0,e)}catch(s){if(s.code!==z.errors.INVALID_ARGUMENT)throw s}return zt.throwArgumentError("invalid FixedNumber value","value",t)}static isFixedNumber(t){return!!(t&&t._isFixedNumber)}}const gi=Nt.from(1),$d=Nt.from("0.5"),Cd="units/5.8.0",Rd=new z(Cd);function Zt(r,t){return typeof r!="string"&&Rd.throwArgumentError("value must be a string","value",r),ce(r,t)}const _d={exchange:"0xdFE02Eb6733538f8Ea35D585af8DE5958AD99E40",negRiskAdapter:"0xd91E80cF2E7be2e162c6513ceD06f1dD0dA35296",negRiskExchange:"0xC5d563A36AE78145C45a50134d48A1215220f80a",collateral:"0x9c4e1703476e875070ee25b56a58b008cfb8fa78",conditionalTokens:"0x69308FB512518e39F9b16112fA8d994F4e2Bf8bB"},Nd={exchange:"0x4bFb41d5B3570DeFd03C39a9A4D8dE6Bd8B8982E",negRiskAdapter:"0xd91E80cF2E7be2e162c6513ceD06f1dD0dA35296",negRiskExchange:"0xC5d563A36AE78145C45a50134d48A1215220f80a",collateral:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174",conditionalTokens:"0x4D97DCd97eC945f40cF65F87097ACe5EA0476045"},Jt=6,as=r=>{switch(r){case 137:return Nd;case 80002:return _d;default:throw new Error("Invalid network")}},sr={"0.1":{price:1,size:2,amount:3},"0.01":{price:2,size:2,amount:4},"0.001":{price:3,size:2,amount:5},"0.0001":{price:4,size:2,amount:6}},bn=async(r,t,e,s)=>new na(t,e,r).buildSignedOrder(s),Fd=(r,t,e,s)=>{const i=Jr(e,s.price);if(r===Rt.BUY){const n=ie(t,s.size);let a=n*i;return ne(a)>s.amount&&(a=er(a,s.amount+4),ne(a)>s.amount&&(a=ie(a,s.amount))),{side:ve.BUY,rawMakerAmt:a,rawTakerAmt:n}}else{const n=ie(t,s.size);let a=n*i;return ne(a)>s.amount&&(a=er(a,s.amount+4),ne(a)>s.amount&&(a=ie(a,s.amount))),{side:ve.SELL,rawMakerAmt:n,rawTakerAmt:a}}},Ld=async(r,t,e,s,i)=>{const{side:n,rawMakerAmt:a,rawTakerAmt:d}=Fd(s.side,s.size,s.price,i),u=Zt(a.toString(),Jt).toString(),p=Zt(d.toString(),Jt).toString();let w;typeof s.taker<"u"&&s.taker?w=s.taker:w="0x0000000000000000000000000000000000000000";let f;typeof s.feeRateBps<"u"&&s.feeRateBps?f=s.feeRateBps.toString():f="0";let x;return typeof s.nonce<"u"&&s.nonce?x=s.nonce.toString():x="0",{maker:t,taker:w,tokenId:s.tokenID,makerAmount:u,takerAmount:p,side:n,feeRateBps:f,nonce:x,signer:r,expiration:(s.expiration||0).toString(),signatureType:e}},Dd=async(r,t,e,s,i,n)=>{const a=await r.getAddress(),d=s===void 0?a:s,u=as(t),p=await Ld(a,d,e,i,sr[n.tickSize]),w=n.negRisk?u.negRiskExchange:u.exchange;return bn(r,w,t,p)},Ud=(r,t,e,s)=>{const i=ie(e,s.price);if(r===Rt.BUY){const n=ie(t,s.size);let a=n/i;return ne(a)>s.amount&&(a=er(a,s.amount+4),ne(a)>s.amount&&(a=ie(a,s.amount))),{side:ve.BUY,rawMakerAmt:n,rawTakerAmt:a}}else{const n=ie(t,s.size);let a=n*i;return ne(a)>s.amount&&(a=er(a,s.amount+4),ne(a)>s.amount&&(a=ie(a,s.amount))),{side:ve.SELL,rawMakerAmt:n,rawTakerAmt:a}}},Bd=async(r,t,e,s,i)=>{const{side:n,rawMakerAmt:a,rawTakerAmt:d}=Ud(s.side,s.amount,s.price||1,i),u=Zt(a.toString(),Jt).toString(),p=Zt(d.toString(),Jt).toString();let w;typeof s.taker<"u"&&s.taker?w=s.taker:w="0x0000000000000000000000000000000000000000";let f;typeof s.feeRateBps<"u"&&s.feeRateBps?f=s.feeRateBps.toString():f="0";let x;return typeof s.nonce<"u"&&s.nonce?x=s.nonce.toString():x="0",{maker:t,taker:w,tokenId:s.tokenID,makerAmount:u,takerAmount:p,side:n,feeRateBps:f,nonce:x,signer:r,expiration:"0",signatureType:e}},zd=async(r,t,e,s,i,n)=>{const a=await r.getAddress(),d=s===void 0?a:s,u=as(t),p=await Bd(a,d,e,i,sr[n.tickSize]),w=n.negRisk?u.negRiskExchange:u.exchange;return bn(r,w,t,p)},qd=(r,t,e)=>{if(!r.length)throw new Error("no match");let s=0;for(let i=r.length-1;i>=0;i--){const n=r[i];if(s+=parseFloat(n.size)*parseFloat(n.price),s>=t)return parseFloat(n.price)}if(e===ee.FOK)throw new Error("no match");return parseFloat(r[0].price)},Gd=(r,t,e)=>{if(!r.length)throw new Error("no match");let s=0;for(let i=r.length-1;i>=0;i--){const n=r[i];if(s+=parseFloat(n.size),s>=t)return parseFloat(n.price)}if(e===ee.FOK)throw new Error("no match");return parseFloat(r[0].price)};class Tn{signer;chainId;signatureType;funderAddress;getSigner;constructor(t,e,s,i,n){this.signer=t,this.chainId=e,this.signatureType=s===void 0?Ze.EOA:s,this.funderAddress=i,this.getSigner=n}async buildOrder(t,e){const s=await this.resolveSigner();return Dd(s,this.chainId,this.signatureType,this.funderAddress,t,e)}async buildMarketOrder(t,e){const s=await this.resolveSigner();return zd(s,this.chainId,this.signatureType,this.funderAddress,t,e)}async resolveSigner(){if(this.getSigner){const t=await this.getSigner();if(!t)throw new Error("getSigner() function returned undefined or null");return t}return this.signer}}const Ht="MA==",be="LTE=",Br=r=>{const t=new URLSearchParams;return r?(Object.entries(r).forEach(([e,s])=>{s!=null&&(Array.isArray(s)?s.forEach(i=>t.append(e,String(i))):t.append(e,String(s)))}),t.toString()):""};class En{deps;constructor(t){this.deps=t}async createRfqRequest(t,e){this.ensureL2Auth();const{tokenID:s,price:i,side:n,size:a}=t,d=await this.deps.resolveTickSize(s,e?.tickSize),u=sr[d],p=Jr(i,u.price).toFixed(u.price),w=ie(a,u.size).toFixed(u.size),f=parseFloat(w),x=parseFloat(p);let T,S,P,M;n===Rt.BUY?(T=Zt(w,Jt).toString(),S=Zt((f*x).toFixed(u.amount),Jt).toString(),P=s,M="0"):(T=Zt((f*x).toFixed(u.amount),Jt).toString(),S=Zt(w,Jt).toString(),P="0",M=s);const k={assetIn:P,assetOut:M,amountIn:T,amountOut:S,userType:this.deps.userType},$=id,O={method:te,requestPath:$,body:JSON.stringify(k)},C=await L(this.deps.signer,this.deps.creds,O,this.deps.useServerTime?await this.deps.getServerTime():void 0);return this.deps.post(`${this.deps.host}${$}`,{headers:C,data:k})}async cancelRfqRequest(t){this.ensureL2Auth();const e=nd,s={method:re,requestPath:e,body:JSON.stringify(t)},i=await L(this.deps.signer,this.deps.creds,s,this.deps.useServerTime?await this.deps.getServerTime():void 0);return this.deps.del(`${this.deps.host}${e}`,{headers:i,data:t})}async getRfqRequests(t){this.ensureL2Auth();const e=od,s={method:W,requestPath:e},i=await L(this.deps.signer,this.deps.creds,s,this.deps.useServerTime?await this.deps.getServerTime():void 0),n=Br(t),a=n?`${this.deps.host}${e}?${n}`:`${this.deps.host}${e}`;return this.deps.get(a,{headers:i})}async createRfqQuote(t,e){this.ensureL2Auth();const{requestId:s,tokenID:i,price:n,side:a,size:d}=t,u=await this.deps.resolveTickSize(i,e?.tickSize),p=sr[u],w=Jr(n,p.price).toFixed(p.price),f=ie(d,p.size).toFixed(p.size),x=parseFloat(f),T=parseFloat(w);let S,P,M,k;a===Rt.SELL?(S=Zt((x*T).toFixed(p.amount),Jt).toString(),P=Zt(f,Jt).toString(),M="0",k=i):(S=Zt(f,Jt).toString(),P=Zt((x*T).toFixed(p.amount),Jt).toString(),M=i,k="0");const $={requestId:s,assetIn:M,assetOut:k,amountIn:S,amountOut:P},O=ad,C={...$,userType:this.deps.userType},D={method:te,requestPath:O,body:JSON.stringify(C)},U=await L(this.deps.signer,this.deps.creds,D,this.deps.useServerTime?await this.deps.getServerTime():void 0);return this.deps.post(`${this.deps.host}${O}`,{headers:U,data:C})}async getRfqRequesterQuotes(t){this.ensureL2Auth();const e=hd,s={method:W,requestPath:e},i=await L(this.deps.signer,this.deps.creds,s,this.deps.useServerTime?await this.deps.getServerTime():void 0),n=Br(t),a=n?`${this.deps.host}${e}?${n}`:`${this.deps.host}${e}`;return this.deps.get(a,{headers:i})}async getRfqQuoterQuotes(t){this.ensureL2Auth();const e=ud,s={method:W,requestPath:e},i=await L(this.deps.signer,this.deps.creds,s,this.deps.useServerTime?await this.deps.getServerTime():void 0),n=Br(t),a=n?`${this.deps.host}${e}?${n}`:`${this.deps.host}${e}`;return this.deps.get(a,{headers:i})}async getRfqBestQuote(t){this.ensureL2Auth();const e=fd,s={method:W,requestPath:e},i=await L(this.deps.signer,this.deps.creds,s,this.deps.useServerTime?await this.deps.getServerTime():void 0);return this.deps.get(`${this.deps.host}${e}`,{headers:i,params:t})}async cancelRfqQuote(t){this.ensureL2Auth();const e=cd,s={method:re,requestPath:e,body:JSON.stringify(t)},i=await L(this.deps.signer,this.deps.creds,s,this.deps.useServerTime?await this.deps.getServerTime():void 0);return this.deps.del(`${this.deps.host}${e}`,{headers:i,data:t})}async rfqConfig(){this.ensureL2Auth();const t=gd,e={method:W,requestPath:t},s=await L(this.deps.signer,this.deps.creds,e,this.deps.useServerTime?await this.deps.getServerTime():void 0);return this.deps.get(`${this.deps.host}${t}`,{headers:s})}async acceptRfqQuote(t){this.ensureL2Auth();const e=await this.getRfqRequesterQuotes({quoteIds:[t.quoteId]});if("error"in e){const T=typeof e.error=="string"?e.error:JSON.stringify(e.error);throw new Error(`Error fetching RFQ quote: ${T}`)}if(!e?.data||e.data.length===0)throw new Error("RFQ quote not found");const s=e.data[0],i=this.getRequestOrderCreationPayload(s),n=i.side,a=i.size,d=i.token,u=await this.deps.createOrder({tokenID:d,price:i.price,size:parseFloat(a),side:n,expiration:t.expiration});if(!u)throw new Error("Error creating order");const p={requestId:t.requestId,quoteId:t.quoteId,owner:this.deps.creds.key,...u,expiration:parseInt(u.expiration),side:n,salt:parseInt(u.salt.toString())},w=ld,f={method:te,requestPath:w,body:JSON.stringify(p)},x=await L(this.deps.signer,this.deps.creds,f,this.deps.useServerTime?await this.deps.getServerTime():void 0);return this.deps.post(`${this.deps.host}${w}`,{headers:x,data:p})}async approveRfqOrder(t){this.ensureL2Auth();const e=await this.getRfqQuoterQuotes({quoteIds:[t.quoteId]});if("error"in e){const f=typeof e.error=="string"?e.error:JSON.stringify(e.error);throw new Error(`Error fetching RFQ quote: ${f}`)}if(!e?.data||e.data.length===0)throw new Error("RFQ quote not found");const s=e.data[0],i=s.side==="BUY"?Rt.BUY:Rt.SELL,n=s.side==="BUY"?s.sizeIn:s.sizeOut,a=await this.deps.createOrder({tokenID:s.token,price:s.price,size:parseFloat(n),side:i,expiration:t.expiration});if(!a)throw new Error("Error creating order");const d={requestId:t.requestId,quoteId:t.quoteId,owner:this.deps.creds.key,...a,expiration:parseInt(a.expiration),side:i,salt:parseInt(a.salt.toString())},u=dd,p={method:te,requestPath:u,body:JSON.stringify(d)},w=await L(this.deps.signer,this.deps.creds,p,this.deps.useServerTime?await this.deps.getServerTime():void 0);return this.deps.post(`${this.deps.host}${u}`,{headers:w,data:d})}ensureL2Auth(){if(this.deps.signer===void 0)throw Vr;if(this.deps.creds===void 0)throw pn}getRequestOrderCreationPayload(t){const e=t.side,s=t.matchType;let i,n,a,d;switch(s){case Te.COMPLEMENTARY:return i=e==="BUY"?Rt.SELL:Rt.BUY,n=t.token,a=i==Rt.BUY?t.sizeOut:t.sizeIn,d=t.price,{token:n,side:i,size:a,price:d};case Te.MINT:case Te.MERGE:return i=e==="BUY"?Rt.BUY:Rt.SELL,n=t.complement,a=i==Rt.BUY?t.sizeIn:t.sizeOut,d=1-t.price,{token:n,side:i,size:a,price:d};default:throw new Error("invalid match type")}}}class Pn{host;chainId;signer;creds;orderBuilder;tickSizes;negRisk;feeRates;geoBlockToken;useServerTime;builderConfig;rfq;retryOnError;constructor(t,e,s,i,n,a,d,u,p,w,f){this.host=t.endsWith("/")?t.slice(0,-1):t,this.chainId=e,s!==void 0&&(this.signer=s),i!==void 0&&(this.creds=i),this.orderBuilder=new Tn(s,e,n,a,w),this.tickSizes={},this.negRisk={},this.feeRates={},this.geoBlockToken=d,this.useServerTime=u,this.retryOnError=f,p!==void 0&&(this.builderConfig=p);const x={host:this.host,signer:this.signer,creds:this.creds,useServerTime:this.useServerTime,geoBlockToken:this.geoBlockToken,userType:this.orderBuilder.signatureType,getServerTime:this.getServerTime.bind(this),getTickSize:this.getTickSize.bind(this),resolveTickSize:this._resolveTickSize.bind(this),createOrder:this.createOrder.bind(this),get:this.get.bind(this),post:this.post.bind(this),put:this.put.bind(this),del:this.del.bind(this)};this.rfq=new En(x)}async getOk(){return this.get(`${this.host}/`)}async getServerTime(){return this.get(`${this.host}${sl}`)}async getSamplingSimplifiedMarkets(t=Ht){return this.get(`${this.host}${ml}`,{params:{next_cursor:t}})}async getSamplingMarkets(t=Ht){return this.get(`${this.host}${yl}`,{params:{next_cursor:t}})}async getSimplifiedMarkets(t=Ht){return this.get(`${this.host}${wl}`,{params:{next_cursor:t}})}async getMarkets(t=Ht){return this.get(`${this.host}${vl}`,{params:{next_cursor:t}})}async getMarket(t){return this.get(`${this.host}${Sl}${t}`)}async getOrderBook(t){return this.get(`${this.host}${bl}`,{params:{token_id:t}})}async getOrderBooks(t){return this.post(`${this.host}${Tl}`,{data:t})}async getTickSize(t){if(t in this.tickSizes)return this.tickSizes[t];const e=await this.get(`${this.host}${$l}`,{params:{token_id:t}});return this.tickSizes[t]=e.minimum_tick_size.toString(),this.tickSizes[t]}async getNegRisk(t){if(t in this.negRisk)return this.negRisk[t];const e=await this.get(`${this.host}${Cl}`,{params:{token_id:t}});return this.negRisk[t]=e.neg_risk,this.negRisk[t]}async getFeeRateBps(t){if(t in this.feeRates)return this.feeRates[t];const e=await this.get(`${this.host}${Rl}`,{params:{token_id:t}});return this.feeRates[t]=e.base_fee,this.feeRates[t]}getOrderBookHash(t){return el(t)}async getMidpoint(t){return this.get(`${this.host}${El}`,{params:{token_id:t}})}async getMidpoints(t){return this.post(`${this.host}${Pl}`,{data:t})}async getPrice(t,e){return this.get(`${this.host}${Al}`,{params:{token_id:t,side:e}})}async getPrices(t){return this.post(`${this.host}${Ml}`,{data:t})}async getSpread(t){return this.get(`${this.host}${xl}`,{params:{token_id:t}})}async getSpreads(t){return this.post(`${this.host}${Il}`,{data:t})}async getLastTradePrice(t){return this.get(`${this.host}${kl}`,{params:{token_id:t}})}async getLastTradesPrices(t){return this.post(`${this.host}${Ol}`,{data:t})}async getPricesHistory(t){return this.get(`${this.host}${Hl}`,{params:t})}async createApiKey(t){this.canL1Auth();const e=`${this.host}${il}`,s=await Hr(this.signer,this.chainId,t,this.useServerTime?await this.getServerTime():void 0);return await this.post(e,{headers:s}).then(i=>({key:i.apiKey,secret:i.secret,passphrase:i.passphrase}))}async deriveApiKey(t){this.canL1Auth();const e=`${this.host}${al}`,s=await Hr(this.signer,this.chainId,t,this.useServerTime?await this.getServerTime():void 0);return await this.get(e,{headers:s}).then(i=>({key:i.apiKey,secret:i.secret,passphrase:i.passphrase}))}async createOrDeriveApiKey(t){return this.createApiKey(t).then(e=>e.key?e:this.deriveApiKey(t))}async getApiKeys(){this.canL2Auth();const t=nl,e={method:W,requestPath:t},s=await L(this.signer,this.creds,e,this.useServerTime?await this.getServerTime():void 0);return this.get(`${this.host}${t}`,{headers:s})}async getClosedOnlyMode(){this.canL2Auth();const t=cl,e={method:W,requestPath:t},s=await L(this.signer,this.creds,e,this.useServerTime?await this.getServerTime():void 0);return this.get(`${this.host}${t}`,{headers:s})}async deleteApiKey(){this.canL2Auth();const t=ol,e={method:re,requestPath:t},s=await L(this.signer,this.creds,e,this.useServerTime?await this.getServerTime():void 0);return this.del(`${this.host}${t}`,{headers:s})}async createReadonlyApiKey(){this.canL2Auth();const t=ll,e={method:te,requestPath:t},s=await L(this.signer,this.creds,e,this.useServerTime?await this.getServerTime():void 0);return this.post(`${this.host}${t}`,{headers:s})}async getReadonlyApiKeys(){this.canL2Auth();const t=dl,e={method:W,requestPath:t},s=await L(this.signer,this.creds,e,this.useServerTime?await this.getServerTime():void 0);return this.get(`${this.host}${t}`,{headers:s})}async deleteReadonlyApiKey(t){this.canL2Auth();const e=hl,s={key:t},i={method:re,requestPath:e,body:JSON.stringify(s)},n=await L(this.signer,this.creds,i,this.useServerTime?await this.getServerTime():void 0);return this.del(`${this.host}${e}`,{headers:n,data:s})}async validateReadonlyApiKey(t,e){return this.get(`${this.host}${ul}`,{params:{address:t,key:e}})}async getOrder(t){this.canL2Auth();const e=`${Dl}${t}`,s={method:W,requestPath:e},i=await L(this.signer,this.creds,s,this.useServerTime?await this.getServerTime():void 0);return this.get(`${this.host}${e}`,{headers:i})}async getTrades(t,e=!1,s){this.canL2Auth();const i=ii,n={method:W,requestPath:i},a=await L(this.signer,this.creds,n,this.useServerTime?await this.getServerTime():void 0);let d=[];for(s=s||Ht;s!=be&&(s===Ht||!e);){const u={...t,next_cursor:s},p=await this.get(`${this.host}${i}`,{headers:a,params:u});s=p.next_cursor,d=[...d,...p.data]}return d}async getTradesPaginated(t,e){this.canL2Auth();const s=ii,i={method:W,requestPath:s},n=await L(this.signer,this.creds,i,this.useServerTime?await this.getServerTime():void 0);e=e||Ht;const a={...t,next_cursor:e},{data:d,...u}=await this.get(`${this.host}${s}`,{headers:n,params:a});return{trades:Array.isArray(d)?[...d]:[],...u}}async getBuilderTrades(t,e){this.mustBuilderAuth();const s=rd,i={method:W,requestPath:s},n=await this._getBuilderHeaders(i.method,i.requestPath);if(n==null)throw ei;e=e||Ht;const a={...t,next_cursor:e},{data:d,...u}=await this.get(`${this.host}${s}`,{headers:n,params:a});return{trades:Array.isArray(d)?[...d]:[],...u}}async getNotifications(){this.canL2Auth();const t=jl,e={method:W,requestPath:t},s=await L(this.signer,this.creds,e,this.useServerTime?await this.getServerTime():void 0);return this.get(`${this.host}${t}`,{headers:s,params:{signature_type:this.orderBuilder.signatureType}})}async dropNotifications(t){this.canL2Auth();const e=Wl,s={method:re,requestPath:e},i=await L(this.signer,this.creds,s,this.useServerTime?await this.getServerTime():void 0);return this.del(`${this.host}${e}`,{headers:i,params:Xc(t)})}async getBalanceAllowance(t){this.canL2Auth();const e=Kl,s={method:W,requestPath:e},i=await L(this.signer,this.creds,s,this.useServerTime?await this.getServerTime():void 0),n={...t,signature_type:this.orderBuilder.signatureType};return this.get(`${this.host}${e}`,{headers:i,params:n})}async updateBalanceAllowance(t){this.canL2Auth();const e=Yl,s={method:W,requestPath:e},i=await L(this.signer,this.creds,s,this.useServerTime?await this.getServerTime():void 0),n={...t,signature_type:this.orderBuilder.signatureType};return this.get(`${this.host}${e}`,{headers:i,params:n})}async createOrder(t,e){this.canL1Auth();const{tokenID:s}=t,i=await this._resolveTickSize(s,e?.tickSize),n=await this._resolveFeeRateBps(s,t.feeRateBps);if(t.feeRateBps=n,!si(t.price,i))throw new Error(`invalid price (${t.price}), min: ${parseFloat(i)} - max: ${1-parseFloat(i)}`);const a=e?.negRisk??await this.getNegRisk(s);return this.orderBuilder.buildOrder(t,{tickSize:i,negRisk:a})}async createMarketOrder(t,e){this.canL1Auth();const{tokenID:s}=t,i=await this._resolveTickSize(s,e?.tickSize),n=await this._resolveFeeRateBps(s,t.feeRateBps);if(t.feeRateBps=n,t.price||(t.price=await this.calculateMarketPrice(s,t.side,t.amount,t.orderType)),!si(t.price,i))throw new Error(`invalid price (${t.price}), min: ${parseFloat(i)} - max: ${1-parseFloat(i)}`);const a=e?.negRisk??await this.getNegRisk(s);return this.orderBuilder.buildMarketOrder(t,{tickSize:i,negRisk:a})}async createAndPostOrder(t,e,s=ee.GTC,i=!1,n=!1){const a=await this.createOrder(t,e);return this.postOrder(a,s,i,n)}async createAndPostMarketOrder(t,e,s=ee.FOK,i=!1){const n=await this.createMarketOrder(t,e);return this.postOrder(n,s,i)}async getOpenOrders(t,e=!1,s){this.canL2Auth();const i=zl,n={method:W,requestPath:i},a=await L(this.signer,this.creds,n,this.useServerTime?await this.getServerTime():void 0);let d=[];for(s=s||Ht;s!=be&&(s===Ht||!e);){const u={...t,next_cursor:s},p=await this.get(`${this.host}${i}`,{headers:a,params:u});s=p.next_cursor,d=[...d,...p.data]}return d}async postOrder(t,e=ee.GTC,s=!1,i=!1){this.canL2Auth();const n=_l,a=ri(t,this.creds?.key||"",e,s,i),d={method:te,requestPath:n,body:JSON.stringify(a)},u=await L(this.signer,this.creds,d,this.useServerTime?await this.getServerTime():void 0);if(this.canBuilderAuth()){const p=await this._generateBuilderHeaders(u,d);if(p!==void 0)return this.post(`${this.host}${n}`,{headers:p,data:a})}return this.post(`${this.host}${n}`,{headers:u,data:a})}async postOrders(t,e=!1,s=!1){this.canL2Auth();const i=Nl,n=[];for(const{order:u,orderType:p,postOnly:w}of t){const f=ri(u,this.creds?.key||"",p,e,w??s);n.push(f)}const a={method:te,requestPath:i,body:JSON.stringify(n)},d=await L(this.signer,this.creds,a,this.useServerTime?await this.getServerTime():void 0);if(this.canBuilderAuth()){const u=await this._generateBuilderHeaders(d,a);if(u!==void 0)return this.post(`${this.host}${i}`,{headers:u,data:n})}return this.post(`${this.host}${i}`,{headers:d,data:n})}async cancelOrder(t){this.canL2Auth();const e=Fl,s={method:re,requestPath:e,body:JSON.stringify(t)},i=await L(this.signer,this.creds,s,this.useServerTime?await this.getServerTime():void 0);return this.del(`${this.host}${e}`,{headers:i,data:t})}async cancelOrders(t){this.canL2Auth();const e=Ll,s={method:re,requestPath:e,body:JSON.stringify(t)},i=await L(this.signer,this.creds,s,this.useServerTime?await this.getServerTime():void 0);return this.del(`${this.host}${e}`,{headers:i,data:t})}async cancelAll(){this.canL2Auth();const t=Ul,e={method:re,requestPath:t},s=await L(this.signer,this.creds,e,this.useServerTime?await this.getServerTime():void 0);return this.del(`${this.host}${t}`,{headers:s})}async postHeartbeat(t){this.canL2Auth();const e=sd,i=JSON.stringify({heartbeat_id:t??null}),n={method:te,requestPath:e,body:i},a=await L(this.signer,this.creds,n,this.useServerTime?await this.getServerTime():void 0);return this.post(`${this.host}${e}`,{headers:a,data:i})}async cancelMarketOrders(t){this.canL2Auth();const e=Bl,s={method:re,requestPath:e,body:JSON.stringify(t)},i=await L(this.signer,this.creds,s,this.useServerTime?await this.getServerTime():void 0);return this.del(`${this.host}${e}`,{headers:i,data:t})}async isOrderScoring(t){this.canL2Auth();const e=ql,s={method:W,requestPath:e},i=await L(this.signer,this.creds,s,this.useServerTime?await this.getServerTime():void 0);return this.get(`${this.host}${e}`,{headers:i,params:t})}async areOrdersScoring(t){this.canL2Auth();const e=Gl,s=JSON.stringify(t?.orderIds),i={method:te,requestPath:e,body:s},n=await L(this.signer,this.creds,i,this.useServerTime?await this.getServerTime():void 0);return this.post(`${this.host}${e}`,{headers:n,data:s})}async getEarningsForUserForDay(t){this.canL2Auth();const e=Jl,s={method:W,requestPath:e},i=await L(this.signer,this.creds,s,this.useServerTime?await this.getServerTime():void 0);let n=[],a=Ht;for(;a!=be;){const d={date:t,signature_type:this.orderBuilder.signatureType,next_cursor:a},u=await this.get(`${this.host}${e}`,{headers:i,params:d});a=u.next_cursor,n=[...n,...u.data]}return n}async getTotalEarningsForUserForDay(t){this.canL2Auth();const e=Ql,s={method:W,requestPath:e},i=await L(this.signer,this.creds,s,this.useServerTime?await this.getServerTime():void 0),n={date:t,signature_type:this.orderBuilder.signatureType};return await this.get(`${this.host}${e}`,{headers:i,params:n})}async getUserEarningsAndMarketsConfig(t,e="",s="",i=!1){this.canL2Auth();const n=ed,a={method:W,requestPath:n},d=await L(this.signer,this.creds,a,this.useServerTime?await this.getServerTime():void 0);let u=[],p=Ht;for(;p!=be;){const w={date:t,signature_type:this.orderBuilder.signatureType,next_cursor:p,order_by:e,position:s,no_competition:i},f=await this.get(`${this.host}${n}`,{headers:d,params:w});p=f.next_cursor,u=[...u,...f.data]}return u}async getRewardPercentages(){this.canL2Auth();const t=Xl,e={method:W,requestPath:t},s=await L(this.signer,this.creds,e,this.useServerTime?await this.getServerTime():void 0),i={signature_type:this.orderBuilder.signatureType};return this.get(`${this.host}${t}`,{headers:s,params:i})}async getCurrentRewards(){let t=[],e=Ht;for(;e!=be;){const s=await this.get(`${this.host}${Zl}`,{params:{next_cursor:e}});e=s.next_cursor,t=[...t,...s.data]}return t}async getRawRewardsForMarket(t){let e=[],s=Ht;for(;s!=be;){const i=await this.get(`${this.host}${td}${t}`,{params:{next_cursor:s}});s=i.next_cursor,e=[...e,...i.data]}return e}async getMarketTradesEvents(t){return this.get(`${this.host}${Vl}${t}`)}async calculateMarketPrice(t,e,s,i=ee.FOK){const n=await this.getOrderBook(t);if(!n)throw new Error("no orderbook");if(e===Rt.BUY){if(!n.asks)throw new Error("no match");return qd(n.asks,s,i)}else{if(!n.bids)throw new Error("no match");return Gd(n.bids,s,i)}}async createBuilderApiKey(){this.canL2Auth();const t=fl,e={method:te,requestPath:t},s=await L(this.signer,this.creds,e,this.useServerTime?await this.getServerTime():void 0);return this.post(`${this.host}${t}`,{headers:s})}async getBuilderApiKeys(){this.canL2Auth();const t=gl,e={method:W,requestPath:t},s=await L(this.signer,this.creds,e,this.useServerTime?await this.getServerTime():void 0);return this.get(`${this.host}${t}`,{headers:s})}async revokeBuilderApiKey(){this.mustBuilderAuth();const t=pl,e={method:re,requestPath:t},s=await this._getBuilderHeaders(e.method,e.requestPath);if(s==null)throw ei;return this.del(`${this.host}${t}`,{headers:s})}async _resolveTickSize(t,e){const s=await this.getTickSize(t);if(e){if(rl(e,s))throw new Error(`invalid tick size (${e}), minimum for the market is ${s}`)}else e=s;return e}async get(t,e){return Vc(t,{...e,params:{...e?.params,geo_block_token:this.geoBlockToken}})}async post(t,e){return Yc(t,{...e,params:{...e?.params,geo_block_token:this.geoBlockToken}},this.retryOnError)}async put(t,e){return Qc(t,{...e,params:{...e?.params,geo_block_token:this.geoBlockToken}})}async del(t,e){return Jc(t,{...e,params:{...e?.params,geo_block_token:this.geoBlockToken}})}canL1Auth(){if(this.signer===void 0)throw Vr}canL2Auth(){if(this.signer===void 0)throw Vr;if(this.creds===void 0)throw pn}mustBuilderAuth(){if(!this.canBuilderAuth())throw Zc}canBuilderAuth(){return this.builderConfig!=null&&this.builderConfig.isValid()}async _resolveFeeRateBps(t,e){const s=await this.getFeeRateBps(t);if(s>0&&e!=null&&e!=s)throw new Error(`invalid user provided fee rate: ${e}, fee rate for the market must be ${s}`);return s}async _generateBuilderHeaders(t,e){if(this.builderConfig!==void 0){const s=await this._getBuilderHeaders(e.method,e.requestPath,e.body);return s==null?void 0:Gi(t,s)}}async _getBuilderHeaders(t,e,s){return this.builderConfig.generateBuilderHeaders(t,e,s)}}const We=Object.freeze(Object.defineProperty({__proto__:null,get AssetType(){return Gr},COLLATERAL_TOKEN_DECIMALS:Jt,get Chain(){return zr},ClobClient:Pn,OrderBuilder:Tn,get OrderType(){return ee},get PriceHistoryInterval(){return qr},RfqClient:En,get RfqMatchType(){return Te},get Side(){return Rt},createL1Headers:Hr,createL2Headers:L,getContractConfig:as,injectBuilderHeaders:Gi},Symbol.toStringTag,{value:"Module"}));class Hd{client;isInitialized=!1;constructor(){this.client=new Pn("https://clob.polymarket.com",137),this.isInitialized=!0}async getPrice(t,e){try{const s=await this.client.getPrice(t,e);return s.price?parseFloat(s.price):null}catch(s){return console.error(`Error getting price for token ${t}:`,s),null}}async getOrderBook(t){try{return await this.client.getOrderBook(t)}catch(e){throw console.error(`Error getting order book for token ${t}:`,e),e}}async calculateMarketPrice(t,e,s){try{return await this.client.calculateMarketPrice(t,e,s,ee.FOK)}catch(i){return console.error(`Error calculating market price for token ${t}:`,i),null}}async getMarket(t){try{return await this.client.getMarket(t)}catch(e){throw console.error(`Error getting market for condition ${t}:`,e),e}}async getFeeRate(t){try{return await this.client.getFeeRateBps(t)}catch(e){return console.error(`Error getting fee rate for token ${t}:`,e),0}}async getTickSize(t){try{return await this.client.getTickSize(t)}catch(e){return console.error(`Error getting tick size for token ${t}:`,e),"0.01"}}isReady(){return this.isInitialized}}function Bt(r){return r*100}class jd{clobClient;browserClobClient=null;strategyConfig;trades=[];status;onStatusUpdate=null;onTradeUpdate=null;onStrategySave=null;onTradePersist=null;onPositionsPersist=null;isMonitoring=!1;activeEvent=null;pendingLimitOrders=new Map;currentPrice=null;priceToBeat=null;apiCredentials=null;isPlacingOrder=!1;isPlacingSplitOrders=!1;isPlacingExitOrder=!1;positions=[];priceBelowEntry=!1;consecutiveFailures=0;MAX_CONSECUTIVE_FAILURES=5;orderPlacementStartTime=0;MAX_ORDER_PLACEMENT_TIME=3e4;pendingEntryOrders=new Map;pendingProfitSellOrders=new Map;constructor(){this.clobClient=new Hd,this.strategyConfig=this.getDefaultStrategy(),this.status={isActive:!1,totalTrades:0,successfulTrades:0,failedTrades:0,totalProfit:0,pendingLimitOrders:0,positions:[]}}getDefaultStrategy(){return{enabled:!1,entryPrice:96,profitTargetPrice:99,stopLossPrice:91,tradeSize:50,flipGuardPendingDistanceUsd:15,flipGuardFilledDistanceUsd:5,entryTimeRemainingMaxSeconds:180}}setStrategyConfig(t){this.strategyConfig={...this.strategyConfig,...t},this.saveStrategyConfig()}updateStrategyConfig(t){this.setStrategyConfig(t)}getStrategyConfig(){return{...this.strategyConfig}}saveStrategyConfig(){try{localStorage.setItem("tradingStrategy",JSON.stringify(this.strategyConfig)),this.onStrategySave?.(this.strategyConfig)}catch(t){console.warn("Failed to save strategy config:",t)}}loadStrategyFromObject(t){t&&typeof t=="object"&&(this.strategyConfig={...this.strategyConfig,...t})}loadStrategyConfig(){try{const t=localStorage.getItem("tradingStrategy");t&&(this.strategyConfig={...this.strategyConfig,...JSON.parse(t)})}catch(t){console.warn("Failed to load strategy config:",t)}}setOnStrategySave(t){this.onStrategySave=t}setOnTradePersist(t){this.onTradePersist=t}setOnPositionsPersist(t){this.onPositionsPersist=t}setTrades(t){this.trades=Array.isArray(t)?[...t]:[],this.recomputeStatusFromTradesAndPositions(),this.notifyStatusUpdate()}setPositions(t){this.positions=Array.isArray(t)?[...t]:[],this.status.positions=[...this.positions],this.status.totalPositionSize=this.positions.reduce((e,s)=>e+s.size,0),this.notifyStatusUpdate()}recomputeStatusFromTradesAndPositions(){this.status.totalTrades=this.trades.length,this.status.successfulTrades=this.trades.filter(t=>t.status==="filled").length,this.status.failedTrades=this.trades.filter(t=>t.status==="failed").length,this.status.totalProfit=this.trades.reduce((t,e)=>t+(e.profit??0),0)}persistPositions(){this.onPositionsPersist?.(this.positions)}setOnStatusUpdate(t){this.onStatusUpdate=t}setOnTradeUpdate(t){this.onTradeUpdate=t}setWalletBalance(t){t&&(this.status.maxPositionSize=t*.5,this.status.walletBalance=t),this.notifyStatusUpdate()}verifyBalance(t){if(!this.status.walletBalance)return console.warn("[TradingManager] Balance verification skipped - wallet balance not set"),!0;const e=this.status.walletBalance;return e<t?(console.error(`[TradingManager] 🚫 Insufficient balance: Required ${t.toFixed(2)} USDC, Available ${e.toFixed(2)} USDC`),!1):(console.log(`[TradingManager] ✅ Balance verified: Required ${t.toFixed(2)} USDC, Available ${e.toFixed(2)} USDC`),!0)}getActivePositions(){return this.activeEvent?this.positions.filter(t=>t.eventSlug===this.activeEvent.slug):[]}updateMarketData(t,e,s){this.currentPrice=t,this.priceToBeat=e,this.activeEvent=s,this.strategyConfig.enabled&&this.status.isActive&&s&&this.checkTradingConditions()}getTimeRemainingSeconds(){if(!this.activeEvent?.endDate)return null;const t=new Date(this.activeEvent.endDate).getTime();return Math.max(0,(t-Date.now())/1e3)}getPriceDistanceUSD(){return this.currentPrice===null||this.priceToBeat===null?null:Math.abs(this.priceToBeat-this.currentPrice)}async cancelOrderById(t){if(!this.browserClobClient)return!1;try{return await this.browserClobClient.cancelOrder({orderID:t}),!0}catch(e){return console.warn("[TradingManager] cancelOrderById failed:",t,e),!1}}async cancelAllPendingEntryOrders(){for(const[,t]of this.pendingEntryOrders.entries())await this.cancelOrderById(t.orderId)&&console.log(`[TradingManager] Cancelled pending entry order ${t.orderId.substring(0,8)}... (${t.direction})`);this.pendingEntryOrders.clear()}async checkPendingEntryOrderFills(){if(!(!this.browserClobClient||this.pendingEntryOrders.size===0))try{const t=await this.browserClobClient.getOpenOrders(),e=new Set((t||[]).map(s=>s.id||s.orderID));for(const[s,i]of this.pendingEntryOrders.entries()){if(e.has(i.orderId))continue;this.pendingEntryOrders.delete(s);const n={id:`position-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,eventSlug:this.activeEvent.slug,tokenId:s,side:"BUY",size:i.size,entryPrice:i.limitPrice,direction:i.direction,filledOrders:[{orderId:i.orderId,price:i.limitPrice,size:i.size,timestamp:i.placedAt}],entryTimestamp:i.placedAt};this.positions.push(n),this.status.positions=[...this.positions],this.status.totalPositionSize=this.positions.reduce((d,u)=>d+u.size,0),this.status.successfulTrades++;const a={id:`limit-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,eventSlug:this.activeEvent.slug,tokenId:s,side:"BUY",size:i.size,price:i.limitPrice,timestamp:Date.now(),status:"filled",transactionHash:i.orderId,reason:`POST_ONLY limit entry at ${i.limitPrice.toFixed(2)} (${i.direction})`,orderType:"LIMIT",limitPrice:i.limitPrice,direction:i.direction};this.trades.push(a),this.notifyTradeUpdate(a),this.notifyStatusUpdate(),console.log("[TradingManager] ✅ Pending entry order filled:",i.orderId.substring(0,8),i.direction,i.size.toFixed(2))}}catch(t){console.warn("[TradingManager] checkPendingEntryOrderFills error:",t)}}setApiCredentials(t){this.apiCredentials=t}setBrowserClobClient(t){this.browserClobClient=t,console.log(t?"[TradingManager] Browser ClobClient set - orders will be placed from browser (bypasses Cloudflare)":"[TradingManager] Browser ClobClient cleared - server-side API is blocked by Cloudflare, orders will fail")}getBrowserClobClient(){return this.browserClobClient}getApiCredentials(){return this.apiCredentials}async checkTradingConditions(){if(!this.strategyConfig.enabled||!this.status.isActive){console.log("[TradingManager] checkTradingConditions skipped: enabled=",this.strategyConfig.enabled,"active=",this.status.isActive);return}if(!this.activeEvent){console.log("[TradingManager] checkTradingConditions skipped: no active event");return}if(!this.activeEvent.clobTokenIds||this.activeEvent.clobTokenIds.length<2){console.log("[TradingManager] checkTradingConditions skipped: missing token IDs");return}const t=this.activeEvent.clobTokenIds[0],e=this.activeEvent.clobTokenIds[1];if(!t||!e)return;const s=this.getActivePositions(),i=this.getPriceDistanceUSD(),n=this.strategyConfig.flipGuardPendingDistanceUsd??15,a=this.strategyConfig.flipGuardFilledDistanceUsd??5;if(this.pendingEntryOrders.size>0&&i!==null&&i<n){console.log(`[TradingManager] 🔄 Flip Guard: Price distance $${i.toFixed(2)} < $${n} — cancelling pending entry bids`),await this.cancelAllPendingEntryOrders();return}if(s.length>0&&i!==null&&i<a){console.log(`[TradingManager] 🚨 Flip Guard: Price distance $${i.toFixed(2)} < $${a} — executing Emergency Market Sell`),await this.closeAllPositions("Flip Guard: distance below threshold — Emergency Market Sell",!0);return}if(s.length>0){if(this.isPlacingExitOrder){const p=Date.now()-this.orderPlacementStartTime;p>6e4&&console.error(`[TradingManager] 🚨 EXIT ORDER IN PROGRESS FOR ${(p/1e3).toFixed(0)}s - May be stuck!`);return}if(this.isPlacingOrder||this.isPlacingSplitOrders){const p=Date.now()-this.orderPlacementStartTime;console.log(`[TradingManager] ℹ️ Entry order in progress (${p}ms), but exit conditions will still be checked`)}await this.updatePositionPrices(),await this.checkExitConditions();return}if(this.isPlacingOrder||this.isPlacingSplitOrders||this.strategyConfig.priceDifference!=null&&(this.currentPrice===null||this.priceToBeat===null||this.getPriceDistanceUSD()<=this.strategyConfig.priceDifference))return;const d=this.strategyConfig.entryTimeRemainingMaxSeconds??180,u=this.getTimeRemainingSeconds();if(!(u===null||u>=d)&&!this.isPlacingOrder){if(this.pendingEntryOrders.size>0){await this.checkPendingEntryOrderFills();return}if(this.pendingLimitOrders.has(t)){await this.checkLimitOrderFill(t);return}if(this.pendingLimitOrders.has(e)){await this.checkLimitOrderFill(e);return}await this.checkAndPlaceLimitOrder(t,e)}}async checkAndPlaceLimitOrder(t,e){try{if(this.consecutiveFailures>=this.MAX_CONSECUTIVE_FAILURES||!this.browserClobClient||this.isPlacingOrder||this.isPlacingSplitOrders)return;const s=this.getActivePositions(),i=s.reduce((S,P)=>S+P.size,0),n=this.strategyConfig.tradeSize;if(this.status.maxPositionSize&&i>=this.status.maxPositionSize||this.status.maxPositionSize&&i+n>this.status.maxPositionSize)return;const a=this.strategyConfig.entryPrice,[d,u]=await Promise.all([this.clobClient.getPrice(t,"BUY"),this.clobClient.getPrice(e,"BUY")]);if(!d||!u)return;const p=Bt(d),w=Bt(u),f=.5;let x=null,T=null;if(p<=a+f&&p>=a-f)x=t,T="UP";else if(w<=a+f&&w>=a-f)x=e,T="DOWN";else{s.length>0&&(p>=w?p:w)<a-f&&(this.priceBelowEntry=!0);return}if(s.length>0){if(!this.priceBelowEntry)return;this.priceBelowEntry=!1}if(!x||!T||!this.verifyBalance(n))return;this.isPlacingOrder=!0,this.orderPlacementStartTime=Date.now();try{const S=await this.placePostOnlyEntryLimitOrder(x,a,n,T);S?.orderId?(this.pendingEntryOrders.set(x,{orderId:S.orderId,direction:T,size:n,limitPrice:a-2,placedAt:Date.now()}),this.consecutiveFailures=0,console.log(`[TradingManager] POST_ONLY limit entry placed at ${(a-2).toFixed(2)} (${T}), orderId: ${S.orderId.substring(0,8)}...`)):this.consecutiveFailures++}finally{this.isPlacingOrder=!1,this.orderPlacementStartTime=0}}catch(s){console.error("[TradingManager] checkAndPlaceLimitOrder error:",s),this.consecutiveFailures++,this.isPlacingOrder=!1,this.orderPlacementStartTime=0}}async placePostOnlyEntryLimitOrder(t,e,s,i){if(!this.browserClobClient||!this.apiCredentials)return{error:"No client or credentials"};const n=Math.max(0,e-2),a=n/100,d=s/a;try{let u;try{u=await this.browserClobClient.getFeeRateBps(t),(!u||u===0)&&(u=1e3)}catch{u=1e3}const{OrderType:p,Side:w}=await Ce(async()=>{const{OrderType:P,Side:M}=await Promise.resolve().then(()=>We);return{OrderType:P,Side:M}},void 0),f={tokenID:t,price:a,size:d,side:w.BUY,feeRateBps:u,expiration:0,taker:"0x0000000000000000000000000000000000000000"},x={negRisk:!1,postOnly:!0},T=await this.browserClobClient.createAndPostOrder(f,x,p.GTC),S=T?.orderID||T?.order_id||T?.id;return S?(console.log(`[TradingManager] POST_ONLY limit BUY placed at ${n.toFixed(2)} (${i})`),{orderId:S}):{error:T?.errorMsg||T?.error||"No order ID"}}catch(u){return{error:u?.message||u?.errorMsg||String(u)}}}async placePostOnlyLimitSellOrder(t,e,s){if(!this.browserClobClient||!this.apiCredentials)return{error:"No client or credentials"};const i=s/100;try{let n;try{n=await this.browserClobClient.getFeeRateBps(t),(!n||n===0)&&(n=1e3)}catch{n=1e3}const{OrderType:a,Side:d}=await Ce(async()=>{const{OrderType:x,Side:T}=await Promise.resolve().then(()=>We);return{OrderType:x,Side:T}},void 0),u={tokenID:t,price:i,size:Math.round(e*100)/100,side:d.SELL,feeRateBps:n,expiration:0,taker:"0x0000000000000000000000000000000000000000"},p={negRisk:!1,postOnly:!0},w=await this.browserClobClient.createAndPostOrder(u,p,a.GTC),f=w?.orderID||w?.order_id||w?.id;return f?{orderId:f}:{error:w?.errorMsg||w?.error||"No order ID"}}catch(n){return{error:n?.message||n?.errorMsg||String(n)}}}async placeProfitTargetLimitSells(t,e){if(this.isPlacingExitOrder||t.length===0||!this.browserClobClient)return;this.isPlacingExitOrder=!0,this.orderPlacementStartTime=Date.now();const s=this.aggregatePositionsByToken(t);try{for(const[i,n]of s.entries()){const a=await this.placePostOnlyLimitSellOrder(i,n.totalShares,e);a.orderId?(this.pendingProfitSellOrders.set(a.orderId,n.positions.map(d=>d.id)),console.log(`[TradingManager] POST_ONLY limit sell at profit target ${e.toFixed(2)} placed, orderId: ${a.orderId.substring(0,8)}...`)):console.warn(`[TradingManager] Profit target limit sell failed for token ${i.substring(0,8)}...:`,a.error)}}finally{this.isPlacingExitOrder=!1,this.orderPlacementStartTime=0}this.notifyStatusUpdate()}async checkPendingProfitSellFills(){if(!(!this.browserClobClient||this.pendingProfitSellOrders.size===0))try{const t=await this.browserClobClient.getOpenOrders(),e=new Set((t||[]).map(s=>s.id||s.orderID));for(const[s,i]of this.pendingProfitSellOrders.entries()){if(e.has(s))continue;this.pendingProfitSellOrders.delete(s);const n=this.positions.length;this.positions=this.positions.filter(a=>!i.includes(a.id)),this.status.positions=[...this.positions],this.status.totalPositionSize=this.positions.reduce((a,d)=>a+d.size,0),this.persistPositions(),console.log(`[TradingManager] ✅ Profit target limit sell filled, orderId: ${s.substring(0,8)}..., removed ${n-this.positions.length} position(s)`)}}catch(t){console.warn("[TradingManager] checkPendingProfitSellFills error:",t)}}async _checkAndPlaceMarketOrder(t,e){}calculateOrderSplits(t,e){if(t<=50)return[{price:e,size:t}];const s=3,i=t/s,n=[];for(let a=0;a<s;a++)n.push({price:e+a,size:i});return n}calculateWeightedAverageEntryPrice(t){if(t.length===0)return 0;let e=0,s=0;for(const i of t)e+=i.price*i.size,s+=i.size;return s>0?e/s:0}async placeSingleMarketOrder(t,e,s,i,n,a){try{if(!this.apiCredentials)return{success:!1,error:"No API credentials"};if(this.browserClobClient){const{OrderType:d,Side:u}=await Ce(async()=>{const{OrderType:k,Side:$}=await Promise.resolve().then(()=>We);return{OrderType:k,Side:$}},void 0),p=await this.browserClobClient.getPrice(t,u.SELL);let w=typeof p=="object"&&p.price?parseFloat(p.price):parseFloat(p);if(isNaN(w)||w<=0||w>=1)return{success:!1,error:"Invalid market price"};const f=.005,x=Math.min(w*(1+f),.999);console.log("[TradingManager] Price adjustment for FAK order:",{originalAskPrice:w.toFixed(4),bufferedAskPrice:x.toFixed(4),bufferPercent:(f*100).toFixed(2)+"%",targetPrice:e.toFixed(2)}),w=x;let T;try{T=await this.browserClobClient.getFeeRateBps(t),(!T||T===0)&&(T=1e3)}catch{T=1e3}const S=s/w,P={tokenID:t,amount:S,side:u.BUY,feeRateBps:T};console.log("[TradingManager] Market order calculation:",{orderSizeUSD:s.toFixed(2),askPrice:w.toFixed(4),shares:S.toFixed(4),estimatedCost:(S*w).toFixed(2)}),console.log(`[TradingManager] Placing split order ${n+1}/${a} at target price ${e.toFixed(2)}:`,{targetPrice:e.toFixed(2),currentPrice:Bt(w).toFixed(2),orderSize:s.toFixed(2)});let M;try{M=await this.browserClobClient.createAndPostMarketOrder(P,{negRisk:!1},d.FAK)}catch(k){const $=k?.response?.data||k?.data||{},O=$?.error||k?.message||"Unknown error";return O.includes("no orders found to match with FAK order")||O.includes("FAK orders are partially filled or killed")?(console.warn(`[TradingManager] ⚠️ FAK order ${n+1}/${a} - No immediate match found at current price:`,{targetPrice:e.toFixed(2),currentAskPrice:Bt(w).toFixed(2),orderSize:s.toFixed(2),error:O,note:"FAK orders require immediate match. Price may have moved or no liquidity at this price."}),{success:!1,error:`No immediate match for FAK order at ${e.toFixed(2)}. Price may have moved or insufficient liquidity.`}):(console.error(`[TradingManager] ❌ Order ${n+1}/${a} failed with error:`,{error:O,errorData:$,tokenId:t.substring(0,10)+"...",targetPrice:e.toFixed(2),orderSize:s.toFixed(2)}),{success:!1,error:O})}if(M?.orderID)return console.log(`[TradingManager] ✅ Order ${n+1}/${a} placed successfully:`,{orderId:M.orderID.substring(0,8)+"...",fillPrice:Bt(w).toFixed(2),orderSize:s.toFixed(2)}),{success:!0,orderId:M.orderID,fillPrice:Bt(w)};{const $=M?.error||M?.data?.error||"No order ID returned from exchange";return console.error(`[TradingManager] ❌ Order ${n+1}/${a} failed:`,{error:$,response:M,tokenId:t.substring(0,10)+"...",targetPrice:e.toFixed(2),orderSize:s.toFixed(2)}),{success:!1,error:$}}}else{const d="Browser ClobClient not initialized. Cannot place orders - server-side API is blocked by Cloudflare. Please ensure wallet is connected and browser client is initialized.";return console.error(`[TradingManager] ❌ Order ${n+1}/${a} cannot be placed:`,{error:d,tokenId:t.substring(0,10)+"...",browserClobClientAvailable:!!this.browserClobClient,apiCredentialsAvailable:!!this.apiCredentials}),{success:!1,error:d}}}catch(d){return{success:!1,error:d instanceof Error?d.message:"Unknown error"}}}async _placeMarketOrder(t,e,s){(!this.isPlacingOrder||!this.isPlacingSplitOrders)&&(console.warn("[TradingManager] Flags not set, setting them now (fallback)"),this.isPlacingOrder=!0,this.isPlacingSplitOrders=!0);try{const i=this.strategyConfig.tradeSize;if(!this.verifyBalance(i)){console.error("[TradingManager] ❌ Order rejected: Insufficient balance"),this.status.failedTrades++;return}const n=this.calculateOrderSplits(i,e),a=i>50;if(console.log("[TradingManager] Placing market order:",{tokenId:t,direction:s,entryPrice:e,tradeSize:i,isLargeOrder:a,numSplits:n.length,splits:n}),!this.apiCredentials){const f={id:`market-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,eventSlug:this.activeEvent.slug,tokenId:t,side:"BUY",size:i,price:e,timestamp:Date.now(),status:"filled",transactionHash:`0x${Math.random().toString(16).substr(2,64)}`,reason:`Simulated market order (FAK) filled at ${e.toFixed(2)} (${s})`,orderType:"MARKET",direction:s},x={id:`position-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,eventSlug:f.eventSlug,tokenId:f.tokenId,side:f.side,size:i,entryPrice:e,direction:s,filledOrders:[{orderId:f.transactionHash,price:e,size:i,timestamp:Date.now()}],entryTimestamp:Date.now()};this.positions.push(x),this.status.positions=[...this.positions],this.status.totalPositionSize=this.positions.reduce((T,S)=>T+S.size,0),this.persistPositions(),this.trades.push(f),this.status.totalTrades++,this.status.successfulTrades++,this.notifyTradeUpdate(f),this.notifyStatusUpdate();return}const d=[];let u=0,p=!1;for(let f=0;f<n.length;f++){const x=n[f],T=await this.placeSingleMarketOrder(t,x.price,x.size,s,f,n.length);if(T.success&&T.orderId&&T.fillPrice!==void 0){d.push({orderId:T.orderId,price:T.fillPrice,size:x.size,timestamp:Date.now()}),u+=x.size;const S={id:`market-${Date.now()}-${f}-${Math.random().toString(36).substr(2,9)}`,eventSlug:this.activeEvent.slug,tokenId:t,side:"BUY",size:x.size,price:T.fillPrice,timestamp:Date.now(),status:"filled",transactionHash:T.orderId,reason:`Market order ${a?`(${f+1}/${n.length}) `:""}filled at ${T.fillPrice.toFixed(2)} (${s})`,orderType:"MARKET",direction:s};this.trades.push(S),this.status.totalTrades++,this.notifyTradeUpdate(S),this.consecutiveFailures=0}else{console.error(`[TradingManager] ❌ Split order ${f+1}/${n.length} failed:`,{error:T.error,tokenId:t.substring(0,10)+"...",direction:s,targetPrice:x.price.toFixed(2),orderSize:x.size.toFixed(2)}),this.consecutiveFailures++,p=!0,console.error(`[TradingManager] 🚫 CANCELING REMAINING ${n.length-f-1} ORDER(S) due to failure in order ${f+1}`);break}f<n.length-1&&await new Promise(S=>setTimeout(S,500))}this.consecutiveFailures>=this.MAX_CONSECUTIVE_FAILURES&&(console.error(`[TradingManager] 🔴 CIRCUIT BREAKER TRIGGERED: ${this.consecutiveFailures} consecutive failures. Stopping trading.`),this.stopTrading());const w=n.length-d.length;if(d.length>0){const f=this.calculateWeightedAverageEntryPrice(d.map(T=>({price:T.price,size:T.size})));p?(console.warn(`[TradingManager] ⚠️ PARTIAL FILL: ${d.length} of ${n.length} orders filled. ${w} order(s) canceled due to failure.`),console.warn(`[TradingManager] ⚠️ Position created with partial size: ${u.toFixed(2)} USDC instead of planned ${i.toFixed(2)} USDC`)):w>0&&console.warn(`[TradingManager] ⚠️ Partial success: ${d.length} of ${n.length} orders filled. ${w} order(s) failed.`);const x={id:`position-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,eventSlug:this.activeEvent.slug,tokenId:t,side:"BUY",size:u,entryPrice:f,direction:s,filledOrders:d,entryTimestamp:Date.now()};this.positions.push(x),this.persistPositions(),this.status.positions=[...this.positions],this.status.totalPositionSize=this.positions.reduce((T,S)=>T+S.size,0),this.status.successfulTrades++,console.log("[TradingManager] ✅ New position created:",{positionId:x.id,direction:s,totalSize:u.toFixed(2),avgEntryPrice:f.toFixed(2),numOrders:d.length,totalPositions:this.positions.length,totalPositionSize:this.status.totalPositionSize.toFixed(2)}),console.log("[TradingManager] All buy orders placed, will fetch order details in 2 seconds..."),setTimeout(()=>{if(this.onTradeUpdate&&d.length>0){const T=this.trades[this.trades.length-1];T&&(console.log("[TradingManager] Triggering order fetch after buy orders..."),this.onTradeUpdate(T))}},2e3)}else console.error(`[TradingManager] ❌ All ${n.length} order(s) failed for ${s} position at entry price ${e.toFixed(2)}`),console.error("[TradingManager] ❌ Possible reasons:"),console.error("  - Insufficient balance"),console.error("  - Invalid market price"),console.error("  - API rate limiting"),console.error("  - Network/Cloudflare issues"),console.error("  - Order rejection by exchange"),this.status.failedTrades++;this.notifyStatusUpdate()}catch(i){const n=i instanceof Error?i.message:"Unknown error";console.error("[TradingManager] ❌ Exception in placeMarketOrder:",{error:n,errorType:i instanceof Error?i.constructor.name:typeof i,tokenId:t.substring(0,10)+"...",direction:s,entryPrice:e.toFixed(2),stack:i instanceof Error?i.stack:void 0}),this.status.failedTrades++}finally{this.isPlacingOrder=!1,this.isPlacingSplitOrders=!1,this.orderPlacementStartTime=0}}async checkLimitOrderFill(t){const e=this.pendingLimitOrders.get(t);if(e)try{const s=await this.clobClient.getPrice(t,"BUY");if(!s)return;const i=Bt(s),n=e.limitPrice;if(i<=n+.1){e.status="filled",e.price=i,e.transactionHash=`0x${Math.random().toString(16).substr(2,64)}`,this.pendingLimitOrders.delete(t),this.status.pendingLimitOrders=this.pendingLimitOrders.size,this.status.successfulTrades++;const a=this.activeEvent?.clobTokenIds?.[0]===t?"UP":"DOWN";this.status.currentPosition={eventSlug:e.eventSlug,tokenId:e.tokenId,side:e.side,entryPrice:i,size:e.size,direction:a},e.direction=a,console.log(`Limit order filled: ${e.id} at ${i.toFixed(2)}`),this.notifyTradeUpdate(e),this.notifyStatusUpdate()}}catch(s){console.error("Error checking limit order fill:",s)}}async updatePositionPrices(){const t=this.getActivePositions();if(t.length!==0&&!(!this.activeEvent||!this.activeEvent.clobTokenIds||this.activeEvent.clobTokenIds.length<2))try{const e=this.activeEvent.clobTokenIds[0],s=this.activeEvent.clobTokenIds[1];if(!e||!s)return;const[i,n]=await Promise.all([this.clobClient.getPrice(e,"SELL"),this.clobClient.getPrice(s,"SELL")]);if(!i||!n)return;const a=Bt(i),d=Bt(n);for(const u of t){const w=(u.direction||"UP")==="UP"?a:d;u.currentPrice=w;const f=w-u.entryPrice;u.unrealizedProfit=f/u.entryPrice*u.size}this.status.positions=[...this.positions],this.notifyStatusUpdate()}catch(e){console.error("[TradingManager] Error updating position prices:",e)}}async checkExitConditions(){const t=this.getActivePositions();if(t.length!==0){if(console.log(`[TradingManager] 🔍 CHECKING EXIT CONDITIONS for ${t.length} position(s) at ${new Date().toISOString()}`),t.length>1&&console.log(`[TradingManager] 👀 Checking exit conditions for ${t.length} POSITIONS:`,t.map(e=>({id:e.id.substring(0,8)+"...",direction:e.direction,size:e.size.toFixed(2)}))),this.pendingProfitSellOrders.size>0){await this.checkPendingProfitSellFills(),this.notifyStatusUpdate();return}if(this.isPlacingExitOrder){const e=Date.now()-this.orderPlacementStartTime;if(e>this.MAX_ORDER_PLACEMENT_TIME)console.error(`[TradingManager] 🚨 EXIT ORDER FLAGS STUCK! Exit order exceeded ${this.MAX_ORDER_PLACEMENT_TIME}ms. Force resetting flags.`),this.isPlacingExitOrder=!1,this.orderPlacementStartTime=0;else{console.log(`[TradingManager] ⚠️ checkExitConditions waiting - Exit order in progress (${e}ms)`);return}}if(this.isPlacingOrder||this.isPlacingSplitOrders){const e=Date.now()-this.orderPlacementStartTime;console.log(`[TradingManager] ℹ️ Entry order in progress (${e}ms), but exit conditions will still be checked`)}if(!(!this.activeEvent||!this.activeEvent.clobTokenIds||this.activeEvent.clobTokenIds.length<2))try{const e=this.activeEvent.clobTokenIds[0],s=this.activeEvent.clobTokenIds[1];if(!e||!s)return;const[i,n]=await Promise.all([this.clobClient.getPrice(e,"SELL"),this.clobClient.getPrice(s,"SELL")]);if(!i||!n){console.error("[TradingManager] ❌ Failed to fetch prices for exit check:",{yesPrice:i||"null",noPrice:n||"null",yesTokenId:e.substring(0,10)+"...",noTokenId:s.substring(0,10)+"...",activePositions:t.length});return}const a=Bt(i),d=Bt(n),u=this.strategyConfig.profitTargetPrice,p=this.strategyConfig.stopLossPrice;if(console.log("[TradingManager] 📊 Current Market Prices:",{yesPricePercent:a.toFixed(2),noPricePercent:d.toFixed(2),profitTarget:u.toFixed(2),stopLoss:p.toFixed(2),activePositions:t.length}),u==null||isNaN(u)){console.error(`[TradingManager] ❌ Invalid profit target: ${u}`);return}if(p==null||isNaN(p)){console.error(`[TradingManager] ❌ Invalid stop loss: ${p}`);return}let w=!1,f="",x=!1,T=!1,S=null;for(const P of t){const k=(P.direction||"UP")==="UP"?a:d;P.currentPrice=k;const $=k-P.entryPrice;P.unrealizedProfit=$/P.entryPrice*P.size}for(const P of t){const M=P.direction||"UP",k=M==="UP"?a:d;P.currentPrice=k;const $=k-P.entryPrice;P.unrealizedProfit=$/P.entryPrice*P.size,(k>=95||M==="DOWN")&&console.log("[TradingManager] 🔍 Position Check:",{positionId:P.id.substring(0,8)+"...",direction:M,entryPrice:P.entryPrice.toFixed(2),currentPrice:k.toFixed(2),yesPrice:a.toFixed(2),noPrice:d.toFixed(2),profitTarget:u.toFixed(2),stopLoss:p.toFixed(2)});const O=.01,C=k>=u-O;if((M==="DOWN"||k>=95)&&console.log("[TradingManager] 🔍 Profit Target Check:",{positionId:P.id.substring(0,8)+"...",direction:M,entryPrice:P.entryPrice.toFixed(2),currentSellPrice:k.toFixed(2),profitTarget:u.toFixed(2),condition:`${k.toFixed(2)} >= ${(u-O).toFixed(2)} = ${C}`,priceDifference:(k-u).toFixed(2),yesPrice:a.toFixed(2),noPrice:d.toFixed(2),rawComparison:`${k} >= ${u}`}),C){w=!0,f=`Profit target reached at ${k.toFixed(2)} (Position: ${P.id.substring(0,8)}...)`,S=P,console.log(`[TradingManager] 🎯🎯🎯 PROFIT TARGET TRIGGERED! Position ${P.id.substring(0,8)}... at price ${k.toFixed(2)} >= profit target ${u.toFixed(2)}. Will close ALL ${t.length} position(s).`),console.log("[TradingManager] 📊 Profit Target Details:",{positionId:P.id.substring(0,8)+"...",direction:M,entryPrice:P.entryPrice.toFixed(2),currentSellPrice:k.toFixed(2),profitTarget:u.toFixed(2),condition:`${k.toFixed(2)} >= ${u.toFixed(2)} = ${C}`,priceDifference:(k-u).toFixed(2),unrealizedProfit:P.unrealizedProfit?.toFixed(2),yesPrice:a.toFixed(2),noPrice:d.toFixed(2)});break}if(k<=p){w=!0,f=`Stop loss triggered at ${k.toFixed(2)} (Position: ${P.id.substring(0,8)}...)`,x=!0,T=M==="DOWN",S=P,console.log(`[TradingManager] 🛑🛑🛑 STOP LOSS TRIGGERED! Position ${P.id.substring(0,8)}... at price ${k.toFixed(2)} <= stop loss ${p.toFixed(2)}. Will close ALL ${t.length} position(s).`);break}}if(!w&&t.some(M=>{const k=M.currentPrice||0,$=Math.abs(k-p),O=Math.abs(k-u);return $<2||O<2})){const M={yesSellPrice:a.toFixed(2),noSellPrice:d.toFixed(2),profitTarget:u.toFixed(2),stopLoss:p.toFixed(2),positions:t.map(k=>{const $=k.currentPrice||0,O=$-p,C=u-$,D=$>=u,U=$<=p;return{id:k.id.substring(0,8),direction:k.direction,entryPrice:k.entryPrice.toFixed(2),currentSellPrice:$.toFixed(2),profitTargetCheck:`${$.toFixed(2)} >= ${u.toFixed(2)} = ${D}`,distanceToProfitTarget:C.toFixed(2),stopLossCheck:`${$.toFixed(2)} <= ${p.toFixed(2)} = ${U}`,distanceToStopLoss:O.toFixed(2),unrealizedProfit:k.unrealizedProfit?.toFixed(2)}})};console.log("[TradingManager] ⚠️ Exit check: NO EXIT (price near threshold)",M)}w&&(console.log(`[TradingManager] 🚨🚨🚨 EXIT CONDITION MET - Closing ALL ${t.length} position(s):`,{exitReason:f,yesSellPrice:a.toFixed(2),noSellPrice:d.toFixed(2),profitTarget:u.toFixed(2),stopLoss:p.toFixed(2),triggeringPosition:S?{id:S.id.substring(0,8),direction:S.direction,entryPrice:S.entryPrice.toFixed(2),currentSellPrice:S.currentPrice?.toFixed(2),profitCheck:`${S.currentPrice?.toFixed(2)} >= ${u.toFixed(2)} = ${(S.currentPrice||0)>=u}`,stopLossCheck:`${S.currentPrice?.toFixed(2)} <= ${p.toFixed(2)} = ${(S.currentPrice||0)<=p}`}:null,allPositions:t.map(P=>({id:P.id.substring(0,8),direction:P.direction,size:P.size.toFixed(2),entryPrice:P.entryPrice.toFixed(2),currentSellPrice:P.currentPrice?.toFixed(2)})),useAdaptiveSelling:x,isPlacingExitOrder:this.isPlacingExitOrder,isPlacingEntryOrder:this.isPlacingOrder||this.isPlacingSplitOrders}),x?(console.log("[TradingManager] 🚨 Executing STOP LOSS exit via adaptive selling (market - emergency)..."),await this.closeAllPositionsWithAdaptiveSelling(f,p,T,a,d)):(console.log(`[TradingManager] 🎯 Placing POST_ONLY limit sell at profit target ${u.toFixed(2)}...`),await this.placeProfitTargetLimitSells(t,u))),this.notifyStatusUpdate()}catch(e){console.error("Error checking exit conditions:",e)}}}async placeSingleSellOrder(t,e,s,i,n,a,d){try{if(!this.apiCredentials)return{success:!1,error:"No API credentials"};const u=s==="UP"?a:d,p=u/100;if(isNaN(p)||p<=0||p>=1)return{success:!1,error:"Invalid market price"};const w=e*p;if(this.browserClobClient){const{OrderType:f,Side:x}=await Ce(async()=>{const{OrderType:k,Side:$}=await Promise.resolve().then(()=>We);return{OrderType:k,Side:$}},void 0);let T;try{T=await this.browserClobClient.getFeeRateBps(t),(!T||T===0)&&(T=1e3)}catch{T=1e3}const S=Math.round(e*100)/100;if(S<=0||isNaN(S)||!isFinite(S)){const k=`Invalid shares calculated: ${e}. Cannot place sell order.`;return console.error(`[TradingManager] ❌ SELL order ${i+1}/${n} - ${k}`),{success:!1,error:k}}const P={tokenID:t,amount:S,side:x.SELL,feeRateBps:T};console.log(`[TradingManager] 📤 SELL order ${i+1}/${n} - Attempting to place:`,{tokenId:t.substring(0,10)+"...",direction:s,currentSellPrice:u.toFixed(2),yesPricePercent:a.toFixed(2),noPricePercent:d.toFixed(2),shares:e.toFixed(8),roundedShares:S.toFixed(2),estimatedUSD:w.toFixed(2),bidPrice:p.toFixed(4),note:"Shares calculated from actual filled orders (what you actually own)"});let M;try{M=await this.browserClobClient.createAndPostMarketOrder(P,{negRisk:!1},f.FAK)}catch(k){const $=k?.response?.data||k?.data||{},O=$?.error||k?.message||"Unknown error";return O.includes("no orders found to match with FAK order")||O.includes("FAK orders are partially filled or killed")?(console.warn(`[TradingManager] ⚠️ SELL FAK order ${i+1}/${n} - No immediate match found:`,{currentSellPrice:u.toFixed(2),shares:e.toFixed(4),estimatedUSD:w.toFixed(2),error:O,note:"FAK orders require immediate match. Price may have moved or no liquidity at this price."}),{success:!1,error:`No immediate match for FAK SELL order at ${u.toFixed(2)}. Price may have moved or insufficient liquidity.`}):O.includes("not enough balance")||O.includes("allowance")||O.includes("insufficient")?(console.error(`[TradingManager] 🚫🚫🚫 SELL order ${i+1}/${n} - CRITICAL: Insufficient balance/allowance:`,{error:O,shares:e.toFixed(4),estimatedUSD:w.toFixed(2),tokenId:t.substring(0,10)+"...",direction:s,currentSellPrice:u.toFixed(2),troubleshooting:["1. Check token balance in your wallet - you may not have enough shares","2. Check token allowance - tokens must be approved for the proxy contract","3. Verify shares calculation is correct (entry price vs current price)","4. Position may have been partially filled or already sold"]}),{success:!1,error:`Insufficient balance/allowance: Cannot sell ${e.toFixed(4)} shares. Check: 1) Token balance, 2) Token allowance for proxy contract.`}):(console.error(`[TradingManager] ❌ SELL order ${i+1}/${n} failed with error:`,{error:O,errorData:$,tokenId:t.substring(0,10)+"...",currentSellPrice:u.toFixed(2),shares:e.toFixed(4),estimatedUSD:w.toFixed(2)}),{success:!1,error:O})}if(M?.orderID)return console.log(`[TradingManager] ✅ SELL order ${i+1}/${n} - SUCCESS:`,{orderId:M.orderID.substring(0,12)+"...",fillPrice:u.toFixed(2)}),{success:!0,orderId:M.orderID,fillPrice:u};{const $=M?.error||M?.data?.error||"No order ID returned from exchange";return console.error(`[TradingManager] ❌ SELL order ${i+1}/${n} - FAILED:`,{error:$,response:M,tokenId:t.substring(0,10)+"...",currentSellPrice:u.toFixed(2),shares:e.toFixed(4)}),{success:!1,error:$}}}else{const f="Browser ClobClient not initialized. Cannot place SELL orders - server-side API is blocked by Cloudflare. Please ensure wallet is connected and browser client is initialized.";return console.error(`[TradingManager] ❌ SELL order ${i+1}/${n} cannot be placed:`,{error:f,tokenId:t.substring(0,10)+"...",browserClobClientAvailable:!!this.browserClobClient,apiCredentialsAvailable:!!this.apiCredentials}),{success:!1,error:f}}}catch(u){return{success:!1,error:u instanceof Error?u.message:"Unknown error"}}}aggregatePositionsByToken(t){const e=new Map;for(const s of t){const i=s.tokenId;e.has(i)||e.set(i,{positions:[],totalSize:0,totalShares:0,direction:s.direction||"UP"});const n=e.get(i);if(n.positions.push(s),n.totalSize+=s.size,s.filledOrders&&s.filledOrders.length>0){let a=0;for(const d of s.filledOrders){const u=d.price/100,p=d.size/u;a+=p}n.totalShares+=a,console.log("[TradingManager] 📊 Position shares from filled orders:",{positionId:s.id.substring(0,8)+"...",numFilledOrders:s.filledOrders.length,totalShares:a.toFixed(4),filledOrders:s.filledOrders.map(d=>({price:d.price.toFixed(2),sizeUSD:d.size.toFixed(2),shares:(d.size/(d.price/100)).toFixed(4)}))})}else{const a=s.entryPrice/100,d=s.size/a;n.totalShares+=d,console.warn(`[TradingManager] ⚠️ Position ${s.id.substring(0,8)}... has no filledOrders, using entry price calculation (may be inaccurate)`)}}return e}async closeAllPositions(t,e=!1){const s=[...this.getActivePositions()];if(s.length===0){console.log("[TradingManager] closeAllPositions: No active positions to close");return}if(this.isPlacingExitOrder){console.log("[TradingManager] Exit order already being placed, skipping...");return}this.isPlacingExitOrder=!0,this.orderPlacementStartTime=Date.now();const i=[],n=[];console.log(`[TradingManager] 🔒 Exit flags locked. isPlacingExitOrder=${this.isPlacingExitOrder}`),console.log(`[TradingManager] 📸 Snapshot taken: ${s.length} position(s) to close`);const a=this.aggregatePositionsByToken(s);console.log(`[TradingManager] 📊 Aggregated into ${a.size} unique token(s):`,Array.from(a.entries()).map(([d,u])=>({tokenId:d.substring(0,10)+"...",numPositions:u.positions.length,totalSizeUSD:u.totalSize.toFixed(2),direction:u.direction,positionIds:u.positions.map(p=>p.id.substring(0,8)+"...")})));try{const d=s.reduce((T,S)=>T+S.size,0),u=s.map(T=>T.tokenId),p=new Set(u),w=p.size<u.length;console.log(`[TradingManager] 🚨🚨🚨 STARTING TO CLOSE ALL ${s.length} POSITION(S) - ${t}:`,{reason:t,totalSize:d.toFixed(2),isStopLoss:e?"⚡ YES - AGGRESSIVE MODE":"no",activeEventSlug:this.activeEvent?.slug,allPositionsInMemory:this.positions.length,uniqueTokenIds:p.size,hasDuplicateTokens:w?"⚠️ YES - Multiple positions on same token!":"no",positions:s.map((T,S)=>({index:S+1,id:T.id.substring(0,8)+"...",tokenId:T.tokenId.substring(0,10)+"...",eventSlug:T.eventSlug,direction:T.direction,side:T.side,size:T.size.toFixed(2),entryPrice:T.entryPrice.toFixed(2),currentPrice:T.currentPrice?.toFixed(2),unrealizedProfit:T.unrealizedProfit?.toFixed(2)}))}),console.log(`[TradingManager] 🔄 Processing ${a.size} unique token(s)...`);let f=0;for(const[T,S]of a.entries()){f++,console.log("[TradingManager] ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"),console.log(`[TradingManager] 🔄 [${f}/${a.size}] PROCESSING TOKEN ${f}`),console.log("[TradingManager] 🔄 Token Details:",{tokenId:T.substring(0,10)+"...",numPositions:S.positions.length,totalSizeUSD:S.totalSize.toFixed(2),totalShares:S.totalShares.toFixed(4),direction:S.direction,positionIds:S.positions.map(P=>P.id.substring(0,8)+"...")});try{await this.closeAggregatedPositions(S.positions,T,S.totalSize,S.totalShares,S.direction,t,e);for(const P of S.positions)i.push(P.id);console.log(`[TradingManager] ✅✅✅ [${f}/${a.size}] SUCCESS - Closed ${S.positions.length} position(s) for token ${T.substring(0,10)}...`)}catch(P){const M=P instanceof Error?P.message:"Unknown error",k=P instanceof Error?P.stack:void 0;for(const $ of S.positions)n.push($.id);console.error(`[TradingManager] ❌❌❌ [${f}/${a.size}] FAILED - Could not close ${S.positions.length} position(s) for token ${T.substring(0,10)}...`),console.error("[TradingManager] ❌ Error details:",{error:M,stack:k,tokenId:T.substring(0,10)+"...",totalSize:S.totalSize.toFixed(2)})}console.log(`[TradingManager] 🏁 [${f}/${a.size}] FINISHED processing token ${f}`)}if(console.log("[TradingManager] ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"),console.log(`[TradingManager] 🏁 ALL ${a.size} TOKEN(S) PROCESSED`),console.log(`[TradingManager] 🏁 Total positions affected: ${s.length}`),console.log(`[TradingManager] 🏁 FINISHED processing all ${s.length} position(s). Results:`,{attempted:s.length,succeeded:i.length,failed:n.length,closedPositionIds:i.map(T=>T.substring(0,8)+"..."),failedPositionIds:n.map(T=>T.substring(0,8)+"...")}),i.length>0){const T=this.positions.length;this.positions=this.positions.filter(P=>!i.includes(P.id));const S=this.positions.length;if(this.status.positions=[...this.positions],this.status.totalPositionSize=this.positions.reduce((P,M)=>P+M.size,0),this.persistPositions(),console.log(`[TradingManager] 📊 Position cleanup: ${T} → ${S} (removed ${T-S})`),n.length===0)console.log(`[TradingManager] ✅✅✅ FULL SUCCESS: All ${i.length} position(s) closed successfully!`);else{console.warn(`[TradingManager] ⚠️⚠️⚠️ PARTIAL SUCCESS: Closed ${i.length} of ${s.length} position(s)`),console.warn(`[TradingManager] ⚠️ ${n.length} position(s) FAILED to close`);const P=s.filter(M=>n.includes(M.id));if(console.error("[TradingManager] ❌ Failed positions:",P.map(M=>({id:M.id.substring(0,8)+"...",tokenId:M.tokenId.substring(0,10)+"...",direction:M.direction,size:M.size.toFixed(2)}))),e&&P.length>0){console.error(`[TradingManager] 🔄🔄🔄 STOP LOSS RETRY: Attempting to close ${P.length} failed position(s) again...`),console.error("[TradingManager] 🔄 Waiting 1 second before retry..."),await new Promise(O=>setTimeout(O,1e3));const M=this.aggregatePositionsByToken(P);console.log(`[TradingManager] 🔄 Retry will process ${M.size} token(s) covering ${P.length} position(s)`);let k=0;for(const[O,C]of M.entries()){k++;try{console.log(`[TradingManager] 🔄 RETRY ${k}/${M.size}: Token ${O.substring(0,10)}... (${C.positions.length} positions, $${C.totalSize.toFixed(2)}, ${C.totalShares.toFixed(4)} shares)`),await this.closeAggregatedPositions(C.positions,O,C.totalSize,C.totalShares,C.direction,`${t} - RETRY AFTER FAILURE`,!0);for(const D of C.positions){i.push(D.id);const U=n.indexOf(D.id);U>-1&&n.splice(U,1)}console.log(`[TradingManager] ✅ RETRY ${k} SUCCESS: ${C.positions.length} position(s) closed`)}catch(D){const U=D instanceof Error?D.message:"Unknown error";console.error(`[TradingManager] ❌ RETRY ${k} FAILED: Token ${O.substring(0,10)}... still could not be closed:`,U)}}this.positions=this.positions.filter(O=>!i.includes(O.id)),this.status.positions=[...this.positions],this.status.totalPositionSize=this.positions.reduce((O,C)=>O+C.size,0),this.persistPositions();const $=this.getActivePositions();$.length>0?(console.error(`[TradingManager] 🚨 CRITICAL: ${$.length} position(s) STILL OPEN after retry!`),console.error("[TradingManager] 🚨 You may need to manually close these positions:",$.map(O=>({id:O.id.substring(0,8)+"...",tokenId:O.tokenId.substring(0,10)+"...",direction:O.direction,size:O.size.toFixed(2)})))):console.log("[TradingManager] ✅ RETRY COMPLETE: All positions successfully closed after retry!")}}}else if(console.error(`[TradingManager] ❌❌❌ TOTAL FAILURE: No positions were successfully closed out of ${s.length} attempted!`),e){console.error("[TradingManager] 🔄 STOP LOSS TOTAL RETRY: All positions failed. Retrying entire process..."),await new Promise(S=>setTimeout(S,2e3));const T=this.aggregatePositionsByToken(s);console.log(`[TradingManager] 🔄 Emergency retry will process ${T.size} token(s)`);for(const[S,P]of T.entries())try{await this.closeAggregatedPositions(P.positions,S,P.totalSize,P.totalShares,P.direction,`${t} - EMERGENCY RETRY`,!0);for(const M of P.positions)i.push(M.id)}catch{console.error(`[TradingManager] ❌ EMERGENCY RETRY FAILED for token ${S.substring(0,10)}...`)}i.length>0&&(this.positions=this.positions.filter(S=>!i.includes(S.id)),this.status.positions=[...this.positions],this.status.totalPositionSize=this.positions.reduce((S,P)=>S+P.size,0),this.persistPositions(),console.log(`[TradingManager] 🔄 EMERGENCY RETRY: Closed ${i.length} of ${s.length} position(s)`))}this.notifyStatusUpdate();const x=this.getActivePositions();x.length>0?(console.error(`[TradingManager] ⚠️⚠️⚠️ VERIFICATION FAILED: ${x.length} position(s) still open after closeAllPositions!`),console.error("[TradingManager] Open positions:",x.map(T=>({id:T.id.substring(0,8)+"...",tokenId:T.tokenId.substring(0,10)+"...",direction:T.direction,size:T.size.toFixed(2)})))):console.log("[TradingManager] ✅ VERIFICATION PASSED: No positions remain open for this event")}catch(d){console.error("[TradingManager] ❌ Error closing all positions:",d),i.length>0&&(console.log(`[TradingManager] 🧹 Cleaning up ${i.length} successfully closed position(s) despite error...`),this.positions=this.positions.filter(u=>!i.includes(u.id)),this.status.positions=[...this.positions],this.status.totalPositionSize=this.positions.reduce((u,p)=>u+p.size,0),this.persistPositions(),this.notifyStatusUpdate())}finally{this.isPlacingExitOrder=!1,this.orderPlacementStartTime=0,console.log(`[TradingManager] 🔓 Exit flags unlocked. isPlacingExitOrder=${this.isPlacingExitOrder}`),console.log(`[TradingManager] 🏁 closeAllPositions finished. Final position count: ${this.positions.length}`)}}async closeAggregatedPositions(t,e,s,i,n,a,d){if(console.log(`[TradingManager] 💰 AGGREGATED CLOSE: Selling ${t.length} position(s) for token ${e.substring(0,10)}...`,{totalSizeUSD:s.toFixed(2),totalShares:i.toFixed(4),direction:n,positions:t.map(q=>{const Ft=q.entryPrice/100,Yt=q.size/Ft;return{id:q.id.substring(0,8)+"...",size:q.size.toFixed(2),entryPrice:q.entryPrice.toFixed(2),shares:Yt.toFixed(4)}})}),!this.apiCredentials){const q=t.reduce((qt,b)=>qt+b.entryPrice*b.size,0)/s,Ft=q,Vt=(Ft-q)/q*s,G={id:`exit-aggregated-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,eventSlug:t[0].eventSlug,tokenId:e,side:"SELL",size:s,price:Ft,timestamp:Date.now(),status:"filled",transactionHash:`0x${Math.random().toString(16).substr(2,64)}`,profit:Vt,reason:`Simulated aggregated exit (${t.length} positions): ${a}`,orderType:"MARKET",direction:n};this.trades.push(G),this.status.totalTrades++,this.status.totalProfit+=Vt,this.status.successfulTrades++,this.notifyTradeUpdate(G);return}if(!this.activeEvent||!this.activeEvent.clobTokenIds||this.activeEvent.clobTokenIds.length<2)throw new Error("Cannot close positions: missing event or token IDs");const u=this.activeEvent.clobTokenIds[0],p=this.activeEvent.clobTokenIds[1],[w,f]=await Promise.all([this.clobClient.getPrice(u,"SELL"),this.clobClient.getPrice(p,"SELL")]);if(!w||!f)throw new Error("Cannot close positions: failed to fetch prices");const x=Bt(w),T=Bt(f),S=n==="UP"?x:T;console.log("[TradingManager] 📊 AGGREGATED SELL CALCULATION:",{totalSizeUSD:s.toFixed(2),totalShares:i.toFixed(4),currentSellPrice:S.toFixed(4),estimatedUSDValue:(i*(S/100)).toFixed(2),numPositions:t.length,note:"Shares calculated from entry prices (actual shares owned)",warning:"Ensure you have sufficient token balance and allowance for this sell order"});const P=await this.placeSingleSellOrder(e,i,n,0,1,x,T);if(!P.success||!P.orderId||P.fillPrice===void 0)throw new Error(`Aggregated sell order failed: ${P.error||"Unknown error"}`);const M=P.fillPrice/100,k=i*M,$=t.reduce((q,Ft)=>q+Ft.entryPrice*Ft.size,0)/s,O=$/100,C=i*O,D=k-C,U={id:`exit-aggregated-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,eventSlug:t[0].eventSlug,tokenId:e,side:"SELL",size:k,price:P.fillPrice,timestamp:Date.now(),status:"filled",transactionHash:P.orderId,profit:D,reason:`Aggregated exit (${t.length} positions${d?" - ⚡STOP LOSS⚡":""}): ${a}`,orderType:"MARKET",direction:n};this.trades.push(U),this.status.totalTrades++,this.status.totalProfit+=D,this.status.successfulTrades++,this.notifyTradeUpdate(U),console.log("[TradingManager] ✅ AGGREGATED CLOSE SUCCESS:",{numPositions:t.length,totalShares:i.toFixed(4),entryCostUSD:C.toFixed(2),exitValueUSD:k.toFixed(2),avgEntryPrice:$.toFixed(2),exitPrice:P.fillPrice.toFixed(2),totalProfit:D.toFixed(2),orderId:P.orderId.substring(0,12)+"..."})}async closeAllPositionsWithAdaptiveSelling(t,e,s,i,n){const a=this.getActivePositions();if(a.length===0)return;if(this.isPlacingExitOrder){console.log("[TradingManager] Exit order already being placed, skipping...");return}const d=s?n:i;console.log("[TradingManager] 🛑🛑🛑 AGGRESSIVE STOP LOSS TRIGGERED - Immediately selling ALL positions:",{stopLossPrice:e,direction:s?"DOWN":"UP",currentPrice:d.toFixed(2),numPositions:a.length,reason:t}),await this.closeAllPositions(`${t} - Aggressive stop loss exit at ${d.toFixed(2)}`,!0)}async closeSinglePosition(t,e,s=!1){const i=t.size,n=t.direction||"UP",a=s?1:i>50?3:1,d=i/a;if(console.log(`[TradingManager] 🔄 CLOSING SINGLE POSITION (SELL) - Position ${t.id.substring(0,8)}...`,{positionId:t.id,tokenId:t.tokenId.substring(0,10)+"...",direction:n,sizeUSD:i.toFixed(2),entryPrice:t.entryPrice.toFixed(2),currentPrice:t.currentPrice?.toFixed(2),isStopLoss:s?"⚡ YES":"no",numSplits:a,sizePerSplit:d.toFixed(2),reason:e}),!this.apiCredentials){const O=t.entryPrice,D=(O-t.entryPrice)/t.entryPrice*i,U={id:`exit-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,eventSlug:t.eventSlug,tokenId:t.tokenId,side:"SELL",size:i,price:O,timestamp:Date.now(),status:"filled",transactionHash:`0x${Math.random().toString(16).substr(2,64)}`,profit:D,reason:`Simulated exit: ${e}`,orderType:"MARKET",direction:n};this.trades.push(U),this.status.totalTrades++,this.status.totalProfit+=D,this.status.successfulTrades++,this.notifyTradeUpdate(U);return}if(!this.activeEvent||!this.activeEvent.clobTokenIds||this.activeEvent.clobTokenIds.length<2){console.error("[TradingManager] Cannot close position: missing event or token IDs");return}const u=this.activeEvent.clobTokenIds[0],p=this.activeEvent.clobTokenIds[1],[w,f]=await Promise.all([this.clobClient.getPrice(u,"SELL"),this.clobClient.getPrice(p,"SELL")]);if(!w||!f){console.error("[TradingManager] Cannot close position: failed to fetch prices");return}const x=Bt(w),T=Bt(f);let S=0;if(t.filledOrders&&t.filledOrders.length>0){for(const O of t.filledOrders){const C=O.price/100,D=O.size/C;S+=D}console.log("[TradingManager] 📊 SINGLE POSITION SELL CALCULATION (from filled orders):",{positionSizeUSD:i.toFixed(2),numFilledOrders:t.filledOrders.length,totalSharesOwned:S.toFixed(4),filledOrders:t.filledOrders.map(O=>({price:O.price.toFixed(2),sizeUSD:O.size.toFixed(2),shares:(O.size/(O.price/100)).toFixed(4)})),numSplits:a,note:"Shares calculated from actual filled orders (what you actually own)"})}else{const O=t.entryPrice/100;S=t.size/O,console.warn(`[TradingManager] ⚠️ Position ${t.id.substring(0,8)}... has no filledOrders, using entry price calculation (may be inaccurate)`),console.log("[TradingManager] 📊 SINGLE POSITION SELL CALCULATION (fallback):",{positionSizeUSD:i.toFixed(2),entryPrice:t.entryPrice.toFixed(2),totalSharesOwned:S.toFixed(4),numSplits:a,note:"⚠️ Using fallback calculation - may be inaccurate"})}const P=S/a;let M=0,k=0;const $=[];for(let O=0;O<a;O++){const C=await this.placeSingleSellOrder(t.tokenId,P,n,O,a,x,T);if(C.success&&C.orderId&&C.fillPrice!==void 0){const D=C.fillPrice/100,U=t.entryPrice/100,q=P*D,Ft=P*U,Yt=q-Ft;M+=Yt,k+=q;const Vt={id:`exit-${Date.now()}-${O}-${Math.random().toString(36).substr(2,9)}`,eventSlug:t.eventSlug,tokenId:t.tokenId,side:"SELL",size:q,price:C.fillPrice,timestamp:Date.now(),status:"filled",transactionHash:C.orderId,profit:Yt,reason:`${s?"🛑 AGGRESSIVE STOP LOSS: ":""}Exit ${a>1?`(${O+1}/${a}) `:""}${e}`,orderType:"MARKET",direction:n};$.push(Vt),this.trades.push(Vt),this.status.totalTrades++,this.notifyTradeUpdate(Vt)}else console.error(`[TradingManager] ❌ Split sell order ${O+1}/${a} failed:`,C.error);!s&&O<a-1&&await new Promise(D=>setTimeout(D,500))}if(k>0)this.status.successfulTrades++,this.status.totalProfit+=M,console.log(`[TradingManager] ✅✅✅ Single position closed${s?" (⚡AGGRESSIVE STOP LOSS⚡)":""}:`,{positionId:t.id.substring(0,8)+"...",tokenId:t.tokenId.substring(0,10)+"...",direction:n,plannedSize:i.toFixed(2),actualFilledSize:k.toFixed(2),totalProfit:M.toFixed(2),numOrdersAttempted:a,numOrdersFilled:$.length,percentageFilled:(k/i*100).toFixed(1)+"%"});else{const O=`All ${a} sell order(s) failed for position ${t.id}`;throw console.error(`[TradingManager] ❌❌❌ ${O}`,{positionId:t.id.substring(0,8)+"...",tokenId:t.tokenId.substring(0,10)+"...",direction:n,sizeAttempted:i.toFixed(2),numSplits:a}),this.status.failedTrades++,new Error(O)}}startTrading(){if(!this.status.isActive){if(!this.strategyConfig.enabled){console.warn("Strategy is not enabled");return}if(!this.browserClobClient){console.error("[TradingManager] ❌ Cannot start trading - Browser ClobClient not initialized. Server-side API is blocked by Cloudflare. Please ensure wallet is connected and browser client is initialized."),alert("Cannot start trading: Browser ClobClient not initialized. Please ensure wallet is connected.");return}this.status.isActive=!0,this.consecutiveFailures=0,this.notifyStatusUpdate(),this.startContinuousMonitoring()}}async startContinuousMonitoring(){if(this.isMonitoring)return;this.isMonitoring=!0,console.log("[TradingManager] 🟢 Starting continuous monitoring...");let t=0;const e=100;for(;this.isMonitoring&&this.status.isActive;)try{t++,t%e===0&&console.log(`[TradingManager] 💓 Monitoring heartbeat (loop ${t}): active=${this.status.isActive}, positions=${this.positions.length}`),await this.checkTradingConditions(),await new Promise(s=>setTimeout(s,100))}catch(s){console.error("[TradingManager] Error in continuous monitoring loop:",s),await new Promise(i=>setTimeout(i,500))}console.log("[TradingManager] 🔴 Continuous monitoring stopped")}stopTrading(){this.status.isActive=!1,this.isMonitoring=!1,this.consecutiveFailures=0,this.pendingEntryOrders.clear(),this.pendingProfitSellOrders.clear(),this.cancelAllPendingOrders(),this.notifyStatusUpdate()}cancelAllPendingOrders(){this.pendingLimitOrders.forEach(t=>{t.status="cancelled",t.reason="Trading stopped - order cancelled",this.notifyTradeUpdate(t)}),this.pendingLimitOrders.clear(),this.status.pendingLimitOrders=0}getTrades(){return[...this.trades]}getStatus(){return{...this.status}}getPositions(){return[...this.positions]}removePositionsByIds(t){if(t.length===0)return;const e=new Set(t);this.positions=this.positions.filter(s=>!e.has(s.id)),this.status.positions=[...this.positions],this.status.totalPositionSize=this.positions.reduce((s,i)=>s+i.size,0),this.persistPositions(),this.notifyStatusUpdate()}async closeAllPositionsManually(t="Manual sell"){await this.closeAllPositions(t)}async closeAllPositionsManuallyEmergency(t="Manual emergency sell"){await this.closeAllPositions(t,!0)}async closePositionManually(t,e="Manual sell"){const s=this.positions.find(n=>n.id===t);if(!s)throw new Error(`Position ${t} not found`);if(s.eventSlug!==this.activeEvent?.slug)throw new Error("Position is not for the active event");const i=this.getActivePositions();i.length>1&&(console.warn(`[TradingManager] ⚠️⚠️⚠️ WARNING: Closing 1 of ${i.length} positions manually.`),console.warn(`[TradingManager] ⚠️ Other ${i.length-1} position(s) will remain open:`,i.filter(n=>n.id!==t).map(n=>({id:n.id.substring(0,8)+"...",direction:n.direction,size:n.size.toFixed(2)}))),console.warn("[TradingManager] 💡 TIP: Use closeAllPositionsManually() to close all positions at once")),console.log(`[TradingManager] 🔄 Manually closing single position ${t.substring(0,8)}...`),await this.closeSinglePosition(s,e),this.positions=this.positions.filter(n=>n.id!==t),this.status.positions=[...this.positions],this.status.totalPositionSize=this.positions.reduce((n,a)=>n+a.size,0),this.persistPositions(),console.log(`[TradingManager] ✅ Position ${t.substring(0,8)}... closed. ${this.positions.length} position(s) remaining.`),this.notifyStatusUpdate()}notifyStatusUpdate(){this.onStatusUpdate&&this.onStatusUpdate(this.getStatus())}notifyTradeUpdate(t){this.onTradeUpdate?.(t),this.onTradePersist?.(t)}clearTrades(){this.trades=[],this.status.totalTrades=0,this.status.successfulTrades=0,this.status.failedTrades=0,this.status.totalProfit=0,this.status.currentPosition=void 0,this.pendingLimitOrders.clear(),this.status.pendingLimitOrders=0,this.notifyStatusUpdate()}}class Wd{managers=new Map;onStatusUpdate=null;onTradeUpdate=null;constructor(){const t=["btc","eth","sol","xrp"];for(const e of t){const s=new jd;this.managers.set(e,s)}}setOnStatusUpdate(t){this.onStatusUpdate=t;for(const[e,s]of this.managers.entries())s.setOnStatusUpdate(i=>{this.onStatusUpdate&&this.onStatusUpdate(e,i)})}setOnTradeUpdate(t){this.onTradeUpdate=t;for(const[e,s]of this.managers.entries())s.setOnTradeUpdate(i=>{this.onTradeUpdate&&this.onTradeUpdate(e,i)})}getManager(t){return this.managers.get(t)}updateMarketData(t,e,s,i=null){const n=this.managers.get(t);n&&n.updateMarketData(e,s,i)}async startTrading(t){const e=this.managers.get(t);e&&await e.startTrading()}stopTrading(t){const e=this.managers.get(t);e&&e.stopTrading()}stopAllTrading(){for(const t of this.managers.values())t.stopTrading()}getStrategyConfig(t){const e=this.managers.get(t);return e?e.getStrategyConfig():this.getDefaultStrategyConfig()}updateStrategyConfig(t,e){const s=this.managers.get(t);s&&s.updateStrategyConfig(e)}getStatus(t){const e=this.managers.get(t);return e?e.getStatus():this.getDefaultStatus()}getPositions(t){const e=this.managers.get(t);return e?e.getPositions():[]}getTrades(t){const e=this.managers.get(t);return e?e.getTrades():[]}setApiCredentials(t,e){if(t){const s=this.managers.get(t);s&&s.setApiCredentials(e)}else for(const s of this.managers.values())s.setApiCredentials(e)}async initializeBrowserClobClient(t,e,s){}getBrowserClobClient(t){const e=this.managers.get(t);return e?e.getBrowserClobClient():null}getAssets(){return Array.from(this.managers.keys())}getDefaultStrategyConfig(){return{enabled:!1,entryPrice:96,profitTargetPrice:99,stopLossPrice:91,tradeSize:50,priceDifference:null,flipGuardPendingDistanceUsd:15,flipGuardFilledDistanceUsd:5,entryTimeRemainingMaxSeconds:180}}getDefaultStatus(){return{isActive:!1,totalTrades:0,successfulTrades:0,failedTrades:0,totalProfit:0,pendingLimitOrders:0,positions:[],totalPositionSize:0}}}const An="/api/event-state";async function Kd(){const r=await fetch(An);if(!r.ok){const t=await r.json().catch(()=>({error:r.statusText}));throw new Error(t?.error||`event-state GET ${r.status}`)}return r.json()}async function Yd(r,t){const e={eventSlug:r};t.priceToBeat!==void 0&&(e.priceToBeat=t.priceToBeat),t.lastPrice!==void 0&&(e.lastPrice=t.lastPrice);const s=await fetch(An,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){const i=await s.json().catch(()=>({error:s.statusText}));throw new Error(i?.error||`event-state POST ${s.status}`)}}const Mn="/api/strategy-config";async function Vd(r){const t=await fetch(`${Mn}?scope=${encodeURIComponent(r)}`);if(!t.ok){const s=await t.json().catch(()=>({error:t.statusText}));throw new Error(s?.error||`strategy-config GET ${t.status}`)}return(await t.json()).config??null}async function Jd(r,t){const e=await fetch(Mn,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scope:r,config:t})});if(!e.ok){const s=await e.json().catch(()=>({error:e.statusText}));throw new Error(s?.error||`strategy-config POST ${e.status}`)}}const xn="/api/trades";async function Qd(r="default"){const t=await fetch(`${xn}?scope=${encodeURIComponent(r)}`);if(!t.ok){const s=await t.json().catch(()=>({error:t.statusText}));throw new Error(s?.error||`trades GET ${t.status}`)}return(await t.json()).trades??[]}async function Xd(r,t){const e=await fetch(xn,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scope:r,trade:t})});if(!e.ok){const s=await e.json().catch(()=>({error:e.statusText}));throw new Error(s?.error||`trades POST ${e.status}`)}}const In="/api/positions";async function Zd(r="default"){const t=await fetch(`${In}?scope=${encodeURIComponent(r)}`);if(!t.ok){const s=await t.json().catch(()=>({error:t.statusText}));throw new Error(s?.error||`positions GET ${t.status}`)}return(await t.json()).positions??[]}async function th(r,t){const e=await fetch(In,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scope:r,positions:t})});if(!e.ok){const s=await e.json().catch(()=>({error:e.statusText}));throw new Error(s?.error||`positions POST ${e.status}`)}}class eh{wsClient;eventManager;tradingManager;currentAsset="btc";assetPrices=new Map;assetPriceHistory=new Map;maxHistorySize=100;currentStatus={connected:!1,source:null,lastUpdate:null,error:null};eventPriceToBeat=new Map;eventLastPrice=new Map;assetUpPrices=new Map;assetDownPrices=new Map;priceUpdateInterval=null;countdownInterval=null;walletState={eoaAddress:null,proxyAddress:null,isConnected:!1,isLoading:!1,error:null,balance:null,balanceLoading:!1,apiCredentials:null};assetSessions=new Map;constructor(){this.wsClient=new Rn,this.eventManager=new Un,this.tradingManager=new Wd;const t=["btc","eth","sol","xrp"];for(const e of t)this.assetPrices.set(e,null),this.assetPriceHistory.set(e,[]),this.assetUpPrices.set(e,null),this.assetDownPrices.set(e,null),this.assetSessions.set(e,{isInitialized:!1,isLoading:!1,error:null});this.eventManager.setOnEventsUpdated(()=>{this.renderEventsTable()}),this.wsClient.setCallbacks(this.handlePriceUpdate.bind(this),this.handleStatusChange.bind(this)),this.tradingManager.setOnStatusUpdate((e,s)=>{e===this.currentAsset&&this.renderTradingSection()}),this.tradingManager.setOnTradeUpdate((e,s)=>{e===this.currentAsset&&(this.renderTradingSection(),s.side==="BUY"&&s.status==="filled"&&(console.log(`[Orders] ${e.toUpperCase()} Buy order filled, fetching order details...`),this.fetchAndDisplayOrders()))});for(const e of t){const s=this.tradingManager.getManager(e);if(!s)continue;const i=e;s.setOnStrategySave(n=>{Jd(i,n).catch(a=>console.warn("[Strategy] Save failed for",i,a))}),s.setOnTradePersist(n=>{Xd(i,n).catch(a=>console.warn("[Trades] Save failed for",i,a))}),s.setOnPositionsPersist(n=>{th(i,n).catch(a=>console.warn("[Positions] Save failed for",i,a))})}}async initialize(){try{console.log("Initializing MultiAssetStreamingPlatform..."),this.render(),this.setupEventListeners(),this.renderWalletSection(),console.log("Loading events for all assets..."),await this.eventManager.loadAllEvents(10),await this.loadEventStateFromDb(),await this.loadTradingDataFromDb(),this.eventManager.startAutoRefreshAll(6e4),this.renderTradingSection(),this.startPriceUpdates(),console.log("MultiAssetStreamingPlatform initialized successfully")}catch(t){throw console.error("Error initializing MultiAssetStreamingPlatform:",t),t}}handlePriceUpdate(t){const e=t.payload.symbol.toLowerCase();let s=null;for(const[a,d]of Object.entries(H))if(d.symbol.toLowerCase()===e){s=a;break}if(!s){console.warn(`Unknown price symbol: ${e}`);return}const i=t.payload.value;this.assetPrices.set(s,i);const n=this.assetPriceHistory.get(s)||[];n.push({timestamp:t.payload.timestamp,value:i}),n.length>this.maxHistorySize&&n.shift(),this.assetPriceHistory.set(s,n),s===this.currentAsset&&(this.updatePriceDisplay(),this.capturePriceForActiveEvent(s),this.capturePriceForExpiredEvent(s),this.updateTradingManager(s))}handleStatusChange(t){this.currentStatus=t,this.updateConnectionStatus()}capturePriceForActiveEvent(t){const e=this.assetPrices.get(t);if(e===null)return;const i=this.eventManager.getEvents(t).find(n=>n.status==="active");i&&e!=null&&!this.eventPriceToBeat.has(i.slug)&&(this.eventPriceToBeat.set(i.slug,e),this.persistEventState(i.slug),this.renderActiveEvent())}async loadEventStateFromDb(){try{const t=await Kd();if(t.priceToBeat&&Object.keys(t.priceToBeat).length>0)for(const[e,s]of Object.entries(t.priceToBeat)){const i=typeof s=="number"?s:Number(s);Number.isNaN(i)||this.eventPriceToBeat.set(e,i)}if(t.lastPrice&&Object.keys(t.lastPrice).length>0)for(const[e,s]of Object.entries(t.lastPrice)){const i=typeof s=="number"?s:Number(s);Number.isNaN(i)||this.eventLastPrice.set(e,i)}}catch(t){console.warn("[Event State] Load failed:",t instanceof Error?t.message:t)}}async loadTradingDataFromDb(){const t=["btc","eth","sol","xrp"];for(const e of t){const s=this.tradingManager.getManager(e);if(s)try{const[i,n,a]=await Promise.all([Vd(e).catch(()=>null),Qd(e).catch(()=>[]),Zd(e).catch(()=>[])]);i&&typeof i=="object"&&s.loadStrategyFromObject(i),n.length>0&&s.setTrades(n),a.length>0&&s.setPositions(a)}catch(i){console.warn("[Trading Data] Load failed for",e,i instanceof Error?i.message:i)}}}persistEventState(t){const e=this.eventPriceToBeat.get(t),s=this.eventLastPrice.get(t);Yd(t,{...e!==void 0&&{priceToBeat:e},...s!==void 0&&{lastPrice:s}}).catch(i=>console.warn("[Event State] Save failed for",t,i instanceof Error?i.message:i))}capturePriceForExpiredEvent(t){const e=this.assetPrices.get(t);if(e==null)return;const s=this.eventManager.getEvents(t);s.forEach((i,n)=>{n>0&&s[n-1].status==="expired"&&!this.eventLastPrice.has(i.slug)&&(this.eventLastPrice.set(i.slug,e),i.status==="active"&&!this.eventPriceToBeat.has(i.slug)&&this.eventPriceToBeat.set(i.slug,e),this.persistEventState(i.slug),t===this.currentAsset&&(this.renderEventsTable(),this.renderActiveEvent()))})}updateTradingManager(t){const s=this.eventManager.getEvents(t).find(a=>a.status==="active"),i=s?this.eventPriceToBeat.get(s.slug):null,n=this.assetPrices.get(t)||null;this.tradingManager.updateMarketData(t,n,i||null,s||null)}setupEventListeners(){const t=document.getElementById("connect"),e=document.getElementById("disconnect");t?.addEventListener("click",()=>{this.wsClient.connect()}),e?.addEventListener("click",()=>{this.wsClient.disconnect()});const s=["btc","eth","sol","xrp"];for(const w of s)document.getElementById(`asset-tab-${w}`)?.addEventListener("click",()=>{this.switchAsset(w)});const i=document.getElementById("events-section-header"),n=document.getElementById("events-section-content"),a=document.getElementById("events-chevron");i&&n&&a&&i.addEventListener("click",()=>{n.classList.contains("collapsed")?(n.classList.remove("collapsed"),a.textContent="▼"):(n.classList.add("collapsed"),a.textContent="▶")});const d=document.getElementById("connect-wallet"),u=document.getElementById("disconnect-wallet"),p=document.getElementById("initialize-session");d?.addEventListener("click",()=>{this.connectWallet()}),u?.addEventListener("click",()=>{this.disconnectWallet()}),p?.addEventListener("click",()=>{this.initializeTradingSession()})}attachTradingControlListeners(){const t=document.getElementById("start-trading"),e=document.getElementById("stop-trading"),s=document.getElementById("save-strategy-config"),i=document.getElementById("emergency-sell");t?.addEventListener("click",async()=>{await this.startTrading()}),e?.addEventListener("click",()=>{this.stopTrading()}),s?.addEventListener("click",()=>{this.saveStrategyConfig()}),i?.addEventListener("click",async()=>{if(confirm("Emergency sell will market-sell all positions for this asset. Continue?"))try{await this.tradingManager.getManager(this.currentAsset)?.closeAllPositionsManuallyEmergency(),this.renderTradingSection()}catch(n){console.error("Emergency sell failed:",n)}})}switchAsset(t){this.stopCountdown(),this.currentAsset=t;const e=["btc","eth","sol","xrp"];for(const s of e){const i=document.getElementById(`asset-tab-${s}`);i&&(s===t?i.classList.add("active"):i.classList.remove("active"))}this.updateSectionHeaders(),this.updatePriceDisplay(),this.renderEventsTable(),this.renderActiveEvent(),this.renderTradingSection(),this.renderWalletSection(),this.fetchAndDisplayOrders(),this.startPriceUpdates()}updateSectionHeaders(){const t=document.querySelector(".events-section-header h2");t&&(t.textContent=`${H[this.currentAsset].displayName} Up/Down 15m Events`);const e=document.querySelector(".trading-section h2");e&&(e.textContent=`Trading Configuration - ${H[this.currentAsset].displayName}`);const s=document.querySelector(".orders-section h2");s&&(s.textContent=`Orders & Positions - ${H[this.currentAsset].displayName}`);const i=document.querySelector(".trades-section h2");i&&(i.textContent=`Trade History - ${H[this.currentAsset].displayName}`);const n=document.querySelector(".wallet-section h3");n&&(n.textContent=`Trading Session Initialization - ${H[this.currentAsset].displayName}`)}render(){const t=document.getElementById("app");if(!t){console.error("App element not found!");return}t.innerHTML=`
      <div class="container">
        <header>
          <h1>Multi-Asset Trading Platform</h1>
          <p class="subtitle">BTC, ETH, SOL, XRP - Real-time cryptocurrency trading</p>
        </header>

        <!-- Asset Tabs -->
        <div class="asset-tabs">
          ${["btc","eth","sol","xrp"].map(e=>`
            <button id="asset-tab-${e}" class="asset-tab ${e===this.currentAsset?"active":""}">
              ${H[e].displayName}
            </button>
          `).join("")}
        </div>

        <div class="controls">
          <div class="button-group">
            <button id="connect" class="btn btn-primary">Connect WebSocket</button>
            <button id="disconnect" class="btn btn-secondary">Disconnect</button>
          </div>
        </div>

        <div class="status-bar">
          <div class="status-item">
            <span class="status-label">Status:</span>
            <span id="connection-status" class="status-disconnected">Disconnected</span>
          </div>
          <div id="error-message" class="error-message"></div>
        </div>

        <div class="price-display">
          <div class="price-label">Current ${H[this.currentAsset].displayName} Price</div>
          <div id="current-price" class="price-value">--</div>
          <div class="price-meta">
            <span>Last Update: <span id="price-timestamp">--</span></span>
            <span id="price-change" class="price-change">--</span>
          </div>
        </div>

        <div class="active-event-section" id="active-event-display">
          <div class="active-event-empty">
            <p>Loading events...</p>
          </div>
        </div>

        <div class="events-section">
          <div class="events-section-header" id="events-section-header" style="cursor: pointer;">
            <h2>${H[this.currentAsset].displayName} Up/Down 15m Events</h2>
            <span class="events-chevron" id="events-chevron">▶</span>
          </div>
          <div class="events-section-content collapsed" id="events-section-content">
            <table class="events-table">
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Start</th>
                  <th>End</th>
                  <th>Status</th>
                  <th>Last Price</th>
                  <th>Condition ID</th>
                  <th>Question ID</th>
                  <th>Token IDs</th>
                  <th>Slug</th>
                </tr>
              </thead>
              <tbody id="events-table-body">
                <tr><td colspan="9" style="text-align: center;">Loading events...</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="trading-section">
          <h2>Trading Configuration - ${H[this.currentAsset].displayName}</h2>
          <div id="trading-config"></div>
          <div id="trading-status"></div>
          <div id="trading-controls"></div>
        </div>

        <div class="wallet-section">
          <h2>Wallet Connection (Shared Across All Assets)</h2>
          <div id="wallet-display"></div>
          <h3>Trading Session Initialization - ${H[this.currentAsset].displayName}</h3>
          <p class="session-note">Each asset requires its own trading session initialization. Initialize sessions for each asset you want to trade.</p>
          <div id="session-display"></div>
        </div>

        <div class="orders-section">
          <h2>Orders & Positions - ${H[this.currentAsset].displayName}</h2>
          <div id="orders-display"></div>
        </div>

        <div class="trades-section">
          <h2>Trade History - ${H[this.currentAsset].displayName}</h2>
          <div id="trades-display"></div>
        </div>
      </div>
    `}updatePriceDisplay(){const t=document.getElementById("current-price"),e=document.getElementById("price-timestamp"),s=document.getElementById("price-change"),i=this.assetPrices.get(this.currentAsset);if(t&&(t.textContent=i!=null?`$${i.toFixed(2)}`:"--"),e){const n=this.assetPriceHistory.get(this.currentAsset)||[],a=n.length>0?n[n.length-1].timestamp:null;a?e.textContent=new Date(a*1e3).toLocaleTimeString():e.textContent="--"}if(s&&i!=null){const n=this.assetPriceHistory.get(this.currentAsset)||[];if(n.length>=2){const a=n[n.length-2].value,d=i-a,u=d/a*100;s.textContent=`${d>=0?"+":""}${d.toFixed(2)} (${u>=0?"+":""}${u.toFixed(2)}%)`,s.className=`price-change ${d>=0?"positive":"negative"}`}}}renderEventsTable(){const t=this.eventManager.getEvents(this.currentAsset),e=document.getElementById("events-table-body");if(e){if(t.length===0){e.innerHTML='<tr><td colspan="9" style="text-align: center; padding: 20px;">No events found</td></tr>';return}e.innerHTML=t.map((s,i)=>{const a=i===this.eventManager.getCurrentEventIndex(this.currentAsset)?"event-row current-event":"event-row",d=s.status==="active"?"status-active":s.status==="expired"?"status-expired":"status-upcoming",u=s.status==="active"?"Active":s.status==="expired"?"Expired":"Upcoming",p=this.eventLastPrice.get(s.slug)||s.lastPrice,w=p!==void 0?`$${p.toFixed(2)}`:"--";return`
        <tr class="${a}">
          <td>${s.title}</td>
          <td>${s.formattedStartDate}</td>
          <td>${s.formattedEndDate}</td>
          <td><span class="${d}">${u}</span></td>
          <td>${w}</td>
          <td>${s.conditionId||"--"}</td>
          <td>${s.questionId||"--"}</td>
          <td>${s.clobTokenIds?s.clobTokenIds.join(", "):"--"}</td>
          <td>${s.slug}</td>
        </tr>
      `}).join("")}}renderActiveEvent(){const t=document.getElementById("active-event-display");if(!t)return;const s=this.eventManager.getEvents(this.currentAsset).find(p=>p.status==="active");if(!s){t.innerHTML=`
        <div class="active-event-empty">
          <p>No active event for ${H[this.currentAsset].displayName}</p>
        </div>
      `;return}const i=this.eventPriceToBeat.get(s.slug),n=this.assetPrices.get(this.currentAsset),a=i!==void 0?`$${i.toFixed(2)}`:n!=null?`$${n.toFixed(2)} (current)`:"Loading...",d=this.assetUpPrices.get(this.currentAsset),u=this.assetDownPrices.get(this.currentAsset);t.innerHTML=`
      <div class="active-event">
        <h3>Active Event: ${s.title}</h3>
        <div class="active-event-info">
          <div class="info-row">
            <span class="info-label">Price to Beat:</span>
            <span class="info-value">${a}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Current ${H[this.currentAsset].displayName} Price:</span>
            <span class="info-value">${n!=null?`$${n.toFixed(2)}`:"Loading..."}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Time Remaining:</span>
            <span class="info-value" id="countdown">Calculating...</span>
          </div>
          ${d!=null&&u!=null?`
            <div class="info-row">
              <span class="info-label">UP Price:</span>
              <span class="info-value">${d.toFixed(2)}%</span>
            </div>
            <div class="info-row">
              <span class="info-label">DOWN Price:</span>
              <span class="info-value">${u.toFixed(2)}%</span>
            </div>
          `:""}
          <div class="info-row">
            <span class="info-label">Slug:</span>
            <span class="info-value slug-value">${s.slug}</span>
          </div>
        </div>
      </div>
    `,this.startCountdown(s)}startCountdown(t){this.stopCountdown(),this.countdownInterval=window.setInterval(()=>{this.updateCountdown()},1e3),this.updateCountdown()}stopCountdown(){this.countdownInterval!==null&&(clearInterval(this.countdownInterval),this.countdownInterval=null)}updateCountdown(){const t=this.eventManager.getEvents(this.currentAsset),e=t.find(d=>d.status==="active"),s=document.getElementById("countdown");if(!e||!s){this.stopCountdown();return}const i=new Date(e.endDate),n=new Date,a=Math.max(0,Math.floor((i.getTime()-n.getTime())/1e3));if(s.textContent=this.formatCountdown(a),a===0){const d=this.assetPrices.get(this.currentAsset);if(d!=null){const u=t.findIndex(w=>w.status==="active"),p=t[u+1];p&&!this.eventLastPrice.has(p.slug)&&(this.eventLastPrice.set(p.slug,d),this.persistEventState(p.slug))}this.stopCountdown(),this.eventManager.loadEvents(this.currentAsset,10).catch(console.error)}}formatCountdown(t){if(t<=0)return"00:00:00";const e=Math.floor(t/3600),s=Math.floor(t%3600/60),i=t%60;return`${e.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}renderTradingSection(){const t=document.getElementById("trading-config"),e=document.getElementById("trading-status"),s=document.getElementById("trading-controls"),i=document.getElementById("trades-display");if(!t||!e||!s)return;const n=this.tradingManager.getStrategyConfig(this.currentAsset),a=this.tradingManager.getStatus(this.currentAsset),d=this.tradingManager.getTrades(this.currentAsset),u=this.assetSessions.get(this.currentAsset);t.innerHTML=`
      <div class="strategy-config">
        <div class="config-item">
          <label>
            <input type="checkbox" id="strategy-enabled" ${n.enabled?"checked":""}>
            Enable Trading
          </label>
        </div>
        <div class="config-item">
          <label>
            Entry Price (0-100):
            <input type="number" id="entry-price" value="${n.entryPrice}" min="0" max="100" step="0.01">
            <small>When active order's UP or DOWN value reaches this price, the order is placed</small>
          </label>
        </div>
        <div class="config-item">
          <label>
            Profit Target (0-100):
            <input type="number" id="profit-target" value="${n.profitTargetPrice}" min="0" max="100" step="0.01">
            <small>When active order's UP or DOWN value reaches this price, the order is sold</small>
          </label>
        </div>
        <div class="config-item">
          <label>
            Stop Loss (0-100):
            <input type="number" id="stop-loss" value="${n.stopLossPrice}" min="0" max="100" step="0.01">
            <small>When UP or DOWN value reaches this price, the order is sold</small>
          </label>
        </div>
        <div class="config-item">
          <label>
            Trade Size (USD):
            <input type="number" id="trade-size" value="${n.tradeSize}" min="1" step="0.01">
          </label>
        </div>
        <div class="config-item">
          <label>
            Price Difference (USD):
            <input type="number" id="price-difference" value="${n.priceDifference??""}" placeholder="Optional">
            <small>Only trade when |Price to Beat - Current ${H[this.currentAsset].displayName} Price| equals this value. Leave empty to disable.</small>
          </label>
        </div>
        <div class="config-item">
          <label>
            Flip Guard Pending (USD):
            <input type="number" id="flip-guard-pending" value="${n.flipGuardPendingDistanceUsd??15}" min="0" step="0.01">
            <small>Cancel pending entry bids when price distance drops below this.</small>
          </label>
        </div>
        <div class="config-item">
          <label>
            Flip Guard Filled (USD):
            <input type="number" id="flip-guard-filled" value="${n.flipGuardFilledDistanceUsd??5}" min="0" step="0.01">
            <small>Emergency market sell when filled and price distance drops below this.</small>
          </label>
        </div>
        <div class="config-item">
          <label>
            Entry Time Remaining Max (sec):
            <input type="number" id="entry-time-remaining-max" value="${n.entryTimeRemainingMaxSeconds??180}" min="0" step="1">
            <small>Only enter when time left &lt; this many seconds.</small>
          </label>
        </div>
        <button id="save-strategy-config" class="btn btn-primary">Save Configuration</button>
      </div>
    `,e.innerHTML=`
      <div class="trading-status-display">
        <div class="status-item">
          <span class="status-label">Trading Active:</span>
          <span class="status-value">${a.isActive?"Yes":"No"}</span>
        </div>
        <div class="status-item">
          <span class="status-label">Total Trades:</span>
          <span class="status-value">${a.totalTrades}</span>
        </div>
        <div class="status-item">
          <span class="status-label">Successful:</span>
          <span class="status-value">${a.successfulTrades}</span>
        </div>
        <div class="status-item">
          <span class="status-label">Failed:</span>
          <span class="status-value">${a.failedTrades}</span>
        </div>
        <div class="status-item">
          <span class="status-label">Total Profit:</span>
          <span class="status-value ${a.totalProfit>=0?"profit":"loss"}">$${a.totalProfit.toFixed(2)}</span>
        </div>
        <div class="status-item">
          <span class="status-label">Open Positions:</span>
          <span class="status-value">${a.positions?.length||0}</span>
        </div>
      </div>
    `;const p=u?.isInitialized&&!a.isActive,w=(a.positions?.length??0)>0;s.innerHTML=`
      <div class="trading-controls">
        <button id="start-trading" class="btn btn-success" ${p?"":"disabled"}>
          Start ${H[this.currentAsset].displayName} Trading
        </button>
        <button id="stop-trading" class="btn btn-danger" ${a.isActive?"":"disabled"}>
          Stop ${H[this.currentAsset].displayName} Trading
        </button>
        <button id="emergency-sell" class="btn btn-danger" ${w?"":"disabled"} title="Market sell all positions for this asset">Sell All (Emergency)</button>
        ${u?.isInitialized?"":`
          <p class="trading-warning">⚠️ Trading session not initialized. Please initialize session first.</p>
        `}
      </div>
    `,this.attachTradingControlListeners(),i&&(d.length===0?i.innerHTML='<p class="no-trades">No trades yet for '+H[this.currentAsset].displayName+"</p>":i.innerHTML=`
          <table class="trades-table">
            <thead>
              <tr>
                <th>Time</th>
                <th>Event</th>
                <th>Side</th>
                <th>Size</th>
                <th>Price</th>
                <th>Status</th>
                <th>Profit</th>
                <th>Reason</th>
              </tr>
            </thead>
            <tbody>
              ${d.slice().reverse().map(f=>`
                <tr class="trade-row trade-${f.status}">
                  <td>${new Date(f.timestamp).toLocaleTimeString()}</td>
                  <td class="event-slug">${f.eventSlug}</td>
                  <td><span class="side-${f.side.toLowerCase()}">${f.side}</span> ${f.direction?`<span class="direction-badge direction-${f.direction.toLowerCase()}">${f.direction}</span>`:""}</td>
                  <td>$${f.size.toFixed(2)}</td>
                  <td>${f.price.toFixed(2)}${f.orderType==="LIMIT"&&f.limitPrice?` (limit: ${f.limitPrice.toFixed(2)})`:""}</td>
                  <td><span class="status-badge status-${f.status}">${f.status}</span> ${f.orderType==="LIMIT"?'<span class="order-type">LIMIT</span>':""}</td>
                  <td class="${f.profit!==void 0?f.profit>=0?"profit":"loss":""}">
                    ${f.profit!==void 0?`$${f.profit.toFixed(2)}`:"--"}
                  </td>
                  <td class="reason">${f.reason}</td>
                </tr>
              `).join("")}
            </tbody>
          </table>
        `)}renderWalletSection(){const t=document.getElementById("wallet-display"),e=document.getElementById("session-display");if(t&&(t.innerHTML=`
        <div class="wallet-info">
          <div class="wallet-status">
            <span class="status-label">Wallet:</span>
            <span class="status-value">${this.walletState.isConnected?"Connected":"Not Connected"}</span>
          </div>
          ${this.walletState.eoaAddress?`
            <div class="wallet-address">
              <span class="label">EOA:</span>
              <span class="value">${this.walletState.eoaAddress.substring(0,6)}...${this.walletState.eoaAddress.substring(38)}</span>
            </div>
          `:""}
          ${this.walletState.proxyAddress?`
            <div class="wallet-address">
              <span class="label">Proxy:</span>
              <span class="value">${this.walletState.proxyAddress.substring(0,6)}...${this.walletState.proxyAddress.substring(38)}</span>
            </div>
          `:""}
          ${this.walletState.balance!==null?`
            <div class="wallet-balance">
              <span class="label">Balance:</span>
              <span class="value">$${this.walletState.balance.toFixed(2)}</span>
            </div>
          `:""}
          <div class="wallet-controls">
            ${this.walletState.isConnected?`
              <button id="disconnect-wallet" class="btn btn-secondary">Disconnect Wallet</button>
            `:`
              <button id="connect-wallet" class="btn btn-primary" ${this.walletState.isLoading?"disabled":""}>Connect Wallet</button>
            `}
          </div>
          ${this.walletState.error?`
            <div class="wallet-error">Error: ${this.walletState.error}</div>
          `:""}
        </div>
      `),e){const s=this.assetSessions.get(this.currentAsset)||{isInitialized:!1,isLoading:!1,error:null};e.innerHTML=`
        <div class="session-info">
          <div class="session-status">
            <span class="status-label">${H[this.currentAsset].displayName} Session:</span>
            <span class="status-value">${s.isInitialized?"Initialized":"Not Initialized"}</span>
          </div>
          ${s.error?`
            <div class="session-error">Error: ${s.error}</div>
          `:""}
          <div class="session-controls">
            <button id="initialize-session" class="btn btn-primary" 
              ${!this.walletState.isConnected||s.isInitialized||s.isLoading?"disabled":""}>
              ${s.isLoading?"Initializing...":`Initialize ${H[this.currentAsset].displayName} Trading Session`}
            </button>
          </div>
        </div>
      `}}async startTrading(){if(!this.assetSessions.get(this.currentAsset)?.isInitialized){alert(`Please initialize ${H[this.currentAsset].displayName} trading session first!`);return}await this.tradingManager.startTrading(this.currentAsset),this.renderTradingSection()}stopTrading(){this.tradingManager.stopTrading(this.currentAsset),this.renderTradingSection()}saveStrategyConfig(){const t=document.getElementById("strategy-enabled")?.checked||!1,e=parseFloat(document.getElementById("entry-price")?.value||"96"),s=parseFloat(document.getElementById("profit-target")?.value||"99"),i=parseFloat(document.getElementById("stop-loss")?.value||"91"),n=parseFloat(document.getElementById("trade-size")?.value||"50"),a=document.getElementById("price-difference")?.value,d=a&&a.trim()!==""?parseFloat(a):null,u=document.getElementById("flip-guard-pending")?.value,p=u&&u.trim()!==""?parseFloat(u):void 0,w=document.getElementById("flip-guard-filled")?.value,f=w&&w.trim()!==""?parseFloat(w):void 0,x=document.getElementById("entry-time-remaining-max")?.value,T=x&&x.trim()!==""?parseFloat(x):void 0;this.tradingManager.updateStrategyConfig(this.currentAsset,{enabled:t,entryPrice:e,profitTargetPrice:s,stopLossPrice:i,tradeSize:n,priceDifference:d,flipGuardPendingDistanceUsd:p,flipGuardFilledDistanceUsd:f,entryTimeRemainingMaxSeconds:T}),alert(`Strategy configuration saved for ${H[this.currentAsset].displayName}!`)}updateConnectionStatus(){const t=document.getElementById("connection-status"),e=document.getElementById("error-message");t&&(this.currentStatus.connected?(t.textContent="Connected",t.className="status-connected"):(t.textContent="Disconnected",t.className="status-disconnected")),e&&(this.currentStatus.error?(e.textContent=this.currentStatus.error,e.style.display="block"):e.style.display="none")}startPriceUpdates(){this.stopPriceUpdates(),this.priceUpdateInterval=window.setInterval(()=>{this.updateUpDownPrices()},5e3),this.updateUpDownPrices()}stopPriceUpdates(){this.priceUpdateInterval!==null&&(clearInterval(this.priceUpdateInterval),this.priceUpdateInterval=null)}async updateUpDownPrices(){const e=this.eventManager.getEvents(this.currentAsset).find(s=>s.status==="active");if(!e||!e.clobTokenIds||e.clobTokenIds.length<2){this.assetUpPrices.set(this.currentAsset,null),this.assetDownPrices.set(this.currentAsset,null);return}try{const s=this.tradingManager.getManager(this.currentAsset);if(!s)return;const i=s.clobClient;if(!i)return;const[n,a]=await Promise.all([i.getPrice(e.clobTokenIds[0],"SELL"),i.getPrice(e.clobTokenIds[1],"SELL")]);n&&a&&(this.assetUpPrices.set(this.currentAsset,n*100),this.assetDownPrices.set(this.currentAsset,a*100))}catch(s){console.error(`[${this.currentAsset.toUpperCase()}] Error updating UP/DOWN prices:`,s)}}async fetchAndDisplayOrders(){const t=document.getElementById("orders-display");if(!t)return;if(!this.assetSessions.get(this.currentAsset)?.isInitialized||!this.walletState.apiCredentials||!this.walletState.proxyAddress){t.innerHTML=`
        <div class="orders-empty">
          <p>${H[this.currentAsset].displayName} trading session not initialized. Please initialize session first.</p>
        </div>
      `;return}t.innerHTML='<div class="orders-loading">Loading orders...</div>';try{const s=await fetch(`/api/orders?apiCredentials=${encodeURIComponent(JSON.stringify(this.walletState.apiCredentials))}&proxyAddress=${encodeURIComponent(this.walletState.proxyAddress)}`),i=await s.json();if(!s.ok)throw new Error(i.error||"Failed to fetch orders");const n=i.orders||[],a=this.tradingManager.getPositions(this.currentAsset),d=a.map((f,x)=>{const T=f.filledOrders||[],S=T.reduce((C,D)=>C+D.size,0),P=f.size>0?(S/f.size*100).toFixed(1):"0.0",M=T[0],k=M?.orderId?M.orderId.substring(0,8)+"...":`POS-${x+1}`,$=M?.orderId?M.orderId.substring(0,16)+"...":"--",O=M?.timestamp?new Date(M.timestamp).toLocaleString():new Date(f.entryTimestamp).toLocaleString();return`
          <tr class="order-row order-position" data-position-id="${f.id}">
            <td class="order-id">${k}</td>
            <td class="token-id">${f.tokenId?f.tokenId.substring(0,10)+"...":"--"}</td>
            <td>${$}</td>
            <td>${S.toFixed(2)} (${P}%)</td>
            <td><span class="status-badge status-position">ACTIVE</span></td>
            <td>${O}</td>
            <td>
              <button class="btn-sell-order btn-sell-position" 
                data-position-id="${f.id}"
                data-token-id="${f.tokenId||""}" 
                data-size="${f.size||0}"
                data-price="${f.entryPrice||0}"
                data-direction="${f.direction||""}">Sell</button>
            </td>
          </tr>
        `}).join(""),u=n.map(f=>{const x=(f.status||"UNKNOWN").toUpperCase(),T=x==="FILLED"||x==="EXECUTED"||x==="CLOSED",S=x==="LIVE",P=f.original_size>0?((f.size_matched||0)/f.original_size*100).toFixed(1):"0.0";return`
          <tr class="order-row ${T?"order-filled":S?"order-live":""}">
            <td class="order-id">${f.id?f.id.substring(0,8)+"...":"--"}</td>
            <td class="token-id">${f.asset_id?f.asset_id.substring(0,10)+"...":f.token_id?f.token_id.substring(0,10)+"...":"--"}</td>
            <td>${(f.transaction_hash||f.hash||f.id||"--").substring(0,16)}${(f.transaction_hash||f.hash||f.id||"").length>16?"...":""}</td>
            <td>${parseFloat(f.size_matched||f.filled_size||0).toFixed(2)} (${P}%)</td>
            <td><span class="status-badge status-${x.toLowerCase()}">${f.status||"UNKNOWN"}</span></td>
            <td>${f.created_at?new Date(f.created_at*1e3).toLocaleString():f.created_at_iso||"--"}</td>
            <td>
              ${S?`<button class="btn-cancel-order" data-order-id="${f.id}">Cancel</button>`:T&&f.side==="BUY"?`<button class="btn-sell-order" data-order-id="${f.id}" data-token-id="${f.asset_id||f.token_id||""}" data-size="${f.size_matched||f.filled_size||f.original_size||f.size||0}" data-price="${f.price||0}">Sell</button>`:"--"}
            </td>
          </tr>
        `}).join("");t.innerHTML=`
        <div class="orders-summary">
          <p><strong>Positions:</strong> ${a.length} | <strong>Orders:</strong> ${n.length}</p>
        </div>
        <table class="orders-table">
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Token ID</th>
              <th>Hash</th>
              <th>Filled</th>
              <th>Status</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${d}
            ${u}
            ${a.length===0&&n.length===0?'<tr><td colspan="7" class="orders-empty-cell">No orders or positions</td></tr>':""}
          </tbody>
        </table>
      `,t.querySelectorAll(".btn-sell-order").forEach(f=>{f.addEventListener("click",async x=>{const S=x.target.getAttribute("data-position-id");S&&await this.sellPosition(S)})}),t.querySelectorAll(".btn-cancel-order").forEach(f=>{f.addEventListener("click",async x=>{const T=x.target.getAttribute("data-order-id");T&&await this.cancelOrder(T)})})}catch(s){console.error(`[${this.currentAsset.toUpperCase()}] Error fetching orders:`,s),t.innerHTML=`
        <div class="orders-error">
          <p>Error loading orders: ${s instanceof Error?s.message:"Unknown error"}</p>
        </div>
      `}}async connectWallet(){this.walletState.isLoading=!0,this.walletState.error=null,this.renderWalletSection();try{console.log("[Wallet] Attempting to connect...");const t=await fetch("/api/wallet",{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok){const s=await t.json().catch(()=>({}));throw new Error(s.error||`Server error (${t.status})`)}const e=await t.json();if(!e.eoaAddress||!e.proxyAddress)throw new Error("Invalid wallet data received: missing eoaAddress or proxyAddress");this.walletState.eoaAddress=e.eoaAddress,this.walletState.proxyAddress=e.proxyAddress,this.walletState.isConnected=!0,this.walletState.error=null,await this.fetchBalance(),this.renderWalletSection(),alert("Wallet connected successfully!")}catch(t){console.error("[Wallet] Connection error:",t);const e=t instanceof Error?t.message:"Failed to connect wallet";this.walletState.error=e,this.walletState.isConnected=!1,this.renderWalletSection()}finally{this.walletState.isLoading=!1,this.renderWalletSection()}}async fetchBalance(){if(this.walletState.isConnected){this.walletState.balanceLoading=!0,this.renderWalletSection();try{const t=await fetch("/api/wallet/balance"),e=await t.json();if(t.ok&&e.balance!==null&&e.balance!==void 0){this.walletState.balance=e.balance;const s=["btc","eth","sol","xrp"];for(const i of s){const n=this.tradingManager.getManager(i);n&&n.setWalletBalance?.(e.balance)}}}catch(t){console.error("Balance fetch error:",t)}finally{this.walletState.balanceLoading=!1,this.renderWalletSection()}}}disconnectWallet(){console.log("[Wallet] Disconnecting wallet..."),this.tradingManager.stopAllTrading(),this.walletState.isConnected=!1,this.walletState.eoaAddress=null,this.walletState.proxyAddress=null,this.walletState.apiCredentials=null,this.walletState.balance=null,this.walletState.error=null;const t=["btc","eth","sol","xrp"];for(const e of t){this.assetSessions.set(e,{isInitialized:!1,isLoading:!1,error:null});const s=this.tradingManager.getManager(e);s&&s.setBrowserClobClient?.(null)}this.renderWalletSection(),console.log("[Wallet] Wallet disconnected")}async initializeTradingSession(){if(!this.walletState.isConnected){alert("Please connect wallet first");return}const t=this.assetSessions.get(this.currentAsset);if(t){t.isLoading=!0,t.error=null,this.renderWalletSection();try{console.log(`[Session] Initializing ${this.currentAsset.toUpperCase()} trading session...`);const e=await fetch("/api/wallet/initialize",{method:"POST",headers:{"Content-Type":"application/json"}}),s=await e.json();if(!e.ok)throw new Error(s.error||"Failed to initialize trading session");if(s.credentials&&(this.walletState.apiCredentials=s.credentials,this.tradingManager.setApiCredentials(this.currentAsset,s.credentials)),this.walletState.eoaAddress&&this.walletState.proxyAddress&&s.credentials&&(await this.initializeBrowserClobClient(this.currentAsset),!this.tradingManager.getBrowserClobClient(this.currentAsset)))throw new Error("Browser ClobClient initialization failed. Cannot place orders - server-side API is blocked by Cloudflare. Please try reconnecting your wallet.");t.isInitialized=!0,t.error=null,await this.fetchAndDisplayOrders(),this.renderWalletSection(),alert(`${H[this.currentAsset].displayName} trading session initialized successfully!`)}catch(e){console.error(`[Session] ${this.currentAsset.toUpperCase()} initialization error:`,e),t.error=e instanceof Error?e.message:"Failed to initialize trading session",t.isInitialized=!1,this.renderWalletSection()}finally{t.isLoading=!1,this.renderWalletSection()}}}async initializeBrowserClobClient(t){if(!this.walletState.isConnected||!this.walletState.apiCredentials||!this.walletState.eoaAddress||!this.walletState.proxyAddress){console.warn(`[Browser ClobClient] Cannot initialize ${t} - wallet not connected or credentials missing`);return}try{const e=await fetch("/api/wallet/private-key",{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok){console.warn(`[Browser ClobClient] ${t} - Private key endpoint not available`);return}const s=await e.json();if(!s.privateKey)throw new Error("Private key not returned from server");const{initializeBrowserClobClient:i}=await Ce(async()=>{const{initializeBrowserClobClient:d}=await import("./streaming-platform-clob-init-Dg2IocXB.js");return{initializeBrowserClobClient:d}},[]),n=await i(s.privateKey,this.walletState.apiCredentials,this.walletState.proxyAddress),a=this.tradingManager.getManager(t);a&&(a.setBrowserClobClient?.(n),console.log(`[Browser ClobClient] ✅ ${t.toUpperCase()} session initialized successfully`))}catch(e){throw console.error(`[Browser ClobClient] ❌ ${t.toUpperCase()} initialization failed:`,e),e}}async sellPosition(t){const e=this.tradingManager.getManager(this.currentAsset);if(e)try{await e.closePositionManually?.(t,"Manual sell"),await this.fetchAndDisplayOrders(),this.renderTradingSection(),alert("Position closed successfully!")}catch(s){console.error("Error selling position:",s),alert(`Error: ${s instanceof Error?s.message:"Failed to sell position"}`)}}async cancelOrder(t){console.log(`Canceling order ${t} for ${this.currentAsset}`),await this.fetchAndDisplayOrders()}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{pi()}):pi();function pi(){if(!document.getElementById("app")){console.error('App element not found! Make sure index.html has <div id="app"></div>');return}new eh().initialize().catch(e=>{console.error("Failed to initialize platform:",e)})}export{J as B,Pn as C,z as L,xh as _,Bc as a,ye as b,Sh as c,Qt as d,Eh as e,Md as f,zc as g,Dt as h,Ad as i,Ph as j,Re as k,bd as l,Th as m,kd as n,Mh as o,Ah as p,yd as r,bh as s};
